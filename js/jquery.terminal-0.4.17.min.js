/*

 |       __ _____                     ________                              __
 |      / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /
 |  __ / // // // // // _  // _// // / / // _  // _//     // //  \/ // _ \/ /
 | /  / // // // // // ___// / / // / / // ___// / / / / // // /\  // // / /__
 | \___//____ \\___//____//_/ _\_  / /_//____//_/ /_/ /_//_//_/ /_/ \__\_\___/
 |           \/              /____/                              version 0.4.17
 http://terminal.jcubic.pl

 Licensed under GNU LGPL Version 3 license
 Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>

 Includes:

 Storage plugin Distributed under the MIT License
 Copyright (c) 2010 Dave Schindler

 jQuery Timers licenced with the WTFPL
 <http://jquery.offput.ca/every/>

 Cross-Browser Split 1.1.1
 Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
 Available under the MIT License

 Date: Wed, 20 Jun 2012 14:22:35 +0000
*/
Array.prototype.has=function(m){for(var E=this.length;E--;)if(this[E]==m)return true;return false};function get_stack(m){return m?[m.toString().match(/.*\n.*\n/)].concat(get_stack(m.caller)):[]}
(function(m,E){function ha(c,e){var f;if(typeof c==="string"&&typeof e==="string"){localStorage[c]=e;return true}else if(typeof c==="object"&&typeof e==="undefined"){for(f in c)if(c.hasOwnProperty(f))localStorage[f]=c[f];return true}return false}function ba(c,e){var f,h;f=new Date;f.setTime(f.getTime()+31536E6);f="; expires="+f.toGMTString();if(typeof c==="string"&&typeof e==="string"){document.cookie=c+"="+e+f+"; path=/";return true}else if(typeof c==="object"&&typeof e==="undefined"){for(h in c)if(c.hasOwnProperty(h))document.cookie=
h+"="+c[h]+f+"; path=/";return true}return false}function ia(c){return localStorage[c]}function ja(c){var e,f,h;c+="=";e=document.cookie.split(";");for(f=0;f<e.length;f++){for(h=e[f];h.charAt(0)===" ";)h=h.substring(1,h.length);if(h.indexOf(c)===0)return h.substring(c.length,h.length)}return null}function ka(c){return delete localStorage[c]}function la(c){return ba(c,"",-1)}function X(c,e){var f=[],h=c.length;if(h<e)return[c];for(var k=0;k<h;k+=e)f.push(c.substring(k,k+e));return f}function H(c){if(typeof c==
"string"){c=c.replace(/&(?!#[0-9]+;|[a-zA-Z]+;)/g,"&amp;");c=c.replace(/</g,"&lt;").replace(/>/g,"&gt;");c=c.replace(/\n/g,"<br/>");c=c.replace(/ /g,"&nbsp;");c=c.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");var e=c.split(ma);if(e.length>1)c=m.map(e,function(f){if(f==="")return f;else if(f.substring(0,1)=="[")return f.replace(Y,function(h,k,t,y,n){if(n==="")return"<span>&nbsp;</span>";h="";if(k.indexOf("b")!=-1)h+="font-weight:bold;";var D="text-decoration:";if(k.indexOf("u")!=-1)D+="underline ";if(k.indexOf("s")!=
-1)D+="line-through";if(k.indexOf("s")!=-1||k.indexOf("u")!=-1)h+=D+";";if(k.indexOf("i")!=-1)h+="font-style:italic; ";if(t.match(ca))h+="color:"+t+";";if(y.match(ca))h+="background-color:"+y;return c='<span style="'+h+'">'+n+"</span>"});else{console.log("3");return"<span>"+f+"</span>"}}).join("");return c}else return""}function da(c){var e=c instanceof Array?c:c?[c]:[],f=0;m.extend(this,{left:function(){if(f===0)f=e.length-1;else--f;return e[f]},right:function(){if(f==e.length-1)f=0;else++f;return e[f]},
current:function(){return e[f]},data:function(){return e},length:function(){return e.length},reset:function(){f=0},append:function(h){e.push(h);this.reset()}})}function na(c){var e=c?[c]:[];m.extend(this,{size:function(){return e.length},pop:function(){if(e.length===0)return null;else{var f=e[e.length-1];e=e.slice(0,e.length-1);return f}},push:function(f){e=e.concat([f]);return f},top:function(){return e.length>0?e[e.length-1]:null}})}function oa(c){var e=true;if(typeof c==="string"&&c!=="")c+="_";
var f=m.Storage.get(c+"commands"),h=new da(f?eval("("+f+")"):[""]);m.extend(this,{append:function(k){if(e&&h.current()!=k){h.append(k);m.Storage.set(c+"commands",m.json_stringify(h.data()))}},data:function(){return h.data()},next:function(){return h.right()},last:function(){h.reset()},previous:function(){return h.left()},clear:function(){h=new da;m.Storage.remove(c+"commands")},enable:function(){e=true},disable:function(){e=false}})}var T=typeof window.localStorage!=="undefined";m.extend({Storage:{set:T?
ha:ba,get:T?ia:ja,remove:T?ka:la}});jQuery.fn.extend({everyTime:function(c,e,f,h,k){return this.each(function(){jQuery.timer.add(this,c,e,f,h,k)})},oneTime:function(c,e,f){return this.each(function(){jQuery.timer.add(this,c,e,f,1)})},stopTime:function(c,e){return this.each(function(){jQuery.timer.remove(this,c,e)})}});jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1E3,das:1E4,hs:1E5,ks:1E6},timeParse:function(c){if(c==E||c===null)return null;var e=this.regex.exec(jQuery.trim(c.toString()));
return e[2]?parseInt(e[1],10)*(this.powers[e[2]]||1):c},add:function(c,e,f,h,k,t){var y=0;if(jQuery.isFunction(f)){k||(k=h);h=f;f=e}e=jQuery.timer.timeParse(e);if(!(typeof e!="number"||isNaN(e)||e<=0)){if(k&&k.constructor!=Number){t=!!k;k=0}k=k||0;t=t||false;if(!c.$timers)c.$timers={};c.$timers[f]||(c.$timers[f]={});h.$timerID=h.$timerID||this.guid++;var n=function(){if(!(t&&this.inProgress)){this.inProgress=true;if(++y>k&&k!==0||h.call(c,y)===false)jQuery.timer.remove(c,f,h);this.inProgress=false}};
n.$timerID=h.$timerID;c.$timers[f][h.$timerID]||(c.$timers[f][h.$timerID]=window.setInterval(n,e));this.global[f]||(this.global[f]=[]);this.global[f].push(c)}},remove:function(c,e,f){var h=c.$timers,k;if(h){if(e){if(h[e]){if(f){if(f.$timerID){window.clearInterval(h[e][f.$timerID]);delete h[e][f.$timerID]}}else for(f in h[e]){window.clearInterval(h[e][f]);delete h[e][f]}for(k in h[e])break;if(!k){k=null;delete h[e]}}}else for(e in h)this.remove(c,e,f);for(k in h)break;if(!k)c.$timers=null}}}});if(jQuery.browser.msie)jQuery(window).one("unload",
function(){var c=jQuery.timer.global,e;for(e in c)for(var f=c[e],h=f.length;--h;)jQuery.timer.remove(f[h],e)});var ea;ea=ea||function(c){var e=String.prototype.split,f=/()??/.exec("")[1]===c,h;h=function(k,t,y){if(Object.prototype.toString.call(t)!=="[object RegExp]")return e.call(k,t,y);var n=[],D=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.extended?"x":"")+(t.sticky?"y":""),z=0;t=RegExp(t.source,D+"g");var J,x,F;k+="";f||(J=RegExp("^"+t.source+"$(?!\\s)",D));for(y=y===c?4294967295:y>>>0;x=t.exec(k);){D=
x.index+x[0].length;if(D>z){n.push(k.slice(z,x.index));!f&&x.length>1&&x[0].replace(J,function(){for(var I=1;I<arguments.length-2;I++)if(arguments[I]===c)x[I]=c});x.length>1&&x.index<k.length&&Array.prototype.push.apply(n,x.slice(1));F=x[0].length;z=D;if(n.length>=y)break}t.lastIndex===x.index&&t.lastIndex++}if(z===k.length){if(F||!t.test(""))n.push("")}else n.push(k.slice(z));return n.length>y?n.slice(0,y):n};String.prototype.split=function(k,t){return h(this,k,t)};return h}();var ma=/(\[\[[bius]*;[^;]*;[^\]]*\][^\]\[]*\])/g,
Y=/\[\[([bius]*);([^;]*);([^\]]*)\]([^\]\[]*)\]/g,ca=/#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})/;m.json_stringify=function(c,e){var f="",h;e=e===E?1:e;switch(typeof c){case "function":f+=c;break;case "boolean":f+=c?"true":"false";break;case "object":if(c===null)f+="null";else if(c instanceof Array){f+="[";var k=c.length;for(h=0;h<k-1;++h)f+=m.json_stringify(c[h],e+1);f+=m.json_stringify(c[k-1],e+1)+"]"}else{f+="{";for(k in c)if(c.hasOwnProperty(k))f+='"'+k+'":'+m.json_stringify(c[k],e+1);f+="}"}break;case "string":k=
c;var t={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};for(h in t)if(t.hasOwnProperty(h))k=k.replace(RegExp(h,"g"),t[h]);f+='"'+k+'"';break;case "number":f+=String(c)}f+=e>1?",":"";if(e==1)f=f.replace(/,([\]}])/g,"$1");return f.replace(/([\[{]),/g,"$1")};m.fn.cmd=function(c){function e(){l.toggleClass("inverted")}function f(){C="(reverse-i-search)`"+F+"': ";K()}function h(d){var q=G.data(),Q=RegExp("^"+F),A=q.length;if(d&&I>0)A-=I;for(d=A;d--;)if(Q.test(q[d])){I=q.length-
d;p=0;n.set(q[d],true);B();break}}function k(d){var q=d.substring(0,z-J);d=d.substring(z-J);return[q].concat(X(d,z))}function t(){D.focus();n.oneTime(1,function(){n.insert(D.val());D.blur().val("")})}function y(d){if(c.keydown&&c.keydown(d)===false)return false;if(M){var q;if(x&&(d.which==35||d.which==36||d.which==37||d.which==38||d.which==39||d.which==40||d.which==66||d.which==13||d.which==27)){C=U;x=false;I=null;F="";K();if(d.which==27)a="";B();y.call(this,d)}else if(d.altKey){if(d.which==68){n.set(a.slice(0,
p)+a.slice(p).replace(/[^ ]+ |[^ ]+$/,""),true);return false}return true}else if(d.keyCode==13){if(G&&a&&(c.historyFilter&&c.historyFilter(a)||!c.historyFilter))G.data().slice(-1)[0]!=a&&G.append(a);G.last();d=a;n.set("");c.commands&&c.commands(d);typeof C=="function"&&K()}else if(d.which==32)if(x){F+=" ";f()}else n.insert(" ");else if(d.which==8)if(x){F=F.slice(0,-1);f()}else{if(a!==""&&p>0){a=a.slice(0,p-1)+a.slice(p,a.length);--p;B()}}else if(d.which==9&&!(d.ctrlKey||d.altKey))n.insert("\t");else if(d.which==
46){if(a!==""&&p<a.length){a=a.slice(0,p)+a.slice(p+1,a.length);B()}return true}else if(G&&d.which==38||d.which==80&&d.ctrlKey)n.set(G.previous());else if(G&&d.which==40||d.which==78&&d.ctrlKey)n.set(G.next());else if(d.which==37||d.which==66&&d.ctrlKey)if(d.ctrlKey&&d.which!=66){q=p-1;d=0;for(a[q]==" "&&--q;q>0;--q)if(a[q]==" "&&a[q+1]!=" "){d=q+1;break}else if(a[q]=="\n"&&a[q+1]!="\n"){d=q;break}n.position(d)}else{if(p>0){--p;B()}}else if(d.which==82&&d.ctrlKey)if(x)h(true);else{U=C;f();a="";B();
x=true}else if(d.which==39||d.which==70&&d.ctrlKey)if(d.ctrlKey&&d.which!=70){a[p]==" "&&++p;d=a.slice(p).match(/\S[\n\s]{2,}|[\n\s]+\S?/);if(!d||d[0].match(/^\s+$/))p=a.length;else if(d[0][0]!=" ")p+=d.index+1;else{p+=d.index+d[0].length-1;d[0][d[0].length-1]!=" "&&--p}B()}else{if(p<a.length){++p;B()}}else if(d.which==123)return true;else if(d.which==36)n.position(0);else if(d.which==35)n.position(a.length);else if(d.ctrlKey||d.metaKey)if(d.shiftKey){if(d.which==84)return true}else if(d.which==65)n.position(0);
else if(d.which==69)n.position(a.length);else if(d.which==88||d.which==67||d.which==87||d.which==84)return true;else if(d.which==86){t();return true}else if(d.which==75)if(p===0)n.set("");else p!=a.length&&n.set(a.slice(0,p));else if(d.which==85){n.set(a.slice(p,a.length));n.position(0)}else{if(d.which==17)return true}else return true;return false}}var n=this;n.addClass("cmd");n.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');var D=m("<textarea/>").addClass("clipboard").appendTo(n);
c.width&&n.width(c.width);var z,J,x=false,F="",I=null,U,V=c.mask||false,a="",p=0,C,M=c.enabled,N,G,l=n.find(".cursor"),B=function(d){function q(g,o){if(o==g.length){b.html(H(g));l.html("&nbsp;");i.html("")}else if(o===0){b.html("");l.html(H(g.slice(0,1)));i.html(H(g.slice(1)))}else{var j=H(g.slice(0,o));b.html(j);j=g.slice(o,o+1);l.html(j==" "?"&nbsp;":H(j));o==g.length-1?i.html(""):i.html(H(g.slice(o+1)))}}function Q(g){return"<div>"+H(g)+"</div>"}function A(g){var o=i;m.each(g,function(j,u){o=m(Q(u)).insertAfter(o).addClass("clear")})}
function r(g){m.each(g,function(o,j){b.before(Q(j))})}var b=l.prev(),i=l.next();return function(){var g=V?a.replace(/./g,"*"):a,o;d.find("div").remove();b.html("");if(g.length>z-J-1||g.match(/\n/)){var j,u=g.match(/\t/g),s=u?u.length*3:0;if(u)g=g.replace(/\t/g,"\u0000\u0000\u0000\u0000");if(g.match(/\n/)){var w=g.split("\n"),v=z-J-1;for(o=0;o<w.length-1;++o)w[o]+=" ";if(w[0].length>v){j=[w[0].substring(0,v)];j=j.concat(X(w[0].substring(v),z))}else j=[w[0]];for(o=1;o<w.length;++o)if(w[o].length>z)j=
j.concat(X(w[o],z));else j.push(w[o])}else j=k(g);if(u)j=m.map(j,function(Z){return Z.replace(/\x00\x00\x00\x00/g,"\t")});v=j[0].length;if(p<v){q(j[0],p);A(j.slice(1))}else if(p==v){b.before(Q(j[0]));q(j[1],0);A(j.slice(2))}else{o=j.length;if(p<v){q(j[0],p);A(j.slice(1))}else if(p==v){b.before(Q(j[0]));q(j[1],0);A(j.slice(2))}else{u=j.slice(-1)[0];w=g.length-p;var L=u.length;g=0;if(w<=L){r(j.slice(0,-1));q(u,(L==w?0:L-w)+s)}else if(o==3){b.before("<div>"+H(j[0])+"</div>");q(j[1],p-v-1);i.after('<div class="clear">'+
H(j[2])+"</div>")}else{g=p;for(o=0;o<j.length;++o){s=j[o].length;if(g>s)g-=s;else break}s=j[o];v=o;if(g==s.length){g=0;s=j[++v]}q(s,g);r(j.slice(0,v));A(j.slice(v+1))}}}}else if(g===""){b.html("");l.html("&nbsp;");i.html("")}else q(g,p)}}(n),K=function(){var d=n.find(".prompt");return function(){if(typeof C=="string"){J=C.replace(Y,"$4").length;d.html(H(C))}else C(function(q){J=q.replace(Y,"$4").length;d.html(H(q))})}}();m.extend(n,{name:function(d){if(d!==E){N=d;G=new oa(d)}else return N},history:function(){return G},
set:function(d,q){if(d!==E){a=d;if(!q)p=a.length;B();if(typeof c.onCommandChange=="function")c.onCommandChange(a)}},insert:function(d,q){if(p==a.length)a+=d;else a=p===0?d+a:a.slice(0,p)+d+a.slice(p);q||(p+=d.length);B();if(typeof c.onCommandChange=="function")c.onCommandChange(a)},get:function(){return a},commands:function(d){if(d)c.commands=d;else return d},destroy:function(){m(document.documentElement).unbind(".commandline");n.find(".prompt").remove()},prompt:function(d){if(d===E)return C;else{if(typeof d==
"string"||typeof d=="function")C=d;else throw"prompt must be a function or string";K();B()}},position:function(d){if(typeof d=="number"){p=d<0?0:d>a.length?a.length:d;B()}else return p},show:function(){var d=n.show;return function(){d.apply(n,[]);B();K()}}(),resize:function(d){if(d)z=d;else{d=n.width();var q=l.innerWidth();z=Math.floor(d/q)}B()},enable:function(){if(!M){l.addClass("inverted");n.everyTime(500,"blink",e);M=true}},isenabled:function(){return M},disable:function(){if(M){n.stopTime("blink",
e);l.removeClass("inverted");M=false}},mask:function(d){if(typeof d=="boolean"){V=d;B()}else return V}});n.name(c.name||"");C=c.prompt||"> ";K();if(c.enabled===E||c.enabled===true)n.enable();m(m.browser.msie?document.documentElement:window).keypress(function(d){var q;if(d.ctrlKey&&d.which==99)return true;if(!x&&c.keypress)q=c.keypress(d);if(q===E||q){if(M)if([38,32,13,0,8].has(d.which)&&d.keyCode!=123&&!(d.which==38&&d.shiftKey))return false;else if(!d.ctrlKey&&!(d.altKey&&d.which==100)){if(x){F+=
String.fromCharCode(d.which);f();h()}else n.insert(String.fromCharCode(d.which));return false}else if(d.altKey)if(x){F+=String.fromCharCode(d.which);f();h()}else n.insert(String.fromCharCode(d.which))}else return q}).keydown(y);return n};m.jrpc=function(c,e,f,h,k,t){e=m.json_stringify({jsonrpc:"2.0",method:f,params:h,id:e});return m.ajax({url:c,data:e,success:k,error:t,contentType:"application/json",dataType:"json",async:true,cache:false,type:"POST"})};T=/ {14}$/;var pa=[["jQuery Terminal","(c) 2011 jcubic"],
["jQuery Terminal Emulator v. 0.4.17","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>".replace(/ *<.*>/,"")],["jQuery Terminal Emulator version version 0.4.17","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],["      _______                 ________                        __","     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/",
"         \\/          /____/                                   ".replace(T,"")+"version 0.4.17","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],["      __ _____                     ________                              __","     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/",
"          \\/              /____/                                          ".replace(T,"")+"version 0.4.17","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"]],$=[],O=new function(c){var e=c?[c]:[],f=0;m.extend(this,{rotate:function(){if(e.length==1)return e[0];else{if(f==e.length-1)f=0;else++f;return e[f]}},length:function(){return e.length},set:function(h){for(var k=e.length;k--;)if(e[k]===h){f=k;return}this.append(h)},front:function(){return e[f]},append:function(h){e.push(h)}})};m.fn.terminal=
function(c,e){function f(){return a.get(0).scrollHeight>a.innerHeight()}function h(){var b=a.find(".cursor").width(),i=Math.floor(a.width()/b);if(f()){var g=a.innerWidth()-a.width();i-=Math.ceil((20-g/2)/(b-1))}return i}function k(b,i){a.error("&#91;"+i+"&#93;: "+(typeof b=="string"?b:typeof b.fileName=="string"?b.fileName+": "+b.message:b.message));a.pause();typeof b.fileName=="string"&&m.get(b.fileName,function(g){a.resume();var o=b.lineNumber-1;(g=g.split("\n")[o])&&a.error("&#91;"+b.lineNumber+
"&#93;: "+g)})}function t(b,i){try{if(typeof i=="function")i(function(){});else if(typeof i!="string")throw b+" must be string or function";}catch(g){k(g,b.toUpperCase());return false}return true}function y(){var b=a.prop?a.prop("scrollHeight"):a.attr("scrollHeight");a.scrollTop(b)}function n(b){b=typeof b=="string"?b:String(b);var i,g,o;if(b.length>N){i=N;g=b.split(/\n/g);o=/(\[\[[bius]*;[^;]*;[^\]]*\][^\]\[]*\]?)/g;var j=/(\[\[[bius]*;[^;]*;[^\]]*\])/,u=/\[\[[bius]*;?[^;]*;?[^\]]*\]?$/,s=false,
w=false,v="";b=[];for(var L=0,Z=g.length;L<Z;++L){if(v!=="")if(g[L]===""){b.push(v+"]");continue}else{g[L]=v+g[L];v=""}else if(g[L]===""){b.push("");continue}for(var W=g[L],fa=0,aa=0,R=0,ga=W.length;R<ga;++R){if(W[R]=="["&&W[R+1]=="[")s=true;else if(s&&W[R]=="]")if(w)w=s=false;else w=true;else if(s&&w||!s)++aa;if(aa==i||R==ga-1){var P=W.substring(fa,R+1);if(v){P=v+P;if(P.match("]"))v=""}fa=R+1;aa=0;var S=P.match(o);if(S){S=S[S.length-1];if(S[S.length-1]!="]"){v=S.match(j)[1];P+="]"}else if(P.match(u)){P=
P.replace(u,"");v=S.match(j)[1]}}b.push(P)}}}i=m("<div></div>");g=0;for(o=b.length;g<o;++g)b[g]===""||b[g]=="\r"?i.append("<div>&nbsp;</div>"):m("<div/>").html(H(b[g])).appendTo(i)}else i=m("<div/>").html(H(b));C.append(i);i.width("100%");y();return i}function D(b,i){var g=1,o=function(j,u){i.pause();m.jrpc(b,g++,j,u,function(s){if(s.error)i.error("&#91;RPC&#93; "+s.error.message);else if(typeof s.result=="string")i.echo(s.result);else if(s.result instanceof Array)i.echo(s.result.join(" "));else if(typeof s.result==
"object"){var w="",v;for(v in s.result)if(s.result.hasOwnProperty(v))w+=v+": "+s.result[v]+"\n";i.echo(w)}i.resume()},function(s,w){i.error("&#91;AJAX&#93; "+w+" - Server reponse is: \n"+s.responseText);i.resume()})};return function(j,u){if(j!==""){var s,w;if(j.match(/[^ ]* /)){j=j.split(/ +/);s=j[0];w=j.slice(1)}else{s=j;w=[]}if(!l.login||s=="help")o(s,w);else{var v=u.token();v?o(s,[v].concat(w)):u.error("&#91;AUTH&#93; Access denied (no token)")}}}}function z(b){var i=r.prompt();if(r.mask())b=b.replace(/./g,
"*");typeof i=="function"?i(function(g){a.echo(g+b)}):a.echo(i+b)}function J(b){try{var i=A.top();if(b=="exit"&&l.exit)if(A.size()==1)if(l.login)F();else{z(b);a.echo("You can exit from main interpeter")}else a.pop("exit");else{z(b);b=="clear"&&l.clear?a.clear():i.eval(b,a)}}catch(g){k(g,"USER");a.resume();throw g;}}function x(){var b=null;r.prompt("login: ");l.history&&r.history().disable();r.commands(function(i){try{z(i);if(b){r.mask(false);a.pause();if(typeof l.login!="function")throw"Value of login property must be a function";
l.login(b,i,function(o){if(o){var j=l.name;j=j?"_"+j:"";m.Storage.set("token"+j,o);m.Storage.set("login"+j,b);r.commands(J);U()}else{a.error("Wrong password try again");r.prompt("login: ");b=null}a.resume();l.history&&r.history().enable()})}else{b=i;r.prompt("password: ");r.mask(true)}}catch(g){k(g,"LOGIN",a);throw g;}})}function F(){var b=l.name;b=b?"_"+b:"";m.Storage.remove("token"+b,null);m.Storage.remove("login"+b,null);l.history&&r.history().disable();x()}function I(){var b=A.top(),i="";if(b.name!==
E&&b.name!=="")i+=b.name+"_";i+=M;r.name(i);b.prompt.constructor==Function?r.prompt(function(g){b.prompt(g,a)}):r.prompt(b.prompt);l.history&&r.history().enable();r.set("");if(typeof b.onStart=="function")b.onStart(a)}function U(){I();if(e.greetings===E)a.echo(a.signature);else e.greetings&&a.echo(e.greetings);if(typeof l.onInit=="function")l.onInit(a)}function V(b){a.oneTime(5,function(){if(d!=f()){a.resize();d=f()}});if(a.paused()){if(l.cancelableAjax)if(b.which==68&&b.ctrlKey){for(b=$.length;b--;){var i=
$[b];if(4!=i.readyState)try{i.abort()}catch(g){a.error("error in aborting ajax")}}a.resume();return false}}else{if(l.keydown&&l.keydown(b,a)===false)return false;if(b.which!=9)K=0;if(b.which==68&&b.ctrlKey){if(r.get()==="")if(A.size()>1||l.login!==E)a.pop("");else{a.resume();a.echo("")}else a.set_command("");return false}else if(l.tabcompletion&&b.which==9){++K;i=r.get();if(!i.match(" ")){var o=RegExp("^"+i),j=A.top().command_list,u=[];for(b=j.length;b--;)o.test(j[b])&&u.push(j[b]);if(u.length==1)a.set_command(u[0]);
else if(u.length>1)if(K>=2){z(i);a.echo(u.join("\t"));K=0}}return false}else if(b.which==86&&b.ctrlKey){a.oneTime(1,function(){y()});return true}else if(b.which==9&&b.ctrlKey){O.length()>1&&a.focus(false);return false}else if(b.which==34)a.scroll(a.height());else b.which==33?a.scroll(-a.height()):a.attr({scrollTop:a.attr("scrollHeight")})}}var a=this,p=[],C,M=O.length(),N,G=[],l={name:"",prompt:"> ",history:true,exit:true,clear:true,enabled:true,cancelableAjax:true,login:null,tabcompletion:null,historyFilter:null,
onInit:null,onExit:null,keypress:null,keydown:null};if(e){e.width&&a.width(e.width);e.height&&a.height(e.height);m.extend(l,e)}var B=!l.enabled;if(a.length===0)throw'Sorry, but terminal said that "'+a.selector+'" is not valid selector!';a.ajaxSend(function(b,i){$.push(i)});if(a.data("terminal"))return a.data("terminal");C=m("<div>").addClass("terminal-output").appendTo(a);a.addClass("terminal").append("<div/>");m.extend(a,{clear:function(){C.html("");r.set("");p=[];a.attr({scrollTop:0});return a},
paused:function(){return B},pause:function(){if(r){a.disable();r.hide()}return a},resume:function(){if(r){a.enable();r.show();y()}return a},cols:function(){return N},rows:function(){return p.length},history:function(){return r.history()},next:function(){if(O.length()==1)return a;else{var b=a.offset().top;a.height();a.scrollTop();var i=a,g=m(window).scrollTop(),o=g+m(window).height(),j=m(i).offset().top;if(j+m(i).height()>=g&&j<=o){O.front().disable();b=O.rotate().enable();i=b.offset().top-50;m("html,body").animate({scrollTop:i},
500);return b}else{a.enable();m("html,body").animate({scrollTop:b-50},500);return a}}},focus:function(b){a.oneTime(1,function(){if(O.length()==1)b===false?a.disable():a.enable();else if(b===false)a.next();else{O.front().disable();O.set(a);a.enable()}});return a},enable:function(){N===E&&a.resize();if(B)if(r){r.enable();B=false}return a},disable:function(){if(r){B=true;r.disable()}return a},enabled:function(){return B},signature:function(){var b=a.cols();b=b<15?null:b<35?0:b<55?1:b<64?2:b<75?3:4;return b!==
null?pa[b].join("\n")+"\n":""},version:function(){return"0.4.17"},get_command:function(){return r.get()},insert:function(b){if(typeof b=="string"){r.insert(b);return a}else throw"insert function argument is not a string";},set_prompt:function(b){if(t("prompt",b)){b.constructor==Function?r.prompt(function(i){b(i,a)}):r.prompt(b);A.top().prompt=b}return a},get_prompt:function(){return A.top().prompt},set_command:function(b){r.set(b);return a},set_mask:function(b){r.mask(b);return a},get_output:function(b){return b?
p:m.map(p,function(i,g){return typeof g=="function"?g():g}).get().join("\n")},resize:function(b,i){if(b&&i){a.width(b);a.height(i)}N=h();r.resize(N);var g=C.detach();C.html("");m.each(p,function(o,j){n(j.constructor==Function?j():j)});a.prepend(g);y();return a},echo:function(b){p.push(b);return n(typeof b=="function"?b():b)},error:function(b){a.echo("[[;#f00;]"+b.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")+"]")},scroll:function(b){var i;if(a.prop){b>a.prop("scrollTop")&&b>0&&a.prop("scrollTop",
0);i=a.prop("scrollTop");a.prop("scrollTop",i+b)}else{b>a.attr("scrollTop")&&b>0&&a.attr("scrollTop",0);i=a.attr("scrollTop");a.attr("scrollTop",i+b)}return a},logout:l.login?function(){for(;A.size()>1;)A.pop();F();return a}:function(){throw"You don't have login function";},token:l.login?function(){var b=l.name;return m.Storage.get("token"+(b?"_"+b:""))}:null,login_name:l.login?function(){var b=l.name;return m.Storage.get("login"+(b?"_"+b:""))}:null,name:function(){return l.name},push:function(b,
i){if(!i.prompt||t("prompt",i.prompt)){if(typeof b=="string")b=D(i.eval,a);A.push(m.extend({eval:b},i));I()}return a},pop:function(b){b!==E&&z(b);if(A.top().name===l.name){if(l.login){F();if(typeof l.onExit=="function")l.onExit(a)}}else{b=A.pop();I();if(typeof b.onExit=="function")b.onExit(a)}return a}});var K=0,d=f(),q;if(l.login&&typeof l.onBeforeLogin=="function")l.onBeforeLogin(a);if(c.constructor==String){q=c;c=D(c,a)}else if(c.constructor==Array)throw"You can't use array as eval";else if(typeof c==
"object"){for(var Q in c)G.push(Q);c=function b(i){return function(g){if(g!==""){g=g.split(/ +/);var o=g[0],j=g.slice(1);g=i[o];var u=typeof g;if(u=="function")g.apply(a,j);else if(u=="object"||u=="string"){j=[];if(u=="object"){for(var s in g)j.push(s);g=b(g)}a.push(g,{prompt:o+"> ",name:o,command_list:j})}else a.error("Command '"+o+"' Not Found")}}}(c)}else if(typeof c!="function")throw'Unknow object "'+String(c)+'" passed as eval';if(q&&(typeof l.login=="string"||l.login))l.login=function(b){var i=
1;return function(g,o,j){a.pause();m.jrpc(q,i++,b,[g,o],function(u){a.resume();!u.error&&u.result?j(u.result):j(null)},function(u,s){a.resume();a.error("&#91;AJAX&#92; Response: "+s+"\n"+u.responseText)})}}(typeof l.login=="boolean"?"login":l.login);if(t("prompt",l.prompt)){var A=new na({name:l.name,eval:c,prompt:l.prompt,command_list:G,greetings:l.greetings}),r=a.find(".terminal-output").next().cmd({prompt:l.prompt,history:l.history,historyFilter:l.historyFilter,width:"100%",keydown:V,keypress:l.keypress?
function(b){return l.keypress(b,a)}:null,onCommandChange:function(b){if(typeof l.onCommandChange=="function")l.onCommandChange(b,a);y()},commands:J});O.append(a);l.enabled===true?a.focus():a.disable();m(window).resize(a.resize);a.click(function(){a.focus()});a.token&&!a.token()&&a.login_name&&!a.login_name()?x():U();typeof m.fn.init.prototype.mousewheel==="function"&&a.mousewheel(function(b,i){i>0?a.scroll(-40):a.scroll(40);return false},true)}a.data("terminal",a);return a}})(jQuery);
