/*

 |       __ _____                     ________                              __
 |      / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /
 |  __ / // // // // // _  // _// // / / // _  // _//     // //  \/ // _ \/ /
 | /  / // // // // // ___// / / // / / // ___// / / / / // // /\  // // / /__
 | \___//____ \\___//____//_/ _\_  / /_//____//_/ /_/ /_//_//_/ /_/ \__\_\___/
 |           \/              /____/                              version 0.4.19
 http://terminal.jcubic.pl

 Licensed under GNU LGPL Version 3 license
 Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>

 Includes:

 Storage plugin Distributed under the MIT License
 Copyright (c) 2010 Dave Schindler

 jQuery Timers licenced with the WTFPL
 <http://jquery.offput.ca/every/>

 Cross-Browser Split 1.1.1
 Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
 Available under the MIT License

 Date: Sun, 23 Sep 2012 15:24:36 +0000
*/
(function(k,J){function Y(c,e){var f;if(typeof c==="string"&&typeof e==="string"){localStorage[c]=e;return true}else if(typeof c==="object"&&typeof e==="undefined"){for(f in c)if(c.hasOwnProperty(f))localStorage[f]=c[f];return true}return false}function U(c,e){var f,g;f=new Date;f.setTime(f.getTime()+31536E6);f="; expires="+f.toGMTString();if(typeof c==="string"&&typeof e==="string"){document.cookie=c+"="+e+f+"; path=/";return true}else if(typeof c==="object"&&typeof e==="undefined"){for(g in c)if(c.hasOwnProperty(g))document.cookie=
g+"="+c[g]+f+"; path=/";return true}return false}function Z(c){return localStorage[c]}function $(c){var e,f,g;c+="=";e=document.cookie.split(";");for(f=0;f<e.length;f++){for(g=e[f];g.charAt(0)===" ";)g=g.substring(1,g.length);if(g.indexOf(c)===0)return g.substring(c.length,g.length)}return null}function aa(c){return delete localStorage[c]}function ba(c){return U(c,"",-1)}function R(c,e){var f=[],g=c.length;if(g<e)return[c];for(var h=0;h<g;h+=e)f.push(c.substring(h,h+e));return f}function V(c){var e=
c instanceof Array?c:c?[c]:[],f=0;k.extend(this,{left:function(){if(f===0)f=e.length-1;else--f;return e[f]},right:function(){if(f===e.length-1)f=0;else++f;return e[f]},current:function(){return e[f]},data:function(){return e},length:function(){return e.length},reset:function(){f=0},append:function(g){e.push(g);this.reset()}})}function ca(c){var e=c?[c]:[];k.extend(this,{size:function(){return e.length},pop:function(){if(e.length===0)return null;else{var f=e[e.length-1];e=e.slice(0,e.length-1);return f}},
push:function(f){e=e.concat([f]);return f},top:function(){return e.length>0?e[e.length-1]:null}})}function da(c){var e=true;if(typeof c==="string"&&c!=="")c+="_";var f=k.Storage.get(c+"commands"),g=new V(f?eval("("+f+")"):[""]);k.extend(this,{append:function(h){if(e){g.append(h);k.Storage.set(c+"commands",k.json_stringify(g.data()))}},data:function(){return g.data()},next:function(){return g.right()},last:function(){g.reset()},previous:function(){return g.left()},clear:function(){g=new V;k.Storage.remove(c+
"commands")},enable:function(){e=true},disable:function(){e=false}})}k.omap=function(c,e){var f={};k.each(c,function(g,h){f[g]=e.call(c,g,h)});return f};var Q=typeof window.localStorage!=="undefined";k.extend({Storage:{set:Q?Y:U,get:Q?Z:$,remove:Q?aa:ba}});jQuery.fn.extend({everyTime:function(c,e,f,g,h){return this.each(function(){jQuery.timer.add(this,c,e,f,g,h)})},oneTime:function(c,e,f){return this.each(function(){jQuery.timer.add(this,c,e,f,1)})},stopTime:function(c,e){return this.each(function(){jQuery.timer.remove(this,
c,e)})}});jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1E3,das:1E4,hs:1E5,ks:1E6},timeParse:function(c){if(c===J||c===null)return null;var e=this.regex.exec(jQuery.trim(c.toString()));return e[2]?parseInt(e[1],10)*(this.powers[e[2]]||1):c},add:function(c,e,f,g,h,p){var t=0;if(jQuery.isFunction(f)){h||(h=g);g=f;f=e}e=jQuery.timer.timeParse(e);if(!(typeof e!=="number"||isNaN(e)||e<=0)){if(h&&h.constructor!==Number){p=!!h;h=0}h=h||0;p=p||false;if(!c.$timers)c.$timers=
{};c.$timers[f]||(c.$timers[f]={});g.$timerID=g.$timerID||this.guid++;var l=function(){if(!(p&&l.inProgress)){l.inProgress=true;if(++t>h&&h!==0||g.call(c,t)===false)jQuery.timer.remove(c,f,g);l.inProgress=false}};l.$timerID=g.$timerID;c.$timers[f][g.$timerID]||(c.$timers[f][g.$timerID]=window.setInterval(l,e));this.global[f]||(this.global[f]=[]);this.global[f].push(c)}},remove:function(c,e,f){var g=c.$timers,h;if(g){if(e){if(g[e]){if(f){if(f.$timerID){window.clearInterval(g[e][f.$timerID]);delete g[e][f.$timerID]}}else for(var p in g[e])if(g[e].hasOwnProperty(p)){window.clearInterval(g[e][p]);
delete g[e][p]}for(h in g[e])if(g[e].hasOwnProperty(h))break;if(!h){h=null;delete g[e]}}}else for(var t in g)g.hasOwnProperty(t)&&this.remove(c,t,f);for(h in g)if(g.hasOwnProperty(h))break;if(!h)c.$timers=null}}}});if(jQuery.browser.msie)jQuery(window).one("unload",function(){var c=jQuery.timer.global,e;for(e in c)if(c.hasOwnProperty(e))for(var f=c[e],g=f.length;--g;)jQuery.timer.remove(f[g],e)});(function(c){if(String.prototype.split.toString().match(/\[native/)){var e=String.prototype.split,f=/()??/.exec("")[1]===
c,g;g=function(h,p,t){if(Object.prototype.toString.call(p)!=="[object RegExp]")return e.call(h,p,t);var l=[],v=(p.ignoreCase?"i":"")+(p.multiline?"m":"")+(p.extended?"x":"")+(p.sticky?"y":""),x=0,E,y,C;p=RegExp(p.source,v+"g");h+="";f||(E=RegExp("^"+p.source+"$(?!\\s)",v));for(t=t===c?4294967295:t>>>0;y=p.exec(h);){v=y.index+y[0].length;if(v>x){l.push(h.slice(x,y.index));!f&&y.length>1&&y[0].replace(E,function(){for(var F=1;F<arguments.length-2;F++)if(arguments[F]===c)y[F]=c});y.length>1&&y.index<
h.length&&Array.prototype.push.apply(l,y.slice(1));C=y[0].length;x=v;if(l.length>=t)break}p.lastIndex===y.index&&p.lastIndex++}if(x===h.length){if(C||!p.test(""))l.push("")}else l.push(h.slice(x));return l.length>t?l.slice(0,t):l};String.prototype.split=function(h,p){return g(this,h,p)};return g}})();k.json_stringify=function(c,e){var f="",g;e=e===J?1:e;switch(typeof c){case "function":f+=c;break;case "boolean":f+=c?"true":"false";break;case "object":if(c===null)f+="null";else if(c instanceof Array){f+=
"[";var h=c.length;for(g=0;g<h-1;++g)f+=k.json_stringify(c[g],e+1);f+=k.json_stringify(c[h-1],e+1)+"]"}else{f+="{";for(h in c)if(c.hasOwnProperty(h))f+='"'+h+'":'+k.json_stringify(c[h],e+1);f+="}"}break;case "string":h=c;var p={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};for(g in p)if(p.hasOwnProperty(g))h=h.replace(RegExp(g,"g"),p[g]);f+='"'+h+'"';break;case "number":f+=String(c)}f+=e>1?",":"";if(e===1)f=f.replace(/,([\]}])/g,"$1");return f.replace(/([\[{]),/g,"$1")};k.fn.cmd=
function(c){function e(){m.toggleClass("inverted")}function f(){z="(reverse-i-search)`"+C+"': ";L()}function g(d){var s=H.data(),M=RegExp("^"+C),A=s.length;if(d&&F>0)A-=F;for(d=A;d--;)if(M.test(s[d])){F=s.length-d;n=0;l.set(s[d],true);D();break}}function h(d){var s=d.substring(0,x-E);d=d.substring(x-E);return[s].concat(R(d,x))}function p(){v.focus();l.oneTime(1,function(){l.insert(v.val());v.blur().val("")})}function t(d){if(c.keydown&&c.keydown(d)===false)return false;if(N){var s;if(y&&(d.which===
35||d.which===36||d.which===37||d.which===38||d.which===39||d.which===40||d.which===66||d.which===13||d.which===27)){z=K;y=false;F=null;C="";L();if(d.which===27)a="";D();t.call(this,d)}else if(d.altKey){if(d.which===68){l.set(a.slice(0,n)+a.slice(n).replace(/[^ ]+ |[^ ]+$/,""),true);return false}return true}else if(d.keyCode===13){if(H&&a&&(c.historyFilter&&c.historyFilter(a)||!c.historyFilter))H.data().slice(-1)[0]!==a&&H.append(a);H.last();d=a;l.set("");c.commands&&c.commands(d);typeof z==="function"&&
L()}else if(d.which===32)if(y){C+=" ";f()}else l.insert(" ");else if(d.which===8)if(y){C=C.slice(0,-1);f()}else{if(a!==""&&n>0){a=a.slice(0,n-1)+a.slice(n,a.length);--n;D()}}else if(d.which===9&&!(d.ctrlKey||d.altKey))l.insert("\t");else if(d.which===46){if(a!==""&&n<a.length){a=a.slice(0,n)+a.slice(n+1,a.length);D()}return true}else if(H&&d.which===38||d.which===80&&d.ctrlKey)l.set(H.previous());else if(H&&d.which===40||d.which===78&&d.ctrlKey)l.set(H.next());else if(d.which===37||d.which===66&&
d.ctrlKey)if(d.ctrlKey&&d.which!==66){s=n-1;d=0;for(a[s]===" "&&--s;s>0;--s)if(a[s]===" "&&a[s+1]!==" "){d=s+1;break}else if(a[s]==="\n"&&a[s+1]!=="\n"){d=s;break}l.position(d)}else{if(n>0){--n;D()}}else if(d.which===82&&d.ctrlKey)if(y)g(true);else{K=z;f();a="";D();y=true}else if(d.which===39||d.which===70&&d.ctrlKey)if(d.ctrlKey&&d.which!==70){a[n]===" "&&++n;d=a.slice(n).match(/\S[\n\s]{2,}|[\n\s]+\S?/);if(!d||d[0].match(/^\s+$/))n=a.length;else if(d[0][0]!==" ")n+=d.index+1;else{n+=d.index+d[0].length-
1;d[0][d[0].length-1]!==" "&&--n}D()}else{if(n<a.length){++n;D()}}else if(d.which===123)return true;else if(d.which===36)l.position(0);else if(d.which===35)l.position(a.length);else if(d.ctrlKey||d.metaKey)if(d.shiftKey){if(d.which===84)return true}else if(d.which===65)l.position(0);else if(d.which===69)l.position(a.length);else if(d.which===88||d.which===67||d.which===87||d.which===84)return true;else if(d.which===86){p();return true}else if(d.which===75)if(n===0)l.set("");else n!==a.length&&l.set(a.slice(0,
n));else if(d.which===85){l.set(a.slice(n,a.length));l.position(0)}else{if(d.which===17)return true}else return true;return false}}var l=this;l.addClass("cmd");l.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');var v=k("<textarea/>").addClass("clipboard").appendTo(l);c.width&&l.width(c.width);var x,E,y=false,C="",F=null,K,I=c.mask||false,a="",n=0,z,N=c.enabled,O,H,m=l.find(".cursor"),D=function(d){function s(j,r){if(r===j.length){b.html(k.terminal.encode(j));
m.html("&nbsp;");i.html("")}else if(r===0){b.html("");m.html(k.terminal.encode(j.slice(0,1)));i.html(k.terminal.encode(j.slice(1)))}else{var o=k.terminal.encode(j.slice(0,r));b.html(o);o=j.slice(r,r+1);m.html(o===" "?"&nbsp;":k.terminal.encode(o));r===j.length-1?i.html(""):i.html(k.terminal.encode(j.slice(r+1)))}}function M(j){return"<div>"+k.terminal.encode(j)+"</div>"}function A(j){var r=i;k.each(j,function(o,q){r=k(M(q)).insertAfter(r).addClass("clear")})}function u(j){k.each(j,function(r,o){b.before(M(o))})}
var b=m.prev(),i=m.next();return function(){var j=I?a.replace(/./g,"*"):a,r,o;d.find("div").remove();b.html("");if(j.length>x-E-1||j.match(/\n/)){var q,w=j.match(/\t/g),G=w?w.length*3:0;if(w)j=j.replace(/\t/g,"\u0000\u0000\u0000\u0000");if(j.match(/\n/)){var B=j.split("\n");o=x-E-1;for(r=0;r<B.length-1;++r)B[r]+=" ";if(B[0].length>o){q=[B[0].substring(0,o)];q=q.concat(R(B[0].substring(o),x))}else q=[B[0]];for(r=1;r<B.length;++r)if(B[r].length>x)q=q.concat(R(B[r],x));else q.push(B[r])}else q=h(j);
if(w)q=k.map(q,function(ea){return ea.replace(/\x00\x00\x00\x00/g,"\t")});o=q[0].length;if(n<o){s(q[0],n);A(q.slice(1))}else if(n===o){b.before(M(q[0]));s(q[1],0);A(q.slice(2))}else{r=q.length;if(n<o){s(q[0],n);A(q.slice(1))}else if(n===o){b.before(M(q[0]));s(q[1],0);A(q.slice(2))}else{w=q.slice(-1)[0];B=j.length-n;var S=w.length;j=0;if(B<=S){u(q.slice(0,-1));s(w,(S===B?0:S-B)+G)}else if(r===3){b.before("<div>"+k.terminal.encode(q[0])+"</div>");s(q[1],n-o-1);i.after('<div class="clear">'+k.terminal.encode(q[2])+
"</div>")}else{j=n;for(r=0;r<q.length;++r){o=q[r].length;if(j>o)j-=o;else break}o=q[r];G=r;if(j===o.length){j=0;o=q[++G]}s(o,j);u(q.slice(0,G));A(q.slice(G+1))}}}}else if(j===""){b.html("");m.html("&nbsp;");i.html("")}else s(j,n)}}(l),L=function(){var d=l.find(".prompt");return function(){if(typeof z==="string"){E=k.terminal.strip(z).length;d.html(k.terminal.format(z))}else z(function(s){E=k.terminal.strip(s).length;d.html(k.terminal.format(s))})}}();k.extend(l,{name:function(d){if(d!==J){O=d;H=new da(d)}else return O},
history:function(){return H},set:function(d,s){if(d!==J){a=d;if(!s)n=a.length;D();if(typeof c.onCommandChange==="function")c.onCommandChange(a)}},insert:function(d,s){if(n===a.length)a+=d;else a=n===0?d+a:a.slice(0,n)+d+a.slice(n);s||(n+=d.length);D();if(typeof c.onCommandChange==="function")c.onCommandChange(a)},get:function(){return a},commands:function(d){if(d)c.commands=d;else return d},destroy:function(){k(document.documentElement).unbind(".commandline");l.find(".prompt").remove()},prompt:function(d){if(d===
J)return z;else{if(typeof d==="string"||typeof d==="function")z=d;else throw"prompt must be a function or string";L();D()}},position:function(d){if(typeof d==="number"){n=d<0?0:d>a.length?a.length:d;D()}else return n},show:function(){var d=l.show;return function(){d.apply(l,[]);D();L()}}(),resize:function(d){if(d)x=d;else{d=l.width();var s=m.innerWidth();x=Math.floor(d/s)}D()},enable:function(){if(!N){m.addClass("inverted");l.everyTime(500,"blink",e);N=true}},isenabled:function(){return N},disable:function(){if(N){l.stopTime("blink",
e);m.removeClass("inverted");N=false}},mask:function(d){if(typeof d==="boolean"){I=d;D()}else return I}});l.name(c.name||"");z=c.prompt||"> ";L();if(c.enabled===J||c.enabled===true)l.enable();k(k.browser.msie?document.documentElement:window).keypress(function(d){var s;if(d.ctrlKey&&d.which===99)return true;if(!y&&c.keypress)s=c.keypress(d);if(s===J||s){if(N)if(k.inArray(d.which,[38,32,13,0,8])>-1&&d.keyCode!==123&&!(d.which===38&&d.shiftKey))return false;else if(!d.ctrlKey&&!(d.altKey&&d.which===
100)){if(y){C+=String.fromCharCode(d.which);f();g()}else l.insert(String.fromCharCode(d.which));return false}else if(d.altKey)if(y){C+=String.fromCharCode(d.which);f();g()}else l.insert(String.fromCharCode(d.which))}else return s}).keydown(t);return l};var fa=/(\[\[[gbius]*;[^;]*;[^\]]*\][^\]\[]*\])/g,W=/\[\[([gbius]*);([^;]*);([^\]]*)\]([^\]\[]*)\]/g,X=/#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})/,ga=/(https?:((?!&[^;]+;)[^\s:"'])+)/g,ha=/((([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,})))/g;
k.terminal={split_equal:function(c,e){for(var f=c.split(/\n/g),g=/(\[\[[gbius]*;[^;]*;[^\]]*\][^\]\[]*\]?)/g,h=/(\[\[[gbius]*;[^;]*;[^\]]*\])/,p=/\[\[[gbius]*;?[^;]*;?[^\]]*\]?$/,t=false,l=false,v="",x=[],E=0,y=f.length;E<y;++E){if(v!=="")if(f[E]===""){x.push(v+"]");continue}else{f[E]=v+f[E];v=""}else if(f[E]===""){x.push("");continue}for(var C=f[E],F=0,K=0,I=0,a=C.length;I<a;++I){if(C[I]==="["&&C[I+1]==="[")t=true;else if(t&&C[I]==="]")if(l)l=t=false;else l=true;else if(t&&l||!t)++K;if(K===e||I===
a-1){var n=C.substring(F,I+1);if(v){n=v+n;if(n.match("]"))v=""}F=I+1;K=0;var z=n.match(g);if(z){z=z[z.length-1];if(z[z.length-1]!=="]"){v=z.match(h)[1];n+="]"}else if(n.match(p)){n=n.replace(p,"");v=z.match(h)[1]}}x.push(n)}}}return x},encode:function(c){return c.replace(/&(?!#[0-9]+;|[a-zA-Z]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/>").replace(/ /g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")},format:function(c){if(typeof c==="string"){c=k.terminal.encode(k.terminal.from_ansi(c));
var e=c.split(fa);if(e&&e.length>1)c=k.map(e,function(f){return f===""?f:f.substring(0,1)==="["?f.replace(W,function(g,h,p,t,l){if(l==="")return"<span>&nbsp;</span>";g="";if(h.indexOf("b")!==-1)g+="font-weight:bold;";var v="text-decoration:";if(h.indexOf("u")!==-1)v+="underline ";if(h.indexOf("s")!==-1)v+="line-through";if(h.indexOf("s")!==-1||h.indexOf("u")!==-1)g+=v+";";if(h.indexOf("i")!==-1)g+="font-style:italic;";if(p.match(X)){g+="color:"+p+";";if(h.indexOf("g")!==-1)g+="text-shadow: 0 0 5px "+
p+";"}if(t.match(X))g+="background-color:"+t;return c='<span style="'+g+'">'+l+"</span>"}):"<span>"+f+"</span>"}).join("");return c.replace(ga,'<a target="_blank" href="$1">$1</a>').replace(ha,'<a href="mailto:$1">$1</a>')}else return""},strip:function(c){return c.replace(W,"$4")},active:function(){},ansi_colors:{normal:{black:"#000",red:"#AA0000",green:"#008400",yellow:"#AA5500",blue:"#0000AA",magenta:"#AA00AA",cyan:"#00AAAA",white:"#fff"},bold:{white:"#fff",red:"#FF5555",green:"#44D544",yellow:"#FFFF55",
blue:"#5555FF",magenta:"#FF55FF",cyan:"#55FFFF",black:"#000"}},from_ansi:function(){function c(g){var h=g.split(";"),p;g=[];var t="",l="",v;for(v in h){p=parseInt(h[v],10);p===1&&g.push("b");p===4&&g.push("u");if(f[p])l=f[p];if(e[p])t=e[p]}p=h=k.terminal.ansi_colors.normal;for(v=g.length;v--;)if(g[v]=="b"){if(t=="")t="white";p=k.terminal.ansi_colors.bold;break}return"[["+[g.join(""),p[t],h[l]].join(";")+"]"}var e={30:"black",31:"red",32:"green",33:"yellow",34:"blue",35:"magenta",36:"cyan",37:"white"},
f={40:"black",41:"red",42:"green",43:"yellow",44:"blue",45:"magenta",46:"cyan",47:"white"};return function(g){var h=g.split(/(\[[0-9;]*m)/g);if(h.length==1)return g;g=[];if(h.length>3&&h.slice(0,3).join("")=="[0m")h=h.slice(3);for(var p=false,t=0;t<h.length;++t){var l=h[t].match(/^\[([0-9;]*)m$/);if(l){if(l[1]!="")if(p){g.push("]");if(l[1]=="0")p=false;else g.push(c(l[1]))}else{p=true;g.push(c(l[1]))}}else g.push(h[t])}p&&g.push("]");return g.join("")}}()};k.jrpc=function(c,e,f,g,h,p){e=k.json_stringify({jsonrpc:"2.0",
method:f,params:g,id:e});return k.ajax({url:c,data:e,success:h,error:p,contentType:"application/json",dataType:"json",async:true,cache:false,type:"POST"})};Q=/ {14}$/;var ia=[["jQuery Terminal","(c) 2011 jcubic"],["jQuery Terminal Emulator v. 0.4.19","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>".replace(/ *<.*>/,"")],["jQuery Terminal Emulator version version 0.4.19","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],["      _______                 ________                        __",
"     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/","         \\/          /____/                                   ".replace(Q,"")+"version 0.4.19","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],["      __ _____                     ________                              __",
"     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/","          \\/              /____/                                          ".replace(Q,"")+"version 0.4.19","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"]],T=[],P=new function(c){var e=
c?[c]:[],f=0;k.extend(this,{rotate:function(){if(e.length===1)return e[0];else{if(f===e.length-1)f=0;else++f;return e[f]}},length:function(){return e.length},set:function(g){for(var h=e.length;h--;)if(e[h]===g){f=h;return}this.append(g)},front:function(){return e[f]},append:function(g){e.push(g)}})};k.fn.terminal=function(c,e){function f(){return a.get(0).scrollHeight>a.innerHeight()}function g(){var b=a.find(".cursor").width(),i=Math.floor(a.width()/b);if(f()){var j=a.innerWidth()-a.width();i-=Math.ceil((20-
j/2)/(b-1))}return i}function h(b,i){a.error("&#91;"+i+"&#93;: "+(typeof b==="string"?b:typeof b.fileName==="string"?b.fileName+": "+b.message:b.message));if(typeof b.fileName==="string"){a.pause();k.get(b.fileName,function(j){a.resume();var r=b.lineNumber-1;(j=j.split("\n")[r])&&a.error("&#91;"+b.lineNumber+"&#93;: "+j)})}b.stack&&a.error(b.stack)}function p(b,i){try{if(typeof i==="function")i(function(){});else if(typeof i!=="string")throw b+" must be string or function";}catch(j){h(j,b.toUpperCase());
return false}return true}function t(){var b=a.prop?a.prop("scrollHeight"):a.attr("scrollHeight");a.scrollTop(b)}function l(b){b=typeof b==="string"?b:String(b);var i,j;if(b.length>O){var r=k.terminal.split_equal(b,O);b=k("<div></div>");i=0;for(j=r.length;i<j;++i)r[i]===""||r[i]==="\r"?b.append("<div>&nbsp;</div>"):k("<div/>").html(k.terminal.format(r[i])).appendTo(b)}else b=k("<div/>").html(k.terminal.format(b));z.append(b);b.width("100%");t();return b}function v(b,i){var j=1,r=function(o,q){i.pause();
k.jrpc(b,j++,o,q,function(w){if(w.error)i.error("&#91;RPC&#93; "+w.error.message);else if(typeof w.result==="string")i.echo(w.result);else if(w.result instanceof Array)i.echo(w.result.join(" "));else if(typeof w.result==="object"){var G="",B;for(B in w.result)if(w.result.hasOwnProperty(B))G+=B+": "+w.result[B]+"\n";i.echo(G)}i.resume()},function(w,G){i.error("&#91;AJAX&#93; "+G+" - Server reponse is: \n"+w.responseText);i.resume()})};return function(o,q){if(o!==""){var w,G;if(o.match(/[^ ]* /)){o=
o.split(/ +/);w=o[0];G=o.slice(1)}else{w=o;G=[]}if(!m.login||w==="help")r(w,G);else{var B=q.token();B?r(w,[B].concat(G)):q.error("&#91;AUTH&#93; Access denied (no token)")}}}}function x(b){b=b.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;");var i=u.prompt();if(u.mask())b=b.replace(/./g,"*");typeof i==="function"?i(function(j){a.echo(j+b)}):a.echo(i+b)}function E(b){try{var i=A.top();if(b==="exit"&&m.exit)if(A.size()===1)if(m.login)C();else{x(b);a.echo("You can exit from main interpeter")}else a.pop("exit");
else{x(b);b==="clear"&&m.clear?a.clear():i.eval(b,a)}}catch(j){h(j,"USER");a.resume();throw j;}}function y(){var b=null;u.prompt("login: ");m.history&&u.history().disable();u.commands(function(i){try{x(i);if(b){u.mask(false);a.pause();if(typeof m.login!=="function")throw"Value of login property must be a function";m.login(b,i,function(r){if(r){var o=m.name;o=o?"_"+o:"";k.Storage.set("token"+o,r);k.Storage.set("login"+o,b);u.commands(E);K()}else{a.error("Wrong password try again");u.prompt("login: ");
b=null}a.resume();m.history&&u.history().enable()})}else{b=i;u.prompt("password: ");u.mask(true)}}catch(j){h(j,"LOGIN",a);throw j;}})}function C(){if(typeof m.onBeforelogout==="function")if(m.onBeforelogout(a)==false)return;var b=m.name;b=b?"_"+b:"";k.Storage.remove("token"+b,null);k.Storage.remove("login"+b,null);m.history&&u.history().disable();y();if(typeof m.onAfterlogout==="function")m.onAfterlogout(a)}function F(){var b=A.top(),i="";if(b.name!==J&&b.name!=="")i+=b.name+"_";i+=N;u.name(i);typeof b.prompt==
"function"?u.prompt(function(j){b.prompt(j,a)}):u.prompt(b.prompt);m.history&&u.history().enable();u.set("");if(typeof b.onStart==="function")b.onStart(a)}function K(){F();if(e.greetings===J)a.echo(a.signature);else e.greetings&&a.echo(e.greetings);if(typeof m.onInit==="function")m.onInit(a)}function I(b){a.oneTime(5,function(){L()});if(a.paused()){if(b.which===68&&b.ctrlKey){for(b=T.length;b--;){var i=T[b];if(4!==i.readyState)try{i.abort()}catch(j){a.error("error in aborting ajax")}}a.resume();return false}}else{if(m.keydown&&
m.keydown(b,a)===false)return false;if(b.which!==9)d=0;if(b.which===68&&b.ctrlKey){if(u.get()==="")if(A.size()>1||m.login!==J)a.pop("");else{a.resume();a.echo("")}else a.set_command("");return false}else if(m.tabcompletion&&b.which===9){++d;i=u.get();if(!i.match(" ")){var r=RegExp("^"+i),o=A.top().command_list,q=[];for(b=o.length;b--;)r.test(o[b])&&q.push(o[b]);if(q.length===1)a.set_command(q[0]);else if(q.length>1)if(d>=2){x(i);a.echo(q.join("\t"));d=0}}return false}else if(b.which===86&&b.ctrlKey){a.oneTime(1,
function(){t()});return true}else if(b.which===9&&b.ctrlKey){P.length()>1&&a.focus(false);return false}else if(b.which===34)a.scroll(a.height());else b.which===33?a.scroll(-a.height()):a.attr({scrollTop:a.attr("scrollHeight")})}}var a=this,n=[],z,N=P.length(),O,H=[],m={name:"",prompt:"> ",history:true,exit:true,clear:true,enabled:true,cancelableAjax:true,login:null,tabcompletion:null,historyFilter:null,onInit:null,onExit:null,keypress:null,keydown:null};if(e){e.width&&a.width(e.width);e.height&&a.height(e.height);
k.extend(m,e)}var D=!m.enabled;if(a.length===0)throw'Sorry, but terminal said that "'+a.selector+'" is not valid selector!';a.ajaxSend(function(b,i){T.push(i)});if(a.data("terminal"))return a.data("terminal");z=k("<div>").addClass("terminal-output").appendTo(a);a.addClass("terminal").append("<div/>");a.click(function(){a.find("textarea").focus()});k.extend(a,k.omap({clear:function(){z.html("");u.set("");n=[];a.attr({scrollTop:0});return a},paused:function(){return D},pause:function(){if(u){a.disable();
u.hide()}return a},resume:function(){if(u){a.enable();u.show();t()}return a},cols:function(){return O},rows:function(){return n.length},history:function(){return u.history()},next:function(){if(P.length()===1)return a;else{var b=a.offset().top;a.height();a.scrollTop();var i=a,j=k(window).scrollTop(),r=j+k(window).height(),o=k(i).offset().top;if(o+k(i).height()>=j&&o<=r){P.front().disable();b=P.rotate().enable();i=b.offset().top-50;k("html,body").animate({scrollTop:i},500);return b}else{a.enable();
k("html,body").animate({scrollTop:b-50},500);return a}}},focus:function(b){a.oneTime(1,function(){if(P.length()===1)b===false?a.disable():a.enable();else if(b===false)a.next();else{P.front().disable();P.set(a);a.enable()}});return a},enable:function(){O===J&&a.resize();if(D)if(u){u.enable();D=false}return a},disable:function(){if(u){D=true;u.disable()}return a},enabled:function(){return D},signature:function(){var b=a.cols();b=b<15?null:b<35?0:b<55?1:b<64?2:b<75?3:4;return b!==null?ia[b].join("\n")+
"\n":""},version:function(){return"0.4.19"},get_command:function(){return u.get()},insert:function(b){if(typeof b==="string"){u.insert(b);return a}else throw"insert function argument is not a string";},set_prompt:function(b){if(p("prompt",b)){typeof b=="function"?u.prompt(function(i){b(i,a)}):u.prompt(b);A.top().prompt=b}return a},get_prompt:function(){return A.top().prompt},set_command:function(b){u.set(b);return a},set_mask:function(b){u.mask(b);return a},get_output:function(b){return b?n:k.map(n,
function(i,j){return typeof j=="function"?j():j}).join("\n")},resize:function(b,i){if(b&&i){a.width(b);a.height(i)}O=g();u.resize(O);var j=z.detach();z.html("");k.each(n,function(r,o){l(o&&typeof o=="function"?o():o)});a.prepend(j);t();return a},echo:function(b){n.push(b);l(typeof b==="function"?b():b);L();return a},error:function(b){return a.echo("[[;#f00;]"+b.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")+"]")},scroll:function(b){var i;if(a.prop){b>a.prop("scrollTop")&&b>0&&a.prop("scrollTop",0);
i=a.prop("scrollTop");a.prop("scrollTop",i+b)}else{b>a.attr("scrollTop")&&b>0&&a.attr("scrollTop",0);i=a.attr("scrollTop");a.attr("scrollTop",i+b)}return a},logout:m.login?function(){for(;A.size()>1;)A.pop();C();return a}:function(){throw"You don't have login function";},token:m.login?function(){var b=m.name;return k.Storage.get("token"+(b?"_"+b:""))}:k.noop,login_name:m.login?function(){var b=m.name;return k.Storage.get("login"+(b?"_"+b:""))}:k.noop,name:function(){return m.name},push:function(b,
i){if(i&&(!i.prompt||p("prompt",i.prompt))||!i){if(typeof b==="string")b=v(i.eval,a);A.push(k.extend({eval:b},i));F()}return a},reset:function(){for(a.clear();A.size()>1;)A.pop();K()},pop:function(b){b!==J&&x(b);if(A.top().name===m.name){if(m.login){C();if(typeof m.onExit==="function")m.onExit(a)}}else{b=A.pop();F();if(typeof b.onExit==="function")b.onExit(a)}return a}},function(b,i){return function(){try{return i.apply(this,Array.prototype.slice.apply(arguments))}catch(j){h(j,"TERMINAL")}}}));var L=
function(){var b=f();return function(){if(b!==f()){a.resize();b=f()}}}(),d=0,s;if(m.login&&typeof m.onBeforeLogin==="function")m.onBeforeLogin(a);if(typeof c=="string"){s=c;c=v(c,a)}else if(typeof c=="object"&&c.constructor===Array)throw"You can't use array as eval";else if(typeof c==="object"){for(var M in c)c.hasOwnProperty(M)&&H.push(M);c=function b(i){return function(j){if(j!==""){j=j.split(/ +/);var r=j[0],o=j.slice(1);j=i[r];var q=typeof j;if(q==="function")j.apply(a,o);else if(q==="object"||
q==="string"){o=[];if(q==="object"){for(var w in j)j.hasOwnProperty(w)&&o.push(w);j=b(j)}a.push(j,{prompt:r+"> ",name:r,command_list:o})}else a.error("Command '"+r+"' Not Found")}}}(c)}else if(typeof c!=="function")throw'Unknow object "'+String(c)+'" passed as eval';if(s&&(typeof m.login==="string"||m.login))m.login=function(b){var i=1;return function(j,r,o){a.pause();k.jrpc(s,i++,b,[j,r],function(q){a.resume();!q.error&&q.result?o(q.result):o(null)},function(q,w){a.resume();a.error("&#91;AJAX&#92; Response: "+
w+"\n"+q.responseText)})}}(typeof m.login==="boolean"?"login":m.login);if(p("prompt",m.prompt)){var A=new ca({name:m.name,eval:c,prompt:m.prompt,command_list:H,greetings:m.greetings}),u=a.find(".terminal-output").next().cmd({prompt:m.prompt,history:m.history,historyFilter:m.historyFilter,width:"100%",keydown:I,keypress:m.keypress?function(b){return m.keypress(b,a)}:null,onCommandChange:function(b){if(typeof m.onCommandChange==="function")m.onCommandChange(b,a);t()},commands:E});P.append(a);m.enabled===
true?a.focus():a.disable();k(window).resize(a.resize);a.click(function(){a.focus()});e.login&&a.token&&!a.token()&&a.login_name&&!a.login_name()?y():K();typeof k.fn.init.prototype.mousewheel==="function"&&a.mousewheel(function(b,i){i>0?a.scroll(-40):a.scroll(40);return false},true)}a.data("terminal",a);return a}})(jQuery);
