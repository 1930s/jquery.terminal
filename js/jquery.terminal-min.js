/*

 |       __ _____                     ________                              __
 |      / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /
 |  __ / // // // // // _  // _// // / / // _  // _//     // //  \/ // _ \/ /
 | /  / // // // // // ___// / / // / / // ___// / / / / // // /\  // // / /__
 | \___//____ \\___//____//_/ _\_  / /_//____//_/ /_/ /_//_//_/ /_/ \__\_\___/
 |           \/              /____/                              version 0.4.18
 http://terminal.jcubic.pl

 Licensed under GNU LGPL Version 3 license
 Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>

 Includes:

 Storage plugin Distributed under the MIT License
 Copyright (c) 2010 Dave Schindler

 jQuery Timers licenced with the WTFPL
 <http://jquery.offput.ca/every/>

 Cross-Browser Split 1.1.1
 Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
 Available under the MIT License

 Date: Tue, 18 Sep 2012 13:23:49 +0000
*/
(function(n,I){function ga(c,e){var f;if(typeof c==="string"&&typeof e==="string"){localStorage[c]=e;return true}else if(typeof c==="object"&&typeof e==="undefined"){for(f in c)if(c.hasOwnProperty(f))localStorage[f]=c[f];return true}return false}function ba(c,e){var f,h;f=new Date;f.setTime(f.getTime()+31536E6);f="; expires="+f.toGMTString();if(typeof c==="string"&&typeof e==="string"){document.cookie=c+"="+e+f+"; path=/";return true}else if(typeof c==="object"&&typeof e==="undefined"){for(h in c)if(c.hasOwnProperty(h))document.cookie=
h+"="+c[h]+f+"; path=/";return true}return false}function ha(c){return localStorage[c]}function ia(c){var e,f,h;c+="=";e=document.cookie.split(";");for(f=0;f<e.length;f++){for(h=e[f];h.charAt(0)===" ";)h=h.substring(1,h.length);if(h.indexOf(c)===0)return h.substring(c.length,h.length)}return null}function ja(c){return delete localStorage[c]}function ka(c){return ba(c,"",-1)}function X(c,e){var f=[],h=c.length;if(h<e)return[c];for(var j=0;j<h;j+=e)f.push(c.substring(j,j+e));return f}function F(c){if(typeof c===
"string"){c=c.replace(/&(?!#[0-9]+;|[a-zA-Z]+;)/g,"&amp;");c=c.replace(/</g,"&lt;").replace(/>/g,"&gt;");c=c.replace(/\n/g,"<br/>");c=c.replace(/ /g,"&nbsp;");c=c.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");var e=c.split(la);if(e&&e.length>1)c=n.map(e,function(f){return f===""?f:f.substring(0,1)==="["?f.replace(Y,function(h,j,s,w,o){if(o==="")return"<span>&nbsp;</span>";h="";if(j.indexOf("b")!==-1)h+="font-weight:bold;";var D="text-decoration:";if(j.indexOf("u")!==-1)D+="underline ";if(j.indexOf("s")!==
-1)D+="line-through";if(j.indexOf("s")!==-1||j.indexOf("u")!==-1)h+=D+";";if(j.indexOf("i")!==-1)h+="font-style:italic; ";if(s.match(ca))h+="color:"+s+";";if(w.match(ca))h+="background-color:"+w;return c='<span style="'+h+'">'+o+"</span>"}):"<span>"+f+"</span>"}).join("");return c.replace(ma,'<a target="_blank" href="$1">$1</a>')}else return""}function da(c){var e=c instanceof Array?c:c?[c]:[],f=0;n.extend(this,{left:function(){if(f===0)f=e.length-1;else--f;return e[f]},right:function(){if(f===e.length-
1)f=0;else++f;return e[f]},current:function(){return e[f]},data:function(){return e},length:function(){return e.length},reset:function(){f=0},append:function(h){e.push(h);this.reset()}})}function na(c){var e=c?[c]:[];n.extend(this,{size:function(){return e.length},pop:function(){if(e.length===0)return null;else{var f=e[e.length-1];e=e.slice(0,e.length-1);return f}},push:function(f){e=e.concat([f]);return f},top:function(){return e.length>0?e[e.length-1]:null}})}function oa(c){var e=true;if(typeof c===
"string"&&c!=="")c+="_";var f=n.Storage.get(c+"commands"),h=new da(f?eval("("+f+")"):[""]);n.extend(this,{append:function(j){if(e){h.append(j);n.Storage.set(c+"commands",n.json_stringify(h.data()))}},data:function(){return h.data()},next:function(){return h.right()},last:function(){h.reset()},previous:function(){return h.left()},clear:function(){h=new da;n.Storage.remove(c+"commands")},enable:function(){e=true},disable:function(){e=false}})}n.omap=function(c,e){var f={};n.each(c,function(h,j){f[h]=
e.call(c,h,j)});return f};var T=typeof window.localStorage!=="undefined";n.extend({Storage:{set:T?ga:ba,get:T?ha:ia,remove:T?ja:ka}});jQuery.fn.extend({everyTime:function(c,e,f,h,j){return this.each(function(){jQuery.timer.add(this,c,e,f,h,j)})},oneTime:function(c,e,f){return this.each(function(){jQuery.timer.add(this,c,e,f,1)})},stopTime:function(c,e){return this.each(function(){jQuery.timer.remove(this,c,e)})}});jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,
ds:100,s:1E3,das:1E4,hs:1E5,ks:1E6},timeParse:function(c){if(c===I||c===null)return null;var e=this.regex.exec(jQuery.trim(c.toString()));return e[2]?parseInt(e[1],10)*(this.powers[e[2]]||1):c},add:function(c,e,f,h,j,s){var w=0;if(jQuery.isFunction(f)){j||(j=h);h=f;f=e}e=jQuery.timer.timeParse(e);if(!(typeof e!=="number"||isNaN(e)||e<=0)){if(j&&j.constructor!==Number){s=!!j;j=0}j=j||0;s=s||false;if(!c.$timers)c.$timers={};c.$timers[f]||(c.$timers[f]={});h.$timerID=h.$timerID||this.guid++;var o=function(){if(!(s&&
o.inProgress)){o.inProgress=true;if(++w>j&&j!==0||h.call(c,w)===false)jQuery.timer.remove(c,f,h);o.inProgress=false}};o.$timerID=h.$timerID;c.$timers[f][h.$timerID]||(c.$timers[f][h.$timerID]=window.setInterval(o,e));this.global[f]||(this.global[f]=[]);this.global[f].push(c)}},remove:function(c,e,f){var h=c.$timers,j;if(h){if(e){if(h[e]){if(f){if(f.$timerID){window.clearInterval(h[e][f.$timerID]);delete h[e][f.$timerID]}}else for(var s in h[e])if(h[e].hasOwnProperty(s)){window.clearInterval(h[e][s]);
delete h[e][s]}for(j in h[e])if(h[e].hasOwnProperty(j))break;if(!j){j=null;delete h[e]}}}else for(var w in h)h.hasOwnProperty(w)&&this.remove(c,w,f);for(j in h)if(h.hasOwnProperty(j))break;if(!j)c.$timers=null}}}});if(jQuery.browser.msie)jQuery(window).one("unload",function(){var c=jQuery.timer.global,e;for(e in c)if(c.hasOwnProperty(e))for(var f=c[e],h=f.length;--h;)jQuery.timer.remove(f[h],e)});(function(c){if(String.prototype.split.toString().match(/\[native/)){var e=String.prototype.split,f=/()??/.exec("")[1]===
c,h;h=function(j,s,w){if(Object.prototype.toString.call(s)!=="[object RegExp]")return e.call(j,s,w);var o=[],D=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.extended?"x":"")+(s.sticky?"y":""),y=0,J,x,E;s=RegExp(s.source,D+"g");j+="";f||(J=RegExp("^"+s.source+"$(?!\\s)",D));for(w=w===c?4294967295:w>>>0;x=s.exec(j);){D=x.index+x[0].length;if(D>y){o.push(j.slice(y,x.index));!f&&x.length>1&&x[0].replace(J,function(){for(var H=1;H<arguments.length-2;H++)if(arguments[H]===c)x[H]=c});x.length>1&&x.index<
j.length&&Array.prototype.push.apply(o,x.slice(1));E=x[0].length;y=D;if(o.length>=w)break}s.lastIndex===x.index&&s.lastIndex++}if(y===j.length){if(E||!s.test(""))o.push("")}else o.push(j.slice(y));return o.length>w?o.slice(0,w):o};String.prototype.split=function(j,s){return h(this,j,s)};return h}})();var la=/(\[\[[bius]*;[^;]*;[^\]]*\][^\]\[]*\])/g,Y=/\[\[([bius]*);([^;]*);([^\]]*)\]([^\]\[]*)\]/g,ca=/#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})/,ma=/(https?:((?!&[^;]+;)[^\s:])+)/g;window.encode=F;n.json_stringify=
function(c,e){var f="",h;e=e===I?1:e;switch(typeof c){case "function":f+=c;break;case "boolean":f+=c?"true":"false";break;case "object":if(c===null)f+="null";else if(c instanceof Array){f+="[";var j=c.length;for(h=0;h<j-1;++h)f+=n.json_stringify(c[h],e+1);f+=n.json_stringify(c[j-1],e+1)+"]"}else{f+="{";for(j in c)if(c.hasOwnProperty(j))f+='"'+j+'":'+n.json_stringify(c[j],e+1);f+="}"}break;case "string":j=c;var s={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};for(h in s)if(s.hasOwnProperty(h))j=
j.replace(RegExp(h,"g"),s[h]);f+='"'+j+'"';break;case "number":f+=String(c)}f+=e>1?",":"";if(e===1)f=f.replace(/,([\]}])/g,"$1");return f.replace(/([\[{]),/g,"$1")};n.fn.cmd=function(c){function e(){k.toggleClass("inverted")}function f(){C="(reverse-i-search)`"+E+"': ";L()}function h(d){var r=G.data(),M=RegExp("^"+E),z=r.length;if(d&&H>0)z-=H;for(d=z;d--;)if(M.test(r[d])){H=r.length-d;q=0;o.set(r[d],true);A();break}}function j(d){var r=d.substring(0,y-J);d=d.substring(y-J);return[r].concat(X(d,y))}
function s(){D.focus();o.oneTime(1,function(){o.insert(D.val());D.blur().val("")})}function w(d){if(c.keydown&&c.keydown(d)===false)return false;if(N){var r;if(x&&(d.which===35||d.which===36||d.which===37||d.which===38||d.which===39||d.which===40||d.which===66||d.which===13||d.which===27)){C=U;x=false;H=null;E="";L();if(d.which===27)a="";A();w.call(this,d)}else if(d.altKey){if(d.which===68){o.set(a.slice(0,q)+a.slice(q).replace(/[^ ]+ |[^ ]+$/,""),true);return false}return true}else if(d.keyCode===
13){if(G&&a&&(c.historyFilter&&c.historyFilter(a)||!c.historyFilter))G.data().slice(-1)[0]!==a&&G.append(a);G.last();d=a;o.set("");c.commands&&c.commands(d);typeof C==="function"&&L()}else if(d.which===32)if(x){E+=" ";f()}else o.insert(" ");else if(d.which===8)if(x){E=E.slice(0,-1);f()}else{if(a!==""&&q>0){a=a.slice(0,q-1)+a.slice(q,a.length);--q;A()}}else if(d.which===9&&!(d.ctrlKey||d.altKey))o.insert("\t");else if(d.which===46){if(a!==""&&q<a.length){a=a.slice(0,q)+a.slice(q+1,a.length);A()}return true}else if(G&&
d.which===38||d.which===80&&d.ctrlKey)o.set(G.previous());else if(G&&d.which===40||d.which===78&&d.ctrlKey)o.set(G.next());else if(d.which===37||d.which===66&&d.ctrlKey)if(d.ctrlKey&&d.which!==66){r=q-1;d=0;for(a[r]===" "&&--r;r>0;--r)if(a[r]===" "&&a[r+1]!==" "){d=r+1;break}else if(a[r]==="\n"&&a[r+1]!=="\n"){d=r;break}o.position(d)}else{if(q>0){--q;A()}}else if(d.which===82&&d.ctrlKey)if(x)h(true);else{U=C;f();a="";A();x=true}else if(d.which===39||d.which===70&&d.ctrlKey)if(d.ctrlKey&&d.which!==
70){a[q]===" "&&++q;d=a.slice(q).match(/\S[\n\s]{2,}|[\n\s]+\S?/);if(!d||d[0].match(/^\s+$/))q=a.length;else if(d[0][0]!==" ")q+=d.index+1;else{q+=d.index+d[0].length-1;d[0][d[0].length-1]!==" "&&--q}A()}else{if(q<a.length){++q;A()}}else if(d.which===123)return true;else if(d.which===36)o.position(0);else if(d.which===35)o.position(a.length);else if(d.ctrlKey||d.metaKey)if(d.shiftKey){if(d.which===84)return true}else if(d.which===65)o.position(0);else if(d.which===69)o.position(a.length);else if(d.which===
88||d.which===67||d.which===87||d.which===84)return true;else if(d.which===86){s();return true}else if(d.which===75)if(q===0)o.set("");else q!==a.length&&o.set(a.slice(0,q));else if(d.which===85){o.set(a.slice(q,a.length));o.position(0)}else{if(d.which===17)return true}else return true;return false}}var o=this;o.addClass("cmd");o.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');var D=n("<textarea/>").addClass("clipboard").appendTo(o);c.width&&o.width(c.width);
var y,J,x=false,E="",H=null,U,V=c.mask||false,a="",q=0,C,N=c.enabled,O,G,k=o.find(".cursor"),A=function(d){function r(g,p){if(p===g.length){b.html(F(g));k.html("&nbsp;");i.html("")}else if(p===0){b.html("");k.html(F(g.slice(0,1)));i.html(F(g.slice(1)))}else{var l=F(g.slice(0,p));b.html(l);l=g.slice(p,p+1);k.html(l===" "?"&nbsp;":F(l));p===g.length-1?i.html(""):i.html(F(g.slice(p+1)))}}function M(g){return"<div>"+F(g)+"</div>"}function z(g){var p=i;n.each(g,function(l,m){p=n(M(m)).insertAfter(p).addClass("clear")})}
function t(g){n.each(g,function(p,l){b.before(M(l))})}var b=k.prev(),i=k.next();return function(){var g=V?a.replace(/./g,"*"):a,p,l;d.find("div").remove();b.html("");if(g.length>y-J-1||g.match(/\n/)){var m,u=g.match(/\t/g),B=u?u.length*3:0;if(u)g=g.replace(/\t/g,"\u0000\u0000\u0000\u0000");if(g.match(/\n/)){var v=g.split("\n");l=y-J-1;for(p=0;p<v.length-1;++p)v[p]+=" ";if(v[0].length>l){m=[v[0].substring(0,l)];m=m.concat(X(v[0].substring(l),y))}else m=[v[0]];for(p=1;p<v.length;++p)if(v[p].length>
y)m=m.concat(X(v[p],y));else m.push(v[p])}else m=j(g);if(u)m=n.map(m,function(Z){return Z.replace(/\x00\x00\x00\x00/g,"\t")});l=m[0].length;if(q<l){r(m[0],q);z(m.slice(1))}else if(q===l){b.before(M(m[0]));r(m[1],0);z(m.slice(2))}else{p=m.length;if(q<l){r(m[0],q);z(m.slice(1))}else if(q===l){b.before(M(m[0]));r(m[1],0);z(m.slice(2))}else{u=m.slice(-1)[0];v=g.length-q;var K=u.length;g=0;if(v<=K){t(m.slice(0,-1));r(u,(K===v?0:K-v)+B)}else if(p===3){b.before("<div>"+F(m[0])+"</div>");r(m[1],q-l-1);i.after('<div class="clear">'+
F(m[2])+"</div>")}else{g=q;for(p=0;p<m.length;++p){l=m[p].length;if(g>l)g-=l;else break}l=m[p];B=p;if(g===l.length){g=0;l=m[++B]}r(l,g);t(m.slice(0,B));z(m.slice(B+1))}}}}else if(g===""){b.html("");k.html("&nbsp;");i.html("")}else r(g,q)}}(o),L=function(){var d=o.find(".prompt");return function(){if(typeof C==="string"){J=C.replace(Y,"$4").length;d.html(F(C))}else C(function(r){J=r.replace(Y,"$4").length;d.html(F(r))})}}();n.extend(o,{name:function(d){if(d!==I){O=d;G=new oa(d)}else return O},history:function(){return G},
set:function(d,r){if(d!==I){a=d;if(!r)q=a.length;A();if(typeof c.onCommandChange==="function")c.onCommandChange(a)}},insert:function(d,r){if(q===a.length)a+=d;else a=q===0?d+a:a.slice(0,q)+d+a.slice(q);r||(q+=d.length);A();if(typeof c.onCommandChange==="function")c.onCommandChange(a)},get:function(){return a},commands:function(d){if(d)c.commands=d;else return d},destroy:function(){n(document.documentElement).unbind(".commandline");o.find(".prompt").remove()},prompt:function(d){if(d===I)return C;else{if(typeof d===
"string"||typeof d==="function")C=d;else throw"prompt must be a function or string";L();A()}},position:function(d){if(typeof d==="number"){q=d<0?0:d>a.length?a.length:d;A()}else return q},show:function(){var d=o.show;return function(){d.apply(o,[]);A();L()}}(),resize:function(d){if(d)y=d;else{d=o.width();var r=k.innerWidth();y=Math.floor(d/r)}A()},enable:function(){if(!N){k.addClass("inverted");o.everyTime(500,"blink",e);N=true}},isenabled:function(){return N},disable:function(){if(N){o.stopTime("blink",
e);k.removeClass("inverted");N=false}},mask:function(d){if(typeof d==="boolean"){V=d;A()}else return V}});o.name(c.name||"");C=c.prompt||"> ";L();if(c.enabled===I||c.enabled===true)o.enable();n(n.browser.msie?document.documentElement:window).keypress(function(d){var r;if(d.ctrlKey&&d.which===99)return true;if(!x&&c.keypress)r=c.keypress(d);if(r===I||r){if(N)if(n.inArray(d.which,[38,32,13,0,8])>-1&&d.keyCode!==123&&!(d.which===38&&d.shiftKey))return false;else if(!d.ctrlKey&&!(d.altKey&&d.which===
100)){if(x){E+=String.fromCharCode(d.which);f();h()}else o.insert(String.fromCharCode(d.which));return false}else if(d.altKey)if(x){E+=String.fromCharCode(d.which);f();h()}else o.insert(String.fromCharCode(d.which))}else return r}).keydown(w);return o};n.jrpc=function(c,e,f,h,j,s){e=n.json_stringify({jsonrpc:"2.0",method:f,params:h,id:e});return n.ajax({url:c,data:e,success:j,error:s,contentType:"application/json",dataType:"json",async:true,cache:false,type:"POST"})};T=/ {14}$/;var pa=[["jQuery Terminal",
"(c) 2011 jcubic"],["jQuery Terminal Emulator v. 0.4.18","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>".replace(/ *<.*>/,"")],["jQuery Terminal Emulator version version 0.4.18","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],["      _______                 ________                        __","     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__",
"\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/","         \\/          /____/                                   ".replace(T,"")+"version 0.4.18","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],["      __ _____                     ________                              __","     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__",
"\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/","          \\/              /____/                                          ".replace(T,"")+"version 0.4.18","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"]],$=[],P=new function(c){var e=c?[c]:[],f=0;n.extend(this,{rotate:function(){if(e.length===1)return e[0];else{if(f===e.length-1)f=0;else++f;return e[f]}},length:function(){return e.length},set:function(h){for(var j=e.length;j--;)if(e[j]===h){f=j;return}this.append(h)},
front:function(){return e[f]},append:function(h){e.push(h)}})};n.fn.terminal=function(c,e){function f(){return a.get(0).scrollHeight>a.innerHeight()}function h(){var b=a.find(".cursor").width(),i=Math.floor(a.width()/b);if(f()){var g=a.innerWidth()-a.width();i-=Math.ceil((20-g/2)/(b-1))}return i}function j(b,i){a.error("&#91;"+i+"&#93;: "+(typeof b==="string"?b:typeof b.fileName==="string"?b.fileName+": "+b.message:b.message));if(typeof b.fileName==="string"){a.pause();n.get(b.fileName,function(g){a.resume();
var p=b.lineNumber-1;(g=g.split("\n")[p])&&a.error("&#91;"+b.lineNumber+"&#93;: "+g)})}b.stack&&a.error(b.stack)}function s(b,i){try{if(typeof i==="function")i(function(){});else if(typeof i!=="string")throw b+" must be string or function";}catch(g){j(g,b.toUpperCase());return false}return true}function w(){var b=a.prop?a.prop("scrollHeight"):a.attr("scrollHeight");a.scrollTop(b)}function o(b){b=typeof b==="string"?b:String(b);var i,g,p;if(b.length>O){i=O;g=b.split(/\n/g);p=/(\[\[[bius]*;[^;]*;[^\]]*\][^\]\[]*\]?)/g;
var l=/(\[\[[bius]*;[^;]*;[^\]]*\])/,m=/\[\[[bius]*;?[^;]*;?[^\]]*\]?$/,u=false,B=false,v="";b=[];for(var K=0,Z=g.length;K<Z;++K){if(v!=="")if(g[K]===""){b.push(v+"]");continue}else{g[K]=v+g[K];v=""}else if(g[K]===""){b.push("");continue}for(var W=g[K],ea=0,aa=0,R=0,fa=W.length;R<fa;++R){if(W[R]==="["&&W[R+1]==="[")u=true;else if(u&&W[R]==="]")if(B)B=u=false;else B=true;else if(u&&B||!u)++aa;if(aa===i||R===fa-1){var Q=W.substring(ea,R+1);if(v){Q=v+Q;if(Q.match("]"))v=""}ea=R+1;aa=0;var S=Q.match(p);
if(S){S=S[S.length-1];if(S[S.length-1]!=="]"){v=S.match(l)[1];Q+="]"}else if(Q.match(m)){Q=Q.replace(m,"");v=S.match(l)[1]}}b.push(Q)}}}i=n("<div></div>");g=0;for(p=b.length;g<p;++g)b[g]===""||b[g]==="\r"?i.append("<div>&nbsp;</div>"):n("<div/>").html(F(b[g])).appendTo(i)}else i=n("<div/>").html(F(b));C.append(i);i.width("100%");w();return i}function D(b,i){var g=1,p=function(l,m){i.pause();n.jrpc(b,g++,l,m,function(u){if(u.error)i.error("&#91;RPC&#93; "+u.error.message);else if(typeof u.result===
"string")i.echo(u.result);else if(u.result instanceof Array)i.echo(u.result.join(" "));else if(typeof u.result==="object"){var B="",v;for(v in u.result)if(u.result.hasOwnProperty(v))B+=v+": "+u.result[v]+"\n";i.echo(B)}i.resume()},function(u,B){i.error("&#91;AJAX&#93; "+B+" - Server reponse is: \n"+u.responseText);i.resume()})};return function(l,m){if(l!==""){var u,B;if(l.match(/[^ ]* /)){l=l.split(/ +/);u=l[0];B=l.slice(1)}else{u=l;B=[]}if(!k.login||u==="help")p(u,B);else{var v=m.token();v?p(u,[v].concat(B)):
m.error("&#91;AUTH&#93; Access denied (no token)")}}}}function y(b){var i=t.prompt();if(t.mask())b=b.replace(/./g,"*");typeof i==="function"?i(function(g){a.echo(g+b)}):a.echo(i+b)}function J(b){try{var i=z.top();if(b==="exit"&&k.exit)if(z.size()===1)if(k.login)E();else{y(b);a.echo("You can exit from main interpeter")}else a.pop("exit");else{y(b);b==="clear"&&k.clear?a.clear():i.eval(b,a)}}catch(g){j(g,"USER");a.resume();throw g;}}function x(){var b=null;t.prompt("login: ");k.history&&t.history().disable();
t.commands(function(i){try{y(i);if(b){t.mask(false);a.pause();if(typeof k.login!=="function")throw"Value of login property must be a function";k.login(b,i,function(p){if(p){var l=k.name;l=l?"_"+l:"";n.Storage.set("token"+l,p);n.Storage.set("login"+l,b);t.commands(J);U()}else{a.error("Wrong password try again");t.prompt("login: ");b=null}a.resume();k.history&&t.history().enable()})}else{b=i;t.prompt("password: ");t.mask(true)}}catch(g){j(g,"LOGIN",a);throw g;}})}function E(){if(typeof k.onBeforelogout===
"function")if(k.onBeforelogout(a)==false)return;var b=k.name;b=b?"_"+b:"";n.Storage.remove("token"+b,null);n.Storage.remove("login"+b,null);k.history&&t.history().disable();x();if(typeof k.onAfterlogout==="function")k.onAfterlogout(a)}function H(){var b=z.top(),i="";if(b.name!==I&&b.name!=="")i+=b.name+"_";i+=N;t.name(i);typeof b.prompt=="function"?t.prompt(function(g){b.prompt(g,a)}):t.prompt(b.prompt);k.history&&t.history().enable();t.set("");if(typeof b.onStart==="function")b.onStart(a)}function U(){H();
if(e.greetings===I)a.echo(a.signature);else e.greetings&&a.echo(e.greetings);if(typeof k.onInit==="function")k.onInit(a)}function V(b){a.oneTime(5,function(){L()});if(a.paused()){if(k.cancelableAjax)if(b.which===68&&b.ctrlKey){for(b=$.length;b--;){var i=$[b];if(4!==i.readyState)try{i.abort()}catch(g){a.error("error in aborting ajax")}}a.resume();return false}}else{if(k.keydown&&k.keydown(b,a)===false)return false;if(b.which!==9)d=0;if(b.which===68&&b.ctrlKey){if(t.get()==="")if(z.size()>1||k.login!==
I)a.pop("");else{a.resume();a.echo("")}else a.set_command("");return false}else if(k.tabcompletion&&b.which===9){++d;i=t.get();if(!i.match(" ")){var p=RegExp("^"+i),l=z.top().command_list,m=[];for(b=l.length;b--;)p.test(l[b])&&m.push(l[b]);if(m.length===1)a.set_command(m[0]);else if(m.length>1)if(d>=2){y(i);a.echo(m.join("\t"));d=0}}return false}else if(b.which===86&&b.ctrlKey){a.oneTime(1,function(){w()});return true}else if(b.which===9&&b.ctrlKey){P.length()>1&&a.focus(false);return false}else if(b.which===
34)a.scroll(a.height());else b.which===33?a.scroll(-a.height()):a.attr({scrollTop:a.attr("scrollHeight")})}}var a=this,q=[],C,N=P.length(),O,G=[],k={name:"",prompt:"> ",history:true,exit:true,clear:true,enabled:true,cancelableAjax:true,login:null,tabcompletion:null,historyFilter:null,onInit:null,onExit:null,keypress:null,keydown:null};if(e){e.width&&a.width(e.width);e.height&&a.height(e.height);n.extend(k,e)}var A=!k.enabled;if(a.length===0)throw'Sorry, but terminal said that "'+a.selector+'" is not valid selector!';
a.ajaxSend(function(b,i){$.push(i)});if(a.data("terminal"))return a.data("terminal");C=n("<div>").addClass("terminal-output").appendTo(a);a.addClass("terminal").append("<div/>");a.click(function(){a.find("textarea").focus()});n.extend(a,n.omap({clear:function(){C.html("");t.set("");q=[];a.attr({scrollTop:0});return a},paused:function(){return A},pause:function(){if(t){a.disable();t.hide()}return a},resume:function(){if(t){a.enable();t.show();w()}return a},cols:function(){return O},rows:function(){return q.length},
history:function(){return t.history()},next:function(){if(P.length()===1)return a;else{var b=a.offset().top;a.height();a.scrollTop();var i=a,g=n(window).scrollTop(),p=g+n(window).height(),l=n(i).offset().top;if(l+n(i).height()>=g&&l<=p){P.front().disable();b=P.rotate().enable();i=b.offset().top-50;n("html,body").animate({scrollTop:i},500);return b}else{a.enable();n("html,body").animate({scrollTop:b-50},500);return a}}},focus:function(b){a.oneTime(1,function(){if(P.length()===1)b===false?a.disable():
a.enable();else if(b===false)a.next();else{P.front().disable();P.set(a);a.enable()}});return a},enable:function(){O===I&&a.resize();if(A)if(t){t.enable();A=false}return a},disable:function(){if(t){A=true;t.disable()}return a},enabled:function(){return A},signature:function(){var b=a.cols();b=b<15?null:b<35?0:b<55?1:b<64?2:b<75?3:4;return b!==null?pa[b].join("\n")+"\n":""},version:function(){return"0.4.18"},get_command:function(){return t.get()},insert:function(b){if(typeof b==="string"){t.insert(b);
return a}else throw"insert function argument is not a string";},set_prompt:function(b){if(s("prompt",b)){typeof b=="function"?t.prompt(function(i){b(i,a)}):t.prompt(b);z.top().prompt=b}return a},get_prompt:function(){return z.top().prompt},set_command:function(b){t.set(b);return a},set_mask:function(b){t.mask(b);return a},get_output:function(b){return b?q:n.map(q,function(i,g){return typeof g=="function"?g():g}).join("\n")},resize:function(b,i){if(b&&i){a.width(b);a.height(i)}O=h();t.resize(O);var g=
C.detach();C.html("");n.each(q,function(p,l){o(l&&typeof l=="function"?l():l)});a.prepend(g);w();return a},echo:function(b){q.push(b);o(typeof b==="function"?b():b);L();return a},error:function(b){return a.echo("[[;#f00;]"+b.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")+"]")},scroll:function(b){var i;if(a.prop){b>a.prop("scrollTop")&&b>0&&a.prop("scrollTop",0);i=a.prop("scrollTop");a.prop("scrollTop",i+b)}else{b>a.attr("scrollTop")&&b>0&&a.attr("scrollTop",0);i=a.attr("scrollTop");a.attr("scrollTop",
i+b)}return a},logout:k.login?function(){for(;z.size()>1;)z.pop();E();return a}:function(){throw"You don't have login function";},token:k.login?function(){var b=k.name;return n.Storage.get("token"+(b?"_"+b:""))}:null,login_name:k.login?function(){var b=k.name;return n.Storage.get("login"+(b?"_"+b:""))}:null,name:function(){return k.name},push:function(b,i){if(i&&(!i.prompt||s("prompt",i.prompt))||!i){if(typeof b==="string")b=D(i.eval,a);z.push(n.extend({eval:b},i));H()}return a},pop:function(b){b!==
I&&y(b);if(z.top().name===k.name){if(k.login){E();if(typeof k.onExit==="function")k.onExit(a)}}else{b=z.pop();H();if(typeof b.onExit==="function")b.onExit(a)}return a}},function(b,i){return function(){try{return i.apply(this,Array.prototype.slice.apply(arguments))}catch(g){j(g,"TERMINAL")}}}));var L=function(){var b=f();return function(){if(b!==f()){a.resize();b=f()}}}(),d=0,r;if(k.login&&typeof k.onBeforeLogin==="function")k.onBeforeLogin(a);if(typeof c=="string"){r=c;c=D(c,a)}else if(typeof c==
"object"&&c.constructor===Array)throw"You can't use array as eval";else if(typeof c==="object"){for(var M in c)c.hasOwnProperty(M)&&G.push(M);c=function b(i){return function(g){if(g!==""){g=g.split(/ +/);var p=g[0],l=g.slice(1);g=i[p];var m=typeof g;if(m==="function")g.apply(a,l);else if(m==="object"||m==="string"){l=[];if(m==="object"){for(var u in g)g.hasOwnProperty(u)&&l.push(u);g=b(g)}a.push(g,{prompt:p+"> ",name:p,command_list:l})}else a.error("Command '"+p+"' Not Found")}}}(c)}else if(typeof c!==
"function")throw'Unknow object "'+String(c)+'" passed as eval';if(r&&(typeof k.login==="string"||k.login))k.login=function(b){var i=1;return function(g,p,l){a.pause();n.jrpc(r,i++,b,[g,p],function(m){a.resume();!m.error&&m.result?l(m.result):l(null)},function(m,u){a.resume();a.error("&#91;AJAX&#92; Response: "+u+"\n"+m.responseText)})}}(typeof k.login==="boolean"?"login":k.login);if(s("prompt",k.prompt)){var z=new na({name:k.name,eval:c,prompt:k.prompt,command_list:G,greetings:k.greetings}),t=a.find(".terminal-output").next().cmd({prompt:k.prompt,
history:k.history,historyFilter:k.historyFilter,width:"100%",keydown:V,keypress:k.keypress?function(b){return k.keypress(b,a)}:null,onCommandChange:function(b){if(typeof k.onCommandChange==="function")k.onCommandChange(b,a);w()},commands:J});P.append(a);k.enabled===true?a.focus():a.disable();n(window).resize(a.resize);a.click(function(){a.focus()});a.token&&!a.token()&&a.login_name&&!a.login_name()?x():U();typeof n.fn.init.prototype.mousewheel==="function"&&a.mousewheel(function(b,i){i>0?a.scroll(-40):
a.scroll(40);return false},true)}a.data("terminal",a);return a}})(jQuery);
