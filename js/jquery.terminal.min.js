/*

 |       __ _____                     ________                              __
 |      / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /
 |  __ / // // // // // _  // _// // / / // _  // _//     // //  \/ // _ \/ /
 | /  / // // // // // ___// / / // / / // ___// / / / / // // /\  // // / /__
 | \___//____ \\___//____//_/ _\_  / /_//____//_/ /_/ /_//_//_/ /_/ \__\_\___/
 |           \/              /____/                              version 0.3
 http://terminal.jcubic.pl

 Licensed under GNU LGPL Version 3 license
 Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>

 Includes:

 Storage plugin Distributed under the MIT License
 Copyright (c) 2010 Dave Schindler

 LiveQuery plugin Dual MIT and GPL
 Copyright (c) 2008 Brandon Aaron (http://brandonaaron.net)

 jQuery Timers licenced with the WTFPL
 <http://jquery.offput.ca/every/>

 Date: Sat, 26 Feb 2011 20:26:27 +0000
*/
Array.prototype.has=function(g){for(var v=this.length;v--;)if(this[v]==g)return true;return false};
(function(g,v){function T(b,a){var d;if(typeof b==="string"&&typeof a==="string"){localStorage[b]=a;return true}else if(typeof b==="object"&&typeof a==="undefined"){for(d in b)if(b.hasOwnProperty(d))localStorage[d]=b[d];return true}return false}function O(b,a){var d,h;d=new Date;d.setTime(d.getTime()+31536E6);d="; expires="+d.toGMTString();if(typeof b==="string"&&typeof a==="string"){document.cookie=b+"="+a+d+"; path=/";return true}else if(typeof b==="object"&&typeof a==="undefined"){for(h in b)if(b.hasOwnProperty(h))document.cookie=
h+"="+b[h]+d+"; path=/";return true}return false}function U(b){return localStorage[b]}function V(b){var a,d,h;b+="=";a=document.cookie.split(";");for(d=0;d<a.length;d++){for(h=a[d];h.charAt(0)===" ";)h=h.substring(1,h.length);if(h.indexOf(b)===0)return h.substring(b.length,h.length)}return null}function W(b){return delete localStorage[b]}function X(b){return O(b,"",-1)}function P(b,a){var d=[],h=b.length;if(h<a)return[b];for(var j=0;j<h;j+=a)d.push(b.substring(j,j+a));return d}function w(b){if(typeof b==
"string"){b=b.replace(/&/g,"&amp;");b=b.replace(/</g,"&lt;").replace(/>/g,"&gt;");b=b.replace(/\n/g,"<br/>");b=b.replace(/ /g,"&nbsp;");b=b.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");var a=b.split(Q);if(a.length>1){b=g.map(a,function(d){return d[0]=="["?d.replace(Y,function(h,j,p,l,n){h="";if(j.indexOf("b")!=-1)h+="font-weight:bold;";if(j.indexOf("u")!=-1)h+="text-decoration:underline;";if(j.indexOf("i")!=-1)h+="font-style:italic; ";if(p.match(R))h+="color:"+p+";";if(l.match(R))h+="background-color:"+
l;return b='<span style="'+h+'">'+n+"</span>"}):"<span>"+d+"</span>"}).join("");console.log(b.split(Q))}return b}else return""}function S(b){var a=b instanceof Array?b:b?[b]:[],d=0;g.extend(this,{left:function(){if(d===0)d=a.length-1;else--d;return a[d]},right:function(){if(d==a.length-1)d=0;else++d;return a[d]},current:function(){return a[d]},data:function(){return a},reset:function(){d=0},append:function(h){a.push(h);this.reset()}})}function Z(b){var a=b?[b]:[];g.extend(this,{size:function(){return a.length},
pop:function(){if(a.length===0)return null;else{var d=a[a.length-1];a=a.slice(0,a.length-1);return d}},push:function(d){a=a.concat([d]);return d},top:function(){return a.length>0?a[a.length-1]:null}})}function $(b){var a=true;if(typeof b==="string"&&b!=="")b+="_";var d=g.Storage.get(b+"commands"),h=new S(d?eval("("+d+")"):[""]);g.extend(this,{append:function(j){if(a&&h.current()!=j){h.append(j);g.Storage.set(b+"commands",g.json_stringify(h.data()))}},data:function(){return h.data()},next:function(){return h.right()},
last:function(){h.reset()},previous:function(){return h.left()},clear:function(){h=new S;g.Storage.remove(b+"commands")},enable:function(){a=true},disable:function(){a=false}})}g.extend(g.fn,{livequery:function(b,a,d){var h=this,j;if(g.isFunction(b)){d=a;a=b;b=v}g.each(g.livequery.queries,function(p,l){if(h.selector==l.selector&&h.context==l.context&&b==l.type&&(!a||a.$lqguid==l.fn.$lqguid)&&(!d||d.$lqguid==l.fn2.$lqguid))return(j=l)&&false});j=j||new g.livequery(this.selector,this.context,b,a,d);
j.stopped=false;j.run();return this},expire:function(b,a,d){var h=this;if(g.isFunction(b)){d=a;a=b;b=v}g.each(g.livequery.queries,function(j,p){if(h.selector==p.selector&&h.context==p.context&&(!b||b==p.type)&&(!a||a.$lqguid==p.fn.$lqguid)&&(!d||d.$lqguid==p.fn2.$lqguid)&&!this.stopped)g.livequery.stop(p.id)});return this}});g.livequery=function(b,a,d,h,j){this.selector=b;this.context=a||document;this.type=d;this.fn=h;this.fn2=j;this.elements=[];this.stopped=false;this.id=g.livequery.queries.push(this)-
1;h.$lqguid=h.$lqguid||g.livequery.guid++;if(j)j.$lqguid=j.$lqguid||g.livequery.guid++;return this};g.livequery.prototype={stop:function(){var b=this;if(this.type)this.elements.unbind(this.type,this.fn);else this.fn2&&this.elements.each(function(a,d){b.fn2.apply(d)});this.elements=[];this.stopped=true},run:function(){if(!this.stopped){var b=this,a=this.elements,d=g(this.selector,this.context),h=d.not(a);this.elements=d;if(this.type){h.bind(this.type,this.fn);a.length>0&&g.each(a,function(j,p){g.inArray(p,
d)<0&&g.event.remove(p,b.type,b.fn)})}else{h.each(function(){b.fn.apply(this)});this.fn2&&a.length>0&&g.each(a,function(j,p){g.inArray(p,d)<0&&b.fn2.apply(p)})}}}};g.extend(g.livequery,{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if(g.livequery.running&&g.livequery.queue.length)for(var b=g.livequery.queue.length;b--;)g.livequery.queries[g.livequery.queue.shift()].run()},pause:function(){g.livequery.running=false},play:function(){g.livequery.running=true;g.livequery.run()},
registerPlugin:function(){g.each(arguments,function(b,a){if(g.fn[a]){var d=g.fn[a];g.fn[a]=function(){var h=d.apply(this,arguments);g.livequery.run();return h}}})},run:function(b){if(b!=v)g.inArray(b,g.livequery.queue)<0&&g.livequery.queue.push(b);else g.each(g.livequery.queries,function(a){g.inArray(a,g.livequery.queue)<0&&g.livequery.queue.push(a)});g.livequery.timeout&&clearTimeout(g.livequery.timeout);g.livequery.timeout=setTimeout(g.livequery.checkQueue,20)},stop:function(b){b!=v?g.livequery.queries[b].stop():
g.each(g.livequery.queries,function(a){g.livequery.queries[a].stop()})}});g.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove");g(function(){g.livequery.play()});var aa=g.prototype.init;g.prototype.init=function(b,a){var d=aa.apply(this,arguments);if(b&&b.selector){d.context=b.context;d.selector=b.selector}if(typeof b=="string"){d.context=a||document;d.selector=b}return d};g.prototype.init.prototype=g.prototype;
var I=typeof window.localStorage!=="undefined";g.extend({Storage:{set:I?T:O,get:I?U:V,remove:I?W:X}});jQuery.fn.extend({everyTime:function(b,a,d,h,j){return this.each(function(){jQuery.timer.add(this,b,a,d,h,j)})},oneTime:function(b,a,d){return this.each(function(){jQuery.timer.add(this,b,a,d,1)})},stopTime:function(b,a){return this.each(function(){jQuery.timer.remove(this,b,a)})}});jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1E3,das:1E4,hs:1E5,ks:1E6},
timeParse:function(b){if(b==v||b==null)return null;var a=this.regex.exec(jQuery.trim(b.toString()));return a[2]?parseInt(a[1],10)*(this.powers[a[2]]||1):b},add:function(b,a,d,h,j,p){var l=0;if(jQuery.isFunction(d)){j||(j=h);h=d;d=a}a=jQuery.timer.timeParse(a);if(!(typeof a!="number"||isNaN(a)||a<=0)){if(j&&j.constructor!=Number){p=!!j;j=0}j=j||0;p=p||false;if(!b.$timers)b.$timers={};b.$timers[d]||(b.$timers[d]={});h.$timerID=h.$timerID||this.guid++;var n=function(){if(!(p&&this.inProgress)){this.inProgress=
true;if(++l>j&&j!==0||h.call(b,l)===false)jQuery.timer.remove(b,d,h);this.inProgress=false}};n.$timerID=h.$timerID;b.$timers[d][h.$timerID]||(b.$timers[d][h.$timerID]=window.setInterval(n,a));this.global[d]||(this.global[d]=[]);this.global[d].push(b)}},remove:function(b,a,d){var h=b.$timers,j;if(h){if(a){if(h[a]){if(d){if(d.$timerID){window.clearInterval(h[a][d.$timerID]);delete h[a][d.$timerID]}}else for(d in h[a]){window.clearInterval(h[a][d]);delete h[a][d]}for(j in h[a])break;if(!j){j=null;delete h[a]}}}else for(a in h)this.remove(b,
a,d);for(j in h)break;if(!j)b.$timers=null}}}});if(jQuery.browser.msie)jQuery(window).one("unload",function(){var b=jQuery.timer.global,a;for(a in b)for(var d=b[a],h=d.length;--h;)jQuery.timer.remove(d[h],a)});var Q=/(\[\[[biu]*;[^;]*;[^\]]*\][^\]]*\])/g,Y=/\[\[([biu]*);([^;]*);([^\]]*)\]([^\]]*)\]/g,R=/#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})/;g.json_stringify=function(b,a){var d="";a=a===v?1:a;switch(typeof b){case "function":d+=b;break;case "boolean":d+=b?"true":"false";break;case "object":if(b===null)d+=
"null";else if(b instanceof Array){d+="[";for(var h=b.length,j=0;j<h-1;++j)d+=g.json_stringify(b[j],a+1);d+=g.json_stringify(b[h-1],a+1)+"]"}else{d+="{";for(h in b)if(b.hasOwnProperty(h))d+='"'+h+'":'+g.json_stringify(b[h],a+1);d+="}"}break;case "string":h=b;var p={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};for(j in p)if(p.hasOwnProperty(j))h=h.replace(RegExp(j,"g"),p[j]);d+='"'+h+'"';break;case "number":d+=String(b)}d+=a>1?",":"";if(a==1)d=d.replace(/,([\]}])/g,"$1");
return d.replace(/([\[{]),/g,"$1")};g.fn.cmd=function(b){var a=this;a.addClass("cmd");a.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');var d=g("<textarea/>").addClass("clipboard").appendTo(a);b.width&&a.width(b.width);var h,j,p=b.mask||false,l="",n=0,B,E=b.enabled,M,y,J=function(){var e=a.find(".cursor");return function(){e.toggleClass("inverted")}}(),K=a.find(".cursor"),A=function(e){function q(o,k){if(k==o.length){x.html(w(o));m.html("&nbsp;");
z.html("")}else if(k===0){x.html("");m.html(w(o.slice(0,1)));z.html(w(o.slice(1)))}else{var c=w(o.slice(0,k));x.html(c);c=o.slice(k,k+1);m.html(c==" "?"&nbsp;":w(c));k==o.lenght-1?z.html(""):z.html(w(o.slice(k+1)))}}function N(o){var k=z;g.each(o,function(c,i){k=g("<div>"+w(i)+"</div>").insertAfter(k)})}function D(o){g.each(o,function(k,c){x.before("<div>"+w(c)+"</div>")})}var m=e.find(".cursor"),x=m.prev(),z=m.next();return function(){var o=p?l.replace(/./g,"*"):l;e.find("div").remove();x.html("");
if(o.length>h-j-1){var k;k=o.substring(0,h-j-1);var c=o.substring(h-j-1);k=[k].concat(P(c,h));c=k[0].length;if(n<c){q(k[0],n);N(k.slice(1))}else{var i=k.length;if(n<=c){q(k[0],n);N(k.slice(1))}else{var r=k.slice(-1)[0];o=o.length-n;if(o<r.length){D(k.slice(0,-1));q(r,r.length-o-1)}else if(i==3){x.before("<div>"+w(k[0])+"</div>");q(k[1],n-c-1);z.after("<div>"+w(k[2])+"</div>")}else{o=Math.floor((n+j)/h);i=k[o];c=(n-c-1)%h;w(i.slice(0,c));q(i,c);D(k.slice(0,o));N(k.slice(o+1))}}}}else if(o===""){x.html("");
m.html("&nbsp;");z.html("")}else q(o,n)}}(a),f=function(){var e=a.find(".prompt");return function(){if(typeof B=="string"){j=B.length;e.html(w(B)+"&nbsp;")}else B(function(q){j=q.length;e.html(w(q)+"&nbsp;")})}}();g.extend(a,{name:function(e){if(e!==v){M=e;y=new $(e)}else return M},history:function(){return y},set:function(e,q){if(e!==v){l=e;if(!q)n=l.length;A()}},insert:function(e,q){if(n==l.length)l+=e;else l=n===0?e+l:l.slice(0,n)+e+l.slice(n);q||(n+=e.length);A()},get:function(){return l},commands:function(e){if(e)b.commands=
e;else return e},destroy:function(){g(document.documentElement).unbind(".commandline");a.find(".prompt").remove()},prompt:function(e){if(e===v)return B;else{if(typeof e=="string"||typeof e=="function")B=e;else throw"prompt must be a function or string";f()}},position:function(e){if(typeof e=="number"){n=e;A()}else return n},resize:function(e){if(e)h=e;else{e=a.width();var q=K.innerWidth();h=Math.floor(e/q)}A()},enable:function(){if(!this.isenabled()){a.everyTime(500,"blink",J);E=true}},isenabled:function(){return E},
disable:function(){if(this.isenabled()){a.stopTime("blink",J);a.find(".cursor").removeClass("inverted");E=false}},mask:function(e){if(typeof e=="boolean"){p=e;A()}else return p}});a.name(b.name||"");B=b.prompt||">";f();b.enabled===v&&!b.enabled&&a.enable();g(document.documentElement).keypress(function(e){if(E){var q;if(b.keypress)q=b.keypress(e);if(q===v||q)if([38,32,13,40,0,8].has(e.which)&&e.keyCode!=123&&!(e.which==40&&e.shiftKey||e.which==38&&e.shiftKey))return false;else if(!e.ctrlKey&&!(e.altKey&&
e.which==100)){a.insert(String.fromCharCode(e.which));if(e.which==45||e.shiftKey&&e.which==43)return false}}if(e.which==100&&e.ctrlKey)return false}).keydown(function(e){if(b.keydown&&b.keydown(e)===false)return false;if(E){var q;if(e.keyCode==13){y&&l&&y.append(l);y.last();e=l;a.set("");typeof B=="function"&&f();b.commands&&b.commands(e)}else if(e.which==32)a.insert(" ");else if(e.which==8){if(l!==""&&n>0){l=l.slice(0,n-1)+l.slice(n,l.length);--n;A()}}else if(e.which==9)a.insert("\t");else if(e.which==
46||e.which==68&&e.ctrlKey){if(l!==""&&n<l.length){l=l.slice(0,n)+l.slice(n+1,l.length);A()}return true}else if(y&&e.which==38||e.which==80&&e.ctrlKey)a.set(y.previous());else if(y&&e.which==40||e.which==78&&e.ctrlKey)a.set(y.next());else if(e.which==27)a.set("");else if(e.which==37||e.which==66&&e.ctrlKey)if(e.ctrlKey&&e.which!=66){q=n-1;e=0;for(l[q]==" "&&--q;q>0;--q)if(l[q]==" "&&l[q+1]!=" "){e=q+1;break}a.position(e)}else{if(n>0){--n;A()}}else if(e.which==39||e.which==70&&e.ctrlKey)if(e.ctrlKey&&
e.which!=70){l[n]==" "&&++n;e=l.slice(n).match(/[^ ] {2,}| +[^ ]?/);if(!e||e[0].match(/^ +$/))n=l.length;else if(e[0][0]!=" ")n+=e.index+1;else{n+=e.index+e[0].length-1;e[0][e[0].length-1]!=" "&&--n}A()}else{if(n<l.length){++n;A()}}else if(e.which==123)return true;else if(e.which==36)a.position(0);else if(e.which==35)a.position(l.length);else if(e.metaKey)if(e.shiftKey){if(e.which==84)return true}else{if(!e.altKey)if(e.which==65)a.position(0);else if(e.which==69)a.position(l.length);else if(e.which==
88||e.which==67||e.which==87||e.which==84)return true;else if(e.which==86){d.focus();window.setTimeout(function(){a.insert(d.val());d.blur();d.val("")},1);return true}else if(e.which==75)if(n===0)a.set("");else n!=l.length&&a.set(l.slice(0,n));else if(e.which==17)return true}else if(e.altKey)e.which==68&&a.set(l.slice(0,n)+l.slice(n).replace(/[^ ]+ |[^ ]+$/,""),true);else return true;return false}else if(e.altKey&&e.which==68||e.ctrlKey&&[65,66,68,69,80,78,70].has(e.which)||[35,36,37,38,39,40].has(e.which))return false});
return a};var L=[];g.jrpc=function(b,a,d,h,j,p){a=g.json_stringify({jsonrpc:"2.0",method:d,params:h,id:a});return g.ajax({url:b,data:a,success:j,error:p,contentType:"application/json",dataType:"json",beforeSend:function(l){L.push(l)},async:true,cache:false,type:"POST"})};I=/ {11}$/;var ba=[["jQuery Terminal","(c) 2011 jcubic"],["JQuery Terminal Emulator v. 0.3","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>".replace(/ *<.*>/,"")],["JQuery Terminal Emulator version version 0.3","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],
["      _______                 ________                        __","     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/","         \\/          /____/                                   ".replace(I,"")+"version 0.3","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],["      __ _____                     ________                              __",
"     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/","          \\/              /____/                                          ".replace(I,"")+"version 0.3","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"]],G=new function(b){var a=
b?[b]:[],d=0;g.extend(this,{rotate:function(){if(a.length==1)return a[0];else{if(d==a.length-1)d=0;else++d;return a[d]}},length:function(){return a.length},set:function(h){for(var j=a.length;j--;)if(a[j]===h){d=j;return}this.append(h)},front:function(){return a[d]},append:function(h){a.push(h)}})};L=[];g.fn.terminal=function(b,a){function d(){var c=g("<span>x</span>").appendTo(f),i=Math.floor(f.width()/c.width());c.remove();return i}function h(c,i){if(typeof c=="string")f.echo("["+i+"]: "+c).addClass("error");
else{f.echo("["+i+"]: "+c.fileName+": "+c.message).addClass("error");f.pause();g.get(c.fileName,function(r){f.resume();var s=c.lineNumber-1;f.echo("["+c.lineNumber+"]"+r.split("\n")[s]).addClass("error")})}}function j(c,i){try{if(typeof i=="function")i(function(){});else if(typeof i!="string")throw c+" must be string or function";}catch(r){h(r,c.toUpperCase());return false}return true}function p(c){c.scrollTop(f.attr("scrollHeight"))}function l(c){c=typeof c=="string"?c:String(c);var i;if(c.length>
D){c=c.split("\n");i=g("<div></div>");for(var r=c.length,s=0;s<r;++s)if(c[s]===""||c[s]=="\r")i.append("<div>&nbsp;</div>");else if(c[s].length>D){var u=P(c[s],D);g.each(u,function(C,t){g("<div/>").html(w(t)).appendTo(i)})}else g("<div/>").html(w(c[s])).appendTo(i)}else i=g("<div/>").html(w(c));q.append(i);i.width("100%");p(f);return i}function n(){if(a.greetings===v)f.echo(f.signature);else typeof a.greetings=="string"&&f.echo(a.greetings)}function B(c,i){var r=1,s=function(u,C){i.pause();g.jrpc(c,
r++,u,C,function(t){if(t.error)i.error("[RPC] "+t.error.message);else if(typeof t.result=="string")i.echo(t.result);else if(t.result instanceof Array)i.echo(t.result.join(" "));else if(typeof t.result=="object"){var F="",H;for(H in t.result)if(t.result.hasOwnProperty(H))F+=H+": "+t.result[H]+"\n";i.echo(F)}i.resume()},function(t,F){i.error("[AJAX] "+F+" - Server reponse is: \n"+t.responseText);i.resume()})};return function(u,C){if(u!==""){var t,F;if(u.match(/[^ ]* /)){u=u.split(/ */);t=u[0];F=u.slice(1)}else{t=
u;F=[]}if(!m.login||t=="help")s(t,F);else{var H=C.token();H?s(t,[H].concat(F)):C.error("[AUTH] Access denied (no token)")}}}}function E(c){var i=k.prompt();if(k.mask())c=c.replace(/./g,"*");typeof i=="function"?i(function(r){f.echo(r+" "+c)}):f.echo(i+" "+c)}function M(c){try{var i=o.top();if(c=="exit"&&m.exit)if(o.size()==1)m.login?J():f.echo("You can exit from main interpeter");else f.pop("exit");else{E(c);c=="clear"&&m.clear?f.clear():i.eval(c,f)}}catch(r){h(r,"USER");throw r;}}function y(){var c=
null;k.prompt("login:");m.history&&k.history().disable();k.commands(function(i){try{E(i);if(c){k.mask(false);f.pause();m.login(c,i,function(s){if(s){var u=m.name;u=u?"_"+u:"";g.Storage.set("token"+u,s);g.Storage.set("login"+u,c);k.commands(M);K();n()}else{f.error("Wrong password try again");k.prompt("login:");c=null}f.resume();m.history&&k.history().enable()})}else{c=i;k.prompt("password:");k.mask(true)}}catch(r){h(r,"LOGIN",f);throw r;}})}function J(){var c=m.name;c=c?"_"+c:"";g.Storage.remove("token"+
c,null);g.Storage.remove("login"+c,null);m.history&&k.history().disable();y()}function K(){var c=o.top(),i="";if(c.name!==v&&c.name!=="")i+=c.name+"_";i+=N;k.name(i);k.prompt(c.prompt);m.history&&k.history().enable();k.set("");if(typeof c.onStart=="function")c.onStart(f)}function A(c){if(f.paused()){if(c.which==100&&c.ctrlKey){console.log(L);for(c=L.length;c--;){var i=L[c];if(4!=i.readyState)try{i.abort()}catch(r){f.error("error in aborting ajax")}}f.resume();return false}}else{if(m.keypress&&m.keypress(c)===
false)return false;if(c.which==100&&c.ctrlKey){if(m.exit&&k.get()==="")m.name==o.top().name&&!m.login?f.echo("you can't exit from top interpreter"):f.pop("");return false}else if(c.charCode==118&&c.ctrlKey){window.setTimeout(function(){f.attr({scrollTop:f.attr("scrollHeight")})},1);return true}else if(c.which==34)f.scroll(f.height());else c.which==33?f.scroll(-f.height()):f.attr({scrollTop:f.attr("scrollHeight")})}}var f=this,e=[],q,N=G.length(),D,m={name:null,prompt:">",history:true,exit:true,clear:true,
enabled:true,login:null};if(a){a.width&&f.width(a.width);a.height&&f.height(a.height);g.extend(m,a)}var x=!m.enabled;if(f.length===0)throw'Sorry, but terminal said that "'+f.selector+'" is not valid selector';if(f.data("terminal")){f.ajaxSend(function(c,i){L.push(i)});return f.data("terminal")}q=g("<div>").addClass("terminal-output").appendTo(f);f.addClass("terminal").append("<div/>");g.extend(f,{clear:function(){q.html("");k.set("");e=[];f.attr({scrollTop:0});return f},paused:function(){return x},
pause:function(){if(k){f.disable();k.hide()}return f},resume:function(){if(k){f.enable();k.show();p(f)}return f},cols:function(){return D},rows:function(){return e.length},history:function(){return k.history().data()},next:function(){if(G.length()==1)return f;else{G.front().disable();return G.rotate().enable()}},focus:function(c){f.oneTime(1,function(){if(G.length()==1)c===false?f.disable():f.enable();else if(c===false)f.next();else{G.front().disable();G.set(f);f.enable()}});return f},enable:function(){D===
v&&f.resize();if(x)if(k){k.enable();x=false}return f},disable:function(){if(!x)if(k){x=true;k.disable()}return f},enabled:function(){return x},signature:function(){var c=f.cols();c=c<15?null:c<35?0:c<55?1:c<64?2:c<75?3:4;return c!==null?ba[c].join("\n"):""},get_command:function(){return k.get()},insert:function(c){k.insert(c);return f},set_prompt:function(c){j("prompt",c)&&k.prompt(c);return f},set_command:function(c){k.set(c);return f},set_mask:function(c){k.mask(c);return f},get_output:function(){return e.join("\n")},
resize:function(c,i){if(c&&i){f.width(c);f.height(i)}D=d();k.resize(D);q.html("");g.each(e,function(r,s){l(typeof s=="function"?s():s)});p(f);return f},echo:function(c){e.push(c);return l(typeof c=="function"?c():c)},error:function(c){return f.echo(c).addClass("error")},scroll:function(c){c>f.attr("scrollTop")&&c>0&&f.attr("scrollTop",0);var i=f.attr("scrollTop");f.attr("scrollTop",i+c);return f},logout:m.login?function(){for(;o.size()>1;)o.pop();J();return f}:function(){throw"You don't have login function";
},token:m.login?function(){var c=m.name;return g.Storage.get("token"+(c?"_"+c:""))}:null,login_name:m.login?function(){var c=m.name;return g.Storage.get("login_"+(c?"_"+c:""))}:null,name:function(){return m.name},push:function(c,i){if(!i.prompt||j("prompt",i.prompt)){if(typeof c=="string")c=B(i.eval,f);o.push({name:i.name,eval:c,prompt:i.prompt,login:i.login,onStart:i.onStart,onExit:i.onExit});K()}return f},pop:function(c){c!==v&&E(c);if(o.top().name===m.name){if(m.login){J();if(typeof m.onAfterLogout==
"function")m.onAfterLogout(f)}}else{c=o.pop();K();if(typeof c.onExit=="function")c.onExit(f)}return f}});var z;switch(typeof b){case "string":z=b;b=B(b,f);break;case "object":b=function(c){return function(i){if(i!=""){i=i.split(/ */);var r=i[0];i=i.slice(1);var s=c[r];typeof s=="function"?s.apply(f,i):f.echo("Command '"+r+"' Not Found")}}}(b)}if(z&&typeof m.login=="string"||z)m.login=function(c){var i=1;return function(r,s,u){f.pause();g.jrpc(z,i++,c,[r,s],function(C){f.resume();!C.error&&C.result?
u(C.result):u(null)},function(C,t){f.resume();f.error("[AJAX] Response: "+t+"\n"+C.responseText)})}}(typeof m.login=="boolean"?"login":m.login);if(j("prompt",m.prompt)){var o=new Z({name:m.name,eval:b,prompt:m.prompt,greetings:m.greetings}),k=f.find(".terminal-output").next().cmd({prompt:m.prompt,history:m.history,width:"100%",keydown:m.keydown?function(c){return m.keydown(c,f)}:null,keypress:A,commands:M});f.livequery(function(){f.resize()});G.append(f);m.enabled?f.focus():f.disable();g(window).resize(f.resize);
if(typeof m.onInit=="function")m.onInit(f);f.click(function(){f.focus()});if(f.token&&!f.token()&&f.login_name&&!f.login_name())y();else{K();n()}typeof g.fn.init.prototype.mousewheel==="function"&&f.mousewheel(function(c,i){i>0?f.scroll(-40):f.scroll(40);return false},true)}f.data("terminal",f);return f}})(jQuery);
