/*

 |       __ _____                     ________                              __
 |      / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /
 |  __ / // // // // // _  // _// // / / // _  // _//     // //  \/ // _ \/ /
 | /  / // // // // // ___// / / // / / // ___// / / / / // // /\  // // / /__
 | \___//____ \\___//____//_/ _\_  / /_//____//_/ /_/ /_//_//_/ /_/ \__\_\___/
 |           \/              /____/                              version 0.4.4
 http://terminal.jcubic.pl

 Licensed under GNU LGPL Version 3 license
 Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>

 Includes:

 Storage plugin Distributed under the MIT License
 Copyright (c) 2010 Dave Schindler

 LiveQuery plugin Dual MIT and GPL
 Copyright (c) 2008 Brandon Aaron (http://brandonaaron.net)

 jQuery Timers licenced with the WTFPL
 <http://jquery.offput.ca/every/>

 Date: Tue, 03 Jan 2012 17:05:57 +0000
*/
Array.prototype.has=function(g){for(var A=this.length;A--;)if(this[A]==g)return true;return false};function get_stack(g){return g?[g.toString().match(/.*\n.*\n/)].concat(get_stack(g.caller)):[]}
(function(g,A){function $(a,c){var e;if(typeof a==="string"&&typeof c==="string"){localStorage[a]=c;return true}else if(typeof a==="object"&&typeof c==="undefined"){for(e in a)if(a.hasOwnProperty(e))localStorage[e]=a[e];return true}return false}function X(a,c){var e,f;e=new Date;e.setTime(e.getTime()+31536E6);e="; expires="+e.toGMTString();if(typeof a==="string"&&typeof c==="string"){document.cookie=a+"="+c+e+"; path=/";return true}else if(typeof a==="object"&&typeof c==="undefined"){for(f in a)if(a.hasOwnProperty(f))document.cookie=
f+"="+a[f]+e+"; path=/";return true}return false}function aa(a){return localStorage[a]}function ba(a){var c,e,f;a+="=";c=document.cookie.split(";");for(e=0;e<c.length;e++){for(f=c[e];f.charAt(0)===" ";)f=f.substring(1,f.length);if(f.indexOf(a)===0)return f.substring(a.length,f.length)}return null}function ca(a){return delete localStorage[a]}function da(a){return X(a,"",-1)}function W(a,c){var e=[],f=a.length;if(f<c)return[a];for(var j=0;j<f;j+=c)e.push(a.substring(j,j+c));return e}function F(a){if(typeof a==
"string"){a=a.replace(/&(?!#[0-9]*;)/g,"&amp;");a=a.replace(/</g,"&lt;").replace(/>/g,"&gt;");a=a.replace(/\n/g,"<br/>");a=a.replace(/ /g,"&nbsp;");a=a.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");var c=a.split(ea);if(c.length>1)a=g.map(c,function(e){return e===""?e:e[0]=="["?e.replace(fa,function(f,j,q,z,I){if(I==="")return"<span>&nbsp;</span>";f="";if(j.indexOf("b")!=-1)f+="font-weight:bold;";if(j.indexOf("u")!=-1)f+="text-decoration:underline;";if(j.indexOf("i")!=-1)f+="font-style:italic; ";if(q.match(Y))f+=
"color:"+q+";";if(z.match(Y))f+="background-color:"+z;return a='<span style="'+f+'">'+I+"</span>"}):"<span>"+e+"</span>"}).join("");return a}else return""}function Z(a){var c=a instanceof Array?a:a?[a]:[],e=0;g.extend(this,{left:function(){if(e===0)e=c.length-1;else--e;return c[e]},right:function(){if(e==c.length-1)e=0;else++e;return c[e]},current:function(){return c[e]},data:function(){return c},length:function(){return c.length},reset:function(){e=0},append:function(f){c.push(f);this.reset()}})}
function ga(a){var c=a?[a]:[];g.extend(this,{size:function(){return c.length},pop:function(){if(c.length===0)return null;else{var e=c[c.length-1];c=c.slice(0,c.length-1);return e}},push:function(e){c=c.concat([e]);return e},top:function(){return c.length>0?c[c.length-1]:null}})}function ha(a){var c=true;if(typeof a==="string"&&a!=="")a+="_";var e=g.Storage.get(a+"commands"),f=new Z(e?eval("("+e+")"):[""]);g.extend(this,{append:function(j){if(c&&f.current()!=j){f.append(j);g.Storage.set(a+"commands",
g.json_stringify(f.data()))}},data:function(){return f.data()},next:function(){return f.right()},last:function(){f.reset()},previous:function(){return f.left()},clear:function(){f=new Z;g.Storage.remove(a+"commands")},enable:function(){c=true},disable:function(){c=false}})}g.extend(g.fn,{livequery:function(a,c,e){var f=this,j;if(g.isFunction(a)){e=c;c=a;a=A}g.each(g.livequery.queries,function(q,z){if(f.selector==z.selector&&f.context==z.context&&a==z.type&&(!c||c.$lqguid==z.fn.$lqguid)&&(!e||e.$lqguid==
z.fn2.$lqguid))return(j=z)&&false});j=j||new g.livequery(this.selector,this.context,a,c,e);j.stopped=false;j.run();return this},expire:function(a,c,e){var f=this;if(g.isFunction(a)){e=c;c=a;a=A}g.each(g.livequery.queries,function(j,q){if(f.selector==q.selector&&f.context==q.context&&(!a||a==q.type)&&(!c||c.$lqguid==q.fn.$lqguid)&&(!e||e.$lqguid==q.fn2.$lqguid)&&!this.stopped)g.livequery.stop(q.id)});return this}});g.livequery=function(a,c,e,f,j){this.selector=a;this.context=c||document;this.type=
e;this.fn=f;this.fn2=j;this.elements=[];this.stopped=false;this.id=g.livequery.queries.push(this)-1;f.$lqguid=f.$lqguid||g.livequery.guid++;if(j)j.$lqguid=j.$lqguid||g.livequery.guid++;return this};g.livequery.prototype={stop:function(){var a=this;if(this.type)this.elements.unbind(this.type,this.fn);else this.fn2&&this.elements.each(function(c,e){a.fn2.apply(e)});this.elements=[];this.stopped=true},run:function(){if(!this.stopped){var a=this,c=this.elements,e=g(this.selector,this.context),f=e.not(c);
this.elements=e;if(this.type){f.bind(this.type,this.fn);c.length>0&&g.each(c,function(j,q){g.inArray(q,e)<0&&g.event.remove(q,a.type,a.fn)})}else{f.each(function(){a.fn.apply(this)});this.fn2&&c.length>0&&g.each(c,function(j,q){g.inArray(q,e)<0&&a.fn2.apply(q)})}}}};g.extend(g.livequery,{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if(g.livequery.running&&g.livequery.queue.length)for(var a=g.livequery.queue.length;a--;)g.livequery.queries[g.livequery.queue.shift()].run()},
pause:function(){g.livequery.running=false},play:function(){g.livequery.running=true;g.livequery.run()},registerPlugin:function(){g.each(arguments,function(a,c){if(g.fn[c]){var e=g.fn[c];g.fn[c]=function(){var f=e.apply(this,arguments);g.livequery.run();return f}}})},run:function(a){if(a!=A)g.inArray(a,g.livequery.queue)<0&&g.livequery.queue.push(a);else g.each(g.livequery.queries,function(c){g.inArray(c,g.livequery.queue)<0&&g.livequery.queue.push(c)});g.livequery.timeout&&clearTimeout(g.livequery.timeout);
g.livequery.timeout=setTimeout(g.livequery.checkQueue,20)},stop:function(a){a!=A?g.livequery.queries[a].stop():g.each(g.livequery.queries,function(c){g.livequery.queries[c].stop()})}});g.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove");g(function(){g.livequery.play()});var ia=g.prototype.init;g.prototype.init=function(a,c){var e=ia.apply(this,arguments);if(a&&a.selector){e.context=a.context;e.selector=
a.selector}if(typeof a=="string"){e.context=c||document;e.selector=a}return e};g.prototype.init.prototype=g.prototype;var Q=typeof window.localStorage!=="undefined";g.extend({Storage:{set:Q?$:X,get:Q?aa:ba,remove:Q?ca:da}});jQuery.fn.extend({everyTime:function(a,c,e,f,j){return this.each(function(){jQuery.timer.add(this,a,c,e,f,j)})},oneTime:function(a,c,e){return this.each(function(){jQuery.timer.add(this,a,c,e,1)})},stopTime:function(a,c){return this.each(function(){jQuery.timer.remove(this,a,c)})}});
jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1E3,das:1E4,hs:1E5,ks:1E6},timeParse:function(a){if(a==A||a===null)return null;var c=this.regex.exec(jQuery.trim(a.toString()));return c[2]?parseInt(c[1],10)*(this.powers[c[2]]||1):a},add:function(a,c,e,f,j,q){var z=0;if(jQuery.isFunction(e)){j||(j=f);f=e;e=c}c=jQuery.timer.timeParse(c);if(!(typeof c!="number"||isNaN(c)||c<=0)){if(j&&j.constructor!=Number){q=!!j;j=0}j=j||0;q=q||false;if(!a.$timers)a.$timers=
{};a.$timers[e]||(a.$timers[e]={});f.$timerID=f.$timerID||this.guid++;var I=function(){if(!(q&&this.inProgress)){this.inProgress=true;if(++z>j&&j!==0||f.call(a,z)===false)jQuery.timer.remove(a,e,f);this.inProgress=false}};I.$timerID=f.$timerID;a.$timers[e][f.$timerID]||(a.$timers[e][f.$timerID]=window.setInterval(I,c));this.global[e]||(this.global[e]=[]);this.global[e].push(a)}},remove:function(a,c,e){var f=a.$timers,j;if(f){if(c){if(f[c]){if(e){if(e.$timerID){window.clearInterval(f[c][e.$timerID]);
delete f[c][e.$timerID]}}else for(e in f[c]){window.clearInterval(f[c][e]);delete f[c][e]}for(j in f[c])break;if(!j){j=null;delete f[c]}}}else for(c in f)this.remove(a,c,e);for(j in f)break;if(!j)a.$timers=null}}}});if(jQuery.browser.msie)jQuery(window).one("unload",function(){var a=jQuery.timer.global,c;for(c in a)for(var e=a[c],f=e.length;--f;)jQuery.timer.remove(e[f],c)});var ea=/(\[\[[biu]*;[^;]*;[^\]]*\][^\]\[]*\])/g,fa=/\[\[([biu]*);([^;]*);([^\]]*)\]([^\]\[]*)\]/g,Y=/#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})/;
g.json_stringify=function(a,c){var e="",f;c=c===A?1:c;switch(typeof a){case "function":e+=a;break;case "boolean":e+=a?"true":"false";break;case "object":if(a===null)e+="null";else if(a instanceof Array){e+="[";var j=a.length;for(f=0;f<j-1;++f)e+=g.json_stringify(a[f],c+1);e+=g.json_stringify(a[j-1],c+1)+"]"}else{e+="{";for(j in a)if(a.hasOwnProperty(j))e+='"'+j+'":'+g.json_stringify(a[j],c+1);e+="}"}break;case "string":j=a;var q={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};
for(f in q)if(q.hasOwnProperty(f))j=j.replace(RegExp(f,"g"),q[f]);e+='"'+j+'"';break;case "number":e+=String(a)}e+=c>1?",":"";if(c==1)e=e.replace(/,([\]}])/g,"$1");return e.replace(/([\[{]),/g,"$1")};g.fn.cmd=function(a){function c(){L.toggleClass("inverted")}function e(){j.focus();f.oneTime(1,function(){f.insert(j.val());j.blur();j.val("")})}var f=this;f.addClass("cmd");f.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');var j=g("<textarea/>").addClass("clipboard").appendTo(f);
a.width&&f.width(a.width);var q,z,I=a.mask||false,o="",m=0,M,N=a.enabled,R,G,L=f.find(".cursor"),K=function(h){function r(t,v){if(v==t.length){k.html(F(t));L.html("&nbsp;");H.html("")}else if(v===0){k.html("");L.html(F(t.slice(0,1)));H.html(F(t.slice(1)))}else{var n=F(t.slice(0,v));k.html(n);n=t.slice(v,v+1);L.html(n==" "?"&nbsp;":F(n));v==t.lenght-1?H.html(""):H.html(F(t.slice(v+1)))}}function S(t){return"<div>"+F(t)+"</div>"}function J(t){var v=H;g.each(t,function(n,B){v=g(S(B)).insertAfter(v).addClass("clear")})}
function T(t){g.each(t,function(v,n){k.before(S(n))})}var k=L.prev(),H=L.next();return function(){var t=I?o.replace(/./g,"*"):o,v;h.find("div").remove();k.html("");if(t.length>q-z-1||t.match(/\n/)){var n;if(t.match(/\n/)){var B=t.split("\n"),y=q-z-1;for(v=0;v<B.length-1;++v)B[v]+=" ";if(B[0].length>y){n=[B[0].substring(0,y)];n=n.concat(W(B[0].substring(y),q))}else n=[B[0]];for(v=1;v<B.length;++v)if(B[v].length>q)n=n.concat(W(B[v],q));else n.push(B[v])}else{n=t.substring(0,q-z-1);y=t.substring(q-z-
1);n=[n].concat(W(y,q))}y=n[0].length;if(m<y){r(n[0],m);J(n.slice(1))}else if(m==y){k.before(S(n[0]));r(n[1],0);J(n.slice(2))}else{v=n.length;if(m<y){r(n[0],m);J(n.slice(1))}else if(m==y){k.before(S(n[0]));r(n[1],0);J(n.slice(2))}else{B=n.slice(-1)[0];var u=t.length-m;t=0;if(u<=B.length){T(n.slice(0,-1));t=B.length==u?0:B.length-u;r(B,t)}else if(v==3){k.before("<div>"+F(n[0])+"</div>");r(n[1],m-y-1);H.after('<div class="clear">'+F(n[2])+"</div>")}else{t=m;for(v=0;v<n.length;++v)if(t>n[v].length)t-=
n[v].length;else break;y=n[v];if(t==y.length){t=0;y=n[++v]}r(y,t);T(n.slice(0,v));J(n.slice(v+1))}}}}else if(t===""){k.html("");L.html("&nbsp;");H.html("")}else r(t,m)}}(f),d=function(){var h=f.find(".prompt");return function(){if(typeof M=="string"){z=M.length;h.html(F(M)+"&nbsp;")}else M(function(r){z=r.length;h.html(F(r)+"&nbsp;")})}}();g.extend(f,{name:function(h){if(h!==A){R=h;G=new ha(h)}else return R},history:function(){return G},set:function(h,r){if(h!==A){o=h;if(!r)m=o.length;K()}},insert:function(h,
r){if(m==o.length)o+=h;else o=m===0?h+o:o.slice(0,m)+h+o.slice(m);r||(m+=h.length);K()},get:function(){return o},commands:function(h){if(h)a.commands=h;else return h},destroy:function(){g(document.documentElement).unbind(".commandline");f.find(".prompt").remove()},prompt:function(h){if(h===A)return M;else{if(typeof h=="string"||typeof h=="function")M=h;else throw"prompt must be a function or string";d()}},position:function(h){if(typeof h=="number"){m=h<0?0:h>o.length?o.length:h;K()}else return m},
resize:function(h){if(h)q=h;else{h=f.width();var r=L.innerWidth();q=Math.floor(h/r)}K()},enable:function(){if(!N){f.everyTime(500,"blink",c);N=true}},isenabled:function(){return N},disable:function(){if(N){f.stopTime("blink",c);f.find(".cursor").removeClass("inverted");N=false}},mask:function(h){if(typeof h=="boolean"){I=h;K()}else return I}});f.name(a.name||"");M=a.prompt||">";d();if(a.enabled===A||a.enabled===true)f.enable();g(document.documentElement).keypress(function(h){var r;if(h.ctrlKey&&h.which==
99)return true;if(a.keypress)r=a.keypress(h);if(r===A||r){if(N)if([38,32,13,0,8].has(h.which)&&h.keyCode!=123&&!(h.which==38&&h.shiftKey))return false;else if(!h.ctrlKey&&!(h.altKey&&h.which==100)){f.insert(String.fromCharCode(h.which));return false}}else return r}).keydown(function(h){if(N){if(a.keydown&&a.keydown(h)===false)return false;var r;if(h.keyCode==13){G&&o&&G.append(o);G.last();h=o;f.set("");typeof M=="function"&&d();a.commands&&a.commands(h)}else if(h.which==32)f.insert(" ");else if(h.which==
8){if(o!==""&&m>0){o=o.slice(0,m-1)+o.slice(m,o.length);--m;K()}}else if(h.which==9&&!(h.ctrlKey||h.altKey))f.insert("\t");else if(h.which==46){if(o!==""&&m<o.length){o=o.slice(0,m)+o.slice(m+1,o.length);K()}return true}else if(G&&h.which==38||h.which==80&&h.ctrlKey)f.set(G.previous());else if(G&&h.which==40||h.which==78&&h.ctrlKey)f.set(G.next());else if(h.which==37||h.which==66&&h.ctrlKey)if(h.ctrlKey&&h.which!=66){r=m-1;h=0;for(o[r]==" "&&--r;r>0;--r)if(o[r]==" "&&o[r+1]!=" "){h=r+1;break}else if(o[r]==
"\n"&&o[r+1]!="\n"){h=r;break}f.position(h)}else{if(m>0){--m;K()}}else if(h.which==39||h.which==70&&h.ctrlKey)if(h.ctrlKey&&h.which!=70){o[m]==" "&&++m;h=o.slice(m).match(/\S[\n\s]{2,}|[\n\s]+\S?/);if(!h||h[0].match(/^\s+$/))m=o.length;else if(h[0][0]!=" ")m+=h.index+1;else{m+=h.index+h[0].length-1;h[0][h[0].length-1]!=" "&&--m}K()}else{if(m<o.length){++m;K()}}else if(h.which==123)return true;else if(h.which==36)f.position(0);else if(h.which==35)f.position(o.length);else if(h.ctrlKey||h.metaKey)if(h.shiftKey){if(h.which==
84)return true}else if(h.which==65)f.position(0);else if(h.which==69)f.position(o.length);else if(h.which==88||h.which==67||h.which==87||h.which==84)return true;else if(h.which==86){e();return true}else if(h.which==75)if(m===0)f.set("");else m!=o.length&&f.set(o.slice(0,m));else if(h.which==85)f.set("");else{if(h.which==17)return true}else if(h.altKey)h.which==68&&f.set(o.slice(0,m)+o.slice(m).replace(/[^ ]+ |[^ ]+$/,""),true);else return true;return false}});return f};g.jrpc=function(a,c,e,f,j,q){c=
g.json_stringify({jsonrpc:"2.0",method:e,params:f,id:c});return g.ajax({url:a,data:c,success:j,error:q,contentType:"application/json",dataType:"json",async:true,cache:false,type:"POST"})};Q=/ {13}$/;var ja=[["jQuery Terminal","(c) 2011 jcubic"],["JQuery Terminal Emulator v. 0.4.4","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>".replace(/ *<.*>/,"")],["JQuery Terminal Emulator version version 0.4.4","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],["      _______                 ________                        __",
"     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/","         \\/          /____/                                   ".replace(Q,"")+"version 0.4.4","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],["      __ _____                     ________                              __",
"     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/","          \\/              /____/                                          ".replace(Q,"")+"version 0.4.4","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"]],ka=[],O=new function(a){var c=
a?[a]:[],e=0;g.extend(this,{rotate:function(){if(c.length==1)return c[0];else{if(e==c.length-1)e=0;else++e;return c[e]}},length:function(){return c.length},set:function(f){for(var j=c.length;j--;)if(c[j]===f){e=j;return}this.append(f)},front:function(){return c[e]},append:function(f){c.push(f)}})};g.fn.terminal=function(a,c){function e(){return d.get(0).scrollHeight>d.innerHeight()}function f(){var b=d.find(".cursor");b=Math.floor(d.width()/b.width());if(e())b-=2;return b}function j(b,i){d.error("&#91;"+
i+"&#93;: "+(typeof b=="string"?b:b.fileName+": "+b.message));d.pause();typeof b.fileName=="string"&&g.get(b.fileName,function(l){d.resume();var w=b.lineNumber-1;(l=l.split("\n")[w])&&d.error("&#91;"+b.lineNumber+"&#93;: "+l)})}function q(b,i){try{if(typeof i=="function")i(function(){});else if(typeof i!="string")throw b+" must be string or function";}catch(l){j(l,b.toUpperCase());return false}return true}function z(){var b=d.prop?d.prop("scrollHeight"):d.attr("scrollHeight");d.scrollTop(b)}function I(b){b=
typeof b=="string"?b:String(b);var i,l,w;if(b.length>J){i=J;var p=[];l=/(\[\[[biu]*;[^;]*;\][^\]\[]*\]?)/g;w=/(\[\[[biu]*;[^;]*;\])/;b=b.split(/\n/g);for(var x="",s=0,D=b.length;s<D;++s){if(x!=="")if(b[s]===""){p.push(x+"]");continue}else{b[s]=x+b[s];x=""}for(var C=0,V=b[s].length;C<V;C+=i){var E=b[s].substring(C,C+i);if(x!=="")E=x+E;var P=E.match(l);if(P&&P.length>0){var U=0;E=0;for(var la=P.length;E<la;++E){U+=P[E].match(w)[1].length;if(P[E][P[E].length-1]=="]")U+=1}if(x!=="")U-=x.length;E=x+b[s].substring(C,
C+i+U);P=E.match(l);x=P[P.length-1];C+=U;if(x[x.length-1]!="]"){E+="]";x=x.match(w)[1]}else x=""}else x="";p.push(E)}}i=g("<div></div>");l=0;for(w=p.length;l<w;++l)p[l]===""||p[l]=="\r"?i.append("<div>&nbsp;</div>"):g("<div/>").html(F(p[l])).appendTo(i)}else i=g("<div/>").html(F(b));r.append(i);i.width("100%");z();return i}function o(b,i){var l=1,w=function(p,x){i.pause();g.jrpc(b,l++,p,x,function(s){if(s.error)i.error("&#91;RPC&#93; "+s.error.message);else if(typeof s.result=="string")i.echo(s.result);
else if(s.result instanceof Array)i.echo(s.result.join(" "));else if(typeof s.result=="object"){var D="",C;for(C in s.result)if(s.result.hasOwnProperty(C))D+=C+": "+s.result[C]+"\n";i.echo(D)}i.resume()},function(s,D){i.error("&#91;AJAX&#93; "+D+" - Server reponse is: \n"+s.responseText);i.resume()})};return function(p,x){if(p!==""){var s,D;if(p.match(/[^ ]* /)){p=p.split(/ +/);s=p[0];D=p.slice(1)}else{s=p;D=[]}if(!k.login||s=="help")w(s,D);else{var C=x.token();C?w(s,[C].concat(D)):x.error("&#91;AUTH&#93; Access denied (no token)")}}}}
function m(b){var i=u.prompt();if(u.mask())b=b.replace(/./g,"*");typeof i=="function"?i(function(l){d.echo(l+" "+b)}):d.echo(i+" "+b)}function M(b){try{var i=y.top();if(b=="exit"&&k.exit)if(y.size()==1)k.login?R():d.echo("You can exit from main interpeter");else d.pop("exit");else{m(b);if(b=="clear"&&k.clear)d.clear();else if(b.match(/\|/)){var l=b.split(/\s*\|\s*/),w=[],p=d.echo;d.echo=function(E){w.push(E)};i.eval(l[0],d);b=1;for(var x=l.length;b<x-1;++b)for(var s=0,D=w.length;s<D;++s){var C=l[b]+
" "+w[s];i.eval(C,d)}d.echo=p;s=0;for(D=w.length;s<D;++s){C=l[x-1]+" "+w[s];i.eval(C,d)}}else i.eval(b,d)}}catch(V){j(V,"USER");d.resume();throw V;}}function N(){var b=null;u.prompt("login:");k.history&&u.history().disable();u.commands(function(i){try{m(i);if(b){u.mask(false);d.pause();if(typeof k.login!="function")throw"Value of login property must be a function";k.login(b,i,function(w){if(w){var p=k.name;p=p?"_"+p:"";g.Storage.set("token"+p,w);g.Storage.set("login"+p,b);u.commands(M);L()}else{d.error("Wrong password try again");
u.prompt("login:");b=null}d.resume();k.history&&u.history().enable()})}else{b=i;u.prompt("password:");u.mask(true)}}catch(l){j(l,"LOGIN",d);throw l;}})}function R(){var b=k.name;b=b?"_"+b:"";g.Storage.remove("token"+b,null);g.Storage.remove("login"+b,null);k.history&&u.history().disable();N()}function G(){var b=y.top(),i="";if(b.name!==A&&b.name!=="")i+=b.name+"_";i+=S;u.name(i);u.prompt(b.prompt);k.history&&u.history().enable();u.set("");if(typeof b.onStart=="function")b.onStart(d)}function L(){G();
if(c.greetings===A)d.echo(d.signature);else c.greetings&&d.echo(c.greetings);if(typeof k.onInit=="function")k.onInit(d)}function K(b){setTimeout(function(){if(v!=e()){d.resize();v=e()}},1);if(!d.paused()){if(k.keydown&&k.keydown(b,d)===false)return false;if(b.which!=9)t=0;if(b.which==68&&b.ctrlKey){if(k.exit)if(u.get()==="")if(y.size()>1||k.login!==A)d.pop("");else{d.resume();d.echo("")}else d.set_command("");b.preventDefault()}else if(k.tabcompletion&&b.which==9){++t;b=u.get();if(!b.match(" ")){for(var i=
RegExp("^"+b),l=y.top().command_list,w=[],p=l.length;p--;)i.test(l[p])&&w.push(l[p]);if(w.length==1)d.set_command(w[0]);else if(w.length>1)if(t>=2){m(b);d.echo(w.join("\t"));t=0}}return false}else if(b.which==86&&b.ctrlKey){d.oneTime(1,function(){z()});return true}else if(b.which==9&&b.ctrlKey){O.length()>1&&d.focus(false);b.preventDefault()}else if(b.which==34)d.scroll(d.height());else b.which==33?d.scroll(-d.height()):d.attr({scrollTop:d.attr("scrollHeight")})}}var d=this,h=[],r,S=O.length(),J,
T=[],k={name:"",prompt:">",history:true,exit:true,clear:true,enabled:true,login:null,tabcompletion:false,onInit:null,onExit:null,keypress:null,keydown:null};if(c){c.width&&d.width(c.width);c.height&&d.height(c.height);g.extend(k,c)}var H=!k.enabled;if(d.length===0)throw'Sorry, but terminal said that "'+d.selector+'" is not valid selector!';d.ajaxSend(function(b,i){ka.push(i)});if(d.data("terminal"))return d.data("terminal");r=g("<div>").addClass("terminal-output").appendTo(d);d.addClass("terminal").append("<div/>");
g.extend(d,{clear:function(){r.html("");u.set("");h=[];d.attr({scrollTop:0});return d},paused:function(){return H},pause:function(){if(u){d.disable();u.hide()}return d},resume:function(){if(u){d.enable();u.show();z()}return d},cols:function(){return J},rows:function(){return h.length},history:function(){return u.history().data()},next:function(){if(O.length()==1)return d;else{var b=d.offset().top;d.height();d.scrollTop();var i=d,l=g(window).scrollTop(),w=l+g(window).height(),p=g(i).offset().top;if(p+
g(i).height()>=l&&p<=w){O.front().disable();b=O.rotate().enable();i=b.offset().top-50;g("html,body").animate({scrollTop:i},500);return b}else{d.enable();g("html,body").animate({scrollTop:b-50},500);return d}}},focus:function(b){d.oneTime(1,function(){if(O.length()==1)b===false?d.disable():d.enable();else if(b===false)d.next();else{O.front().disable();O.set(d);d.enable()}});return d},enable:function(){J===A&&d.resize();if(H)if(u){u.enable();H=false}return d},disable:function(){if(u){H=true;u.disable()}return d},
enabled:function(){return H},signature:function(){var b=d.cols();b=b<15?null:b<35?0:b<55?1:b<64?2:b<75?3:4;return b!==null?ja[b].join("\n")+"\n":""},version:function(){return"0.4.4"},get_command:function(){return u.get()},insert:function(b){u.insert(b);return d},set_prompt:function(b){q("prompt",b)&&u.prompt(b);return d},set_command:function(b){u.set(b);return d},set_mask:function(b){u.mask(b);return d},get_output:function(){return g.map(h,function(b,i){return typeof i=="function"?i():i}).get().join("\n")},
resize:function(b,i){if(b&&i){d.width(b);d.height(i)}J=f();u.resize(J);var l=r.detach();r.html("");g.each(h,function(w,p){I(typeof p=="function"?p():p)});d.prepend(l);z();return d},echo:function(b){h.push(b);return I(typeof b=="function"?b():b)},error:function(b){d.echo("[[;#f00;]"+b.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")+"]")},scroll:function(b){var i;if(d.prop){b>d.prop("scrollTop")&&b>0&&d.prop("scrollTop",0);i=d.prop("scrollTop");d.prop("scrollTop",i+b)}else{b>d.attr("scrollTop")&&b>0&&
d.attr("scrollTop",0);i=d.attr("scrollTop");d.attr("scrollTop",i+b)}return d},logout:k.login?function(){for(;y.size()>1;)y.pop();R();return d}:function(){throw"You don't have login function";},token:k.login?function(){var b=k.name;return g.Storage.get("token"+(b?"_"+b:""))}:null,login_name:k.login?function(){var b=k.name;return g.Storage.get("login"+(b?"_"+b:""))}:null,name:function(){return k.name},push:function(b,i){if(!i.prompt||q("prompt",i.prompt)){if(typeof b=="string")b=o(i.eval,d);y.push(g.extend({eval:b},
i));G()}return d},pop:function(b){b!==A&&m(b);if(y.top().name===k.name){if(k.login){R();if(typeof k.onExit=="function")k.onExit(d)}}else{b=y.pop();G();if(typeof b.onExit=="function")b.onExit(d)}return d}});var t=0,v=e(),n;if(a.constructor==String){n=a;a=o(a,d)}else if(a.constructor==Array)throw"You can't use array as eval";else if(typeof a=="object"){for(var B in a)T.push(B);a=function b(i){return function(l){if(l!==""){l=l.split(/ +/);var w=l[0],p=l.slice(1);l=i[w];var x=typeof l;if(x=="function")l.apply(d,
p);else if(x=="object"||x=="string"){p=[];if(x=="object"){for(var s in l)p.push(s);l=b(l)}d.push(l,{prompt:w+">",name:w,command_list:p})}else d.error("Command '"+w+"' Not Found")}}}(a)}else if(typeof a!="function")throw'Unknow object "'+String(a)+'" passed as eval';if(n&&(typeof k.login=="string"||k.login))k.login=function(b){var i=1;return function(l,w,p){d.pause();g.jrpc(n,i++,b,[l,w],function(x){d.resume();!x.error&&x.result?p(x.result):p(null)},function(x,s){d.resume();d.error("&#91;AJAX&#92; Response: "+
s+"\n"+x.responseText)})}}(typeof k.login=="boolean"?"login":k.login);if(q("prompt",k.prompt)){var y=new ga({name:k.name,eval:a,prompt:k.prompt,command_list:T,greetings:k.greetings}),u=d.find(".terminal-output").next().cmd({prompt:k.prompt,history:k.history,width:"100%",keydown:K,keypress:k.keypress?function(b){return k.keypress(b,d)}:null,commands:M});d.livequery(function(){d.resize()});O.append(d);k.enabled===true?d.focus():d.disable();g(window).resize(d.resize);d.click(function(){d.focus()});d.token&&
!d.token()&&d.login_name&&!d.login_name()?N():L();typeof g.fn.init.prototype.mousewheel==="function"&&d.mousewheel(function(b,i){i>0?d.scroll(-40):d.scroll(40);return false},true)}d.data("terminal",d);return d}})(jQuery);
