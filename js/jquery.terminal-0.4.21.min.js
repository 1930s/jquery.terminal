/*

 |       __ _____                     ________                              __
 |      / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /
 |  __ / // // // // // _  // _// // / / // _  // _//     // //  \/ // _ \/ /
 | /  / // // // // // ___// / / // / / // ___// / / / / // // /\  // // / /__
 | \___//____ \\___//____//_/ _\_  / /_//____//_/ /_/ /_//_//_/ /_/ \__\_\___/
 |           \/              /____/                              version 0.4.20
 http://terminal.jcubic.pl

 Licensed under GNU LGPL Version 3 license
 Copyright (c) 2011-2012 Jakub Jankiewicz <http://jcubic.pl>

 Includes:

 Storage plugin Distributed under the MIT License
 Copyright (c) 2010 Dave Schindler

 jQuery Timers licenced with the WTFPL
 <http://jquery.offput.ca/every/>

 Cross-Browser Split 1.1.1
 Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
 Available under the MIT License

 Date: Wed, 26 Sep 2012 19:33:14 +0000
*/
(function(k,J){function $(c,g){var f;if(typeof c==="string"&&typeof g==="string"){localStorage[c]=g;return true}else if(typeof c==="object"&&typeof g==="undefined"){for(f in c)if(c.hasOwnProperty(f))localStorage[f]=c[f];return true}return false}function W(c,g){var f,h;f=new Date;f.setTime(f.getTime()+31536E6);f="; expires="+f.toGMTString();if(typeof c==="string"&&typeof g==="string"){document.cookie=c+"="+g+f+"; path=/";return true}else if(typeof c==="object"&&typeof g==="undefined"){for(h in c)if(c.hasOwnProperty(h))document.cookie=
h+"="+c[h]+f+"; path=/";return true}return false}function aa(c){return localStorage[c]}function ba(c){var g,f,h;c+="=";g=document.cookie.split(";");for(f=0;f<g.length;f++){for(h=g[f];h.charAt(0)===" ";)h=h.substring(1,h.length);if(h.indexOf(c)===0)return h.substring(c.length,h.length)}return null}function ca(c){return delete localStorage[c]}function da(c){return W(c,"",-1)}function U(c,g){var f=[],h=c.length;if(h<g)return[c];for(var i=0;i<h;i+=g)f.push(c.substring(i,i+g));return f}function X(c){var g=
c instanceof Array?c:c?[c]:[],f=0;k.extend(this,{left:function(){if(f===0)f=g.length-1;else--f;return g[f]},right:function(){if(f===g.length-1)f=0;else++f;return g[f]},current:function(){return g[f]},data:function(){return g},length:function(){return g.length},reset:function(){f=0},append:function(h){g.push(h);this.reset()}})}function ea(c){var g=c?[c]:[];k.extend(this,{size:function(){return g.length},pop:function(){if(g.length===0)return null;else{var f=g[g.length-1];g=g.slice(0,g.length-1);return f}},
push:function(f){g=g.concat([f]);return f},top:function(){return g.length>0?g[g.length-1]:null}})}function fa(c){var g=true;if(typeof c==="string"&&c!=="")c+="_";var f=k.Storage.get(c+"commands"),h=new X(f?eval("("+f+")"):[""]);k.extend(this,{append:function(i){if(g){h.append(i);k.Storage.set(c+"commands",k.json_stringify(h.data()))}},data:function(){return h.data()},next:function(){return h.right()},last:function(){h.reset()},previous:function(){return h.left()},clear:function(){h=new X;k.Storage.remove(c+
"commands")},enable:function(){g=true},disable:function(){g=false}})}k.omap=function(c,g){var f={};k.each(c,function(h,i){f[h]=g.call(c,h,i)});return f};var R=typeof window.localStorage!=="undefined";k.extend({Storage:{set:R?$:W,get:R?aa:ba,remove:R?ca:da}});jQuery.fn.extend({everyTime:function(c,g,f,h,i){return this.each(function(){jQuery.timer.add(this,c,g,f,h,i)})},oneTime:function(c,g,f){return this.each(function(){jQuery.timer.add(this,c,g,f,1)})},stopTime:function(c,g){return this.each(function(){jQuery.timer.remove(this,
c,g)})}});jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1E3,das:1E4,hs:1E5,ks:1E6},timeParse:function(c){if(c===J||c===null)return null;var g=this.regex.exec(jQuery.trim(c.toString()));return g[2]?parseInt(g[1],10)*(this.powers[g[2]]||1):c},add:function(c,g,f,h,i,o){var s=0;if(jQuery.isFunction(f)){i||(i=h);h=f;f=g}g=jQuery.timer.timeParse(g);if(!(typeof g!=="number"||isNaN(g)||g<=0)){if(i&&i.constructor!==Number){o=!!i;i=0}i=i||0;o=o||false;if(!c.$timers)c.$timers=
{};c.$timers[f]||(c.$timers[f]={});h.$timerID=h.$timerID||this.guid++;var m=function(){if(!(o&&m.inProgress)){m.inProgress=true;if(++s>i&&i!==0||h.call(c,s)===false)jQuery.timer.remove(c,f,h);m.inProgress=false}};m.$timerID=h.$timerID;c.$timers[f][h.$timerID]||(c.$timers[f][h.$timerID]=window.setInterval(m,g));this.global[f]||(this.global[f]=[]);this.global[f].push(c)}},remove:function(c,g,f){var h=c.$timers,i;if(h){if(g){if(h[g]){if(f){if(f.$timerID){window.clearInterval(h[g][f.$timerID]);delete h[g][f.$timerID]}}else for(var o in h[g])if(h[g].hasOwnProperty(o)){window.clearInterval(h[g][o]);
delete h[g][o]}for(i in h[g])if(h[g].hasOwnProperty(i))break;if(!i){i=null;delete h[g]}}}else for(var s in h)h.hasOwnProperty(s)&&this.remove(c,s,f);for(i in h)if(h.hasOwnProperty(i))break;if(!i)c.$timers=null}}}});if(jQuery.browser.msie)jQuery(window).one("unload",function(){var c=jQuery.timer.global,g;for(g in c)if(c.hasOwnProperty(g))for(var f=c[g],h=f.length;--h;)jQuery.timer.remove(f[h],g)});(function(c){if(String.prototype.split.toString().match(/\[native/)){var g=String.prototype.split,f=/()??/.exec("")[1]===
c,h;h=function(i,o,s){if(Object.prototype.toString.call(o)!=="[object RegExp]")return g.call(i,o,s);var m=[],v=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.extended?"x":"")+(o.sticky?"y":""),w=0,A,x,C;o=RegExp(o.source,v+"g");i+="";f||(A=RegExp("^"+o.source+"$(?!\\s)",v));for(s=s===c?4294967295:s>>>0;x=o.exec(i);){v=x.index+x[0].length;if(v>w){m.push(i.slice(w,x.index));!f&&x.length>1&&x[0].replace(A,function(){for(var E=1;E<arguments.length-2;E++)if(arguments[E]===c)x[E]=c});x.length>1&&x.index<
i.length&&Array.prototype.push.apply(m,x.slice(1));C=x[0].length;w=v;if(m.length>=s)break}o.lastIndex===x.index&&o.lastIndex++}if(w===i.length){if(C||!o.test(""))m.push("")}else m.push(i.slice(w));return m.length>s?m.slice(0,s):m};String.prototype.split=function(i,o){return h(this,i,o)};return h}})();k.json_stringify=function(c,g){var f="",h;g=g===J?1:g;switch(typeof c){case "function":f+=c;break;case "boolean":f+=c?"true":"false";break;case "object":if(c===null)f+="null";else if(c instanceof Array){f+=
"[";var i=c.length;for(h=0;h<i-1;++h)f+=k.json_stringify(c[h],g+1);f+=k.json_stringify(c[i-1],g+1)+"]"}else{f+="{";for(i in c)if(c.hasOwnProperty(i))f+='"'+i+'":'+k.json_stringify(c[i],g+1);f+="}"}break;case "string":i=c;var o={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};for(h in o)if(o.hasOwnProperty(h))i=i.replace(RegExp(h,"g"),o[h]);f+='"'+i+'"';break;case "number":f+=String(c)}f+=g>1?",":"";if(g===1)f=f.replace(/,([\]}])/g,"$1");return f.replace(/([\[{]),/g,"$1")};k.fn.cmd=
function(c){function g(){H.toggleClass("inverted")}function f(){y="(reverse-i-search)`"+C+"': ";G()}function h(d){var q=D.data(),M=RegExp("^"+C),K=q.length;if(d&&E>0)K-=E;for(d=K;d--;)if(M.test(q[d])){E=q.length-d;a=0;m.set(q[d],true);l();break}}function i(d){var q=d.substring(0,w-A);d=d.substring(w-A);return[q].concat(U(d,w))}function o(){v.focus();m.oneTime(1,function(){m.insert(v.val());v.blur().val("")})}function s(d){if(c.keydown&&c.keydown(d)===false)return false;if(I){var q;if(x&&(d.which===
35||d.which===36||d.which===37||d.which===38||d.which===39||d.which===40||d.which===66||d.which===13||d.which===27)){y=O;x=false;E=null;C="";G();if(d.which===27)p="";l();s.call(this,d)}else if(d.altKey){if(d.which===68){m.set(p.slice(0,a)+p.slice(a).replace(/[^ ]+ |[^ ]+$/,""),true);return false}return true}else if(d.keyCode===13){if(D&&p&&(c.historyFilter&&c.historyFilter(p)||!c.historyFilter))D.data().slice(-1)[0]!==p&&D.append(p);D.last();d=p;m.set("");c.commands&&c.commands(d);typeof y==="function"&&
G()}else if(d.which===32)if(x){C+=" ";f()}else m.insert(" ");else if(d.which===8)if(x){C=C.slice(0,-1);f()}else{if(p!==""&&a>0){p=p.slice(0,a-1)+p.slice(a,p.length);--a;l()}}else if(d.which===9&&!(d.ctrlKey||d.altKey))m.insert("\t");else if(d.which===46){if(p!==""&&a<p.length){p=p.slice(0,a)+p.slice(a+1,p.length);l()}return true}else if(D&&d.which===38||d.which===80&&d.ctrlKey)m.set(D.previous());else if(D&&d.which===40||d.which===78&&d.ctrlKey)m.set(D.next());else if(d.which===37||d.which===66&&
d.ctrlKey)if(d.ctrlKey&&d.which!==66){q=a-1;d=0;for(p[q]===" "&&--q;q>0;--q)if(p[q]===" "&&p[q+1]!==" "){d=q+1;break}else if(p[q]==="\n"&&p[q+1]!=="\n"){d=q;break}m.position(d)}else{if(a>0){--a;l()}}else if(d.which===82&&d.ctrlKey)if(x)h(true);else{O=y;f();p="";l();x=true}else if(d.which===39||d.which===70&&d.ctrlKey)if(d.ctrlKey&&d.which!==70){p[a]===" "&&++a;d=p.slice(a).match(/\S[\n\s]{2,}|[\n\s]+\S?/);if(!d||d[0].match(/^\s+$/))a=p.length;else if(d[0][0]!==" ")a+=d.index+1;else{a+=d.index+d[0].length-
1;d[0][d[0].length-1]!==" "&&--a}l()}else{if(a<p.length){++a;l()}}else if(d.which===123)return true;else if(d.which===36)m.position(0);else if(d.which===35)m.position(p.length);else if(d.ctrlKey||d.metaKey)if(d.shiftKey){if(d.which===84)return true}else if(d.which===65)m.position(0);else if(d.which===69)m.position(p.length);else if(d.which===88||d.which===67||d.which===87||d.which===84)return true;else if(d.which===86){o();return true}else if(d.which===75)if(a===0)m.set("");else a!==p.length&&m.set(p.slice(0,
a));else if(d.which===85){m.set(p.slice(a,p.length));m.position(0)}else{if(d.which===17)return true}else return true;return false}}var m=this;m.addClass("cmd");m.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');var v=k("<textarea/>").addClass("clipboard").appendTo(m);c.width&&m.width(c.width);var w,A,x=false,C="",E=null,O,F=c.mask||false,p="",a=0,y,I=c.enabled,T,D,H=m.find(".cursor"),l=function(d){function q(n,b){if(b===n.length){L.html(k.terminal.encode(n));
H.html("&nbsp;");B.html("")}else if(b===0){L.html("");H.html(k.terminal.encode(n.slice(0,1)));B.html(k.terminal.encode(n.slice(1)))}else{var e=k.terminal.encode(n.slice(0,b));L.html(e);e=n.slice(b,b+1);H.html(e===" "?"&nbsp;":k.terminal.encode(e));b===n.length-1?B.html(""):B.html(k.terminal.encode(n.slice(b+1)))}}function M(n){return"<div>"+k.terminal.encode(n)+"</div>"}function K(n){var b=B;k.each(n,function(e,j){b=k(M(j)).insertAfter(b).addClass("clear")})}function S(n){k.each(n,function(b,e){L.before(M(e))})}
var L=H.prev(),B=H.next();return function(){var n=F?p.replace(/./g,"*"):p,b,e;d.find("div").remove();L.html("");if(n.length>w-A-1||n.match(/\n/)){var j,u=n.match(/\t/g),r=u?u.length*3:0;if(u)n=n.replace(/\t/g,"\u0000\u0000\u0000\u0000");if(n.match(/\n/)){var t=n.split("\n");e=w-A-1;for(b=0;b<t.length-1;++b)t[b]+=" ";if(t[0].length>e){j=[t[0].substring(0,e)];j=j.concat(U(t[0].substring(e),w))}else j=[t[0]];for(b=1;b<t.length;++b)if(t[b].length>w)j=j.concat(U(t[b],w));else j.push(t[b])}else j=i(n);
if(u)j=k.map(j,function(N){return N.replace(/\x00\x00\x00\x00/g,"\t")});e=j[0].length;if(a<e){q(j[0],a);K(j.slice(1))}else if(a===e){L.before(M(j[0]));q(j[1],0);K(j.slice(2))}else{b=j.length;if(a<e){q(j[0],a);K(j.slice(1))}else if(a===e){L.before(M(j[0]));q(j[1],0);K(j.slice(2))}else{u=j.slice(-1)[0];t=n.length-a;var z=u.length;n=0;if(t<=z){S(j.slice(0,-1));q(u,(z===t?0:z-t)+r)}else if(b===3){L.before("<div>"+k.terminal.encode(j[0])+"</div>");q(j[1],a-e-1);B.after('<div class="clear">'+k.terminal.encode(j[2])+
"</div>")}else{n=a;for(b=0;b<j.length;++b){e=j[b].length;if(n>e)n-=e;else break}e=j[b];r=b;if(n===e.length){n=0;e=j[++r]}q(e,n);S(j.slice(0,r));K(j.slice(r+1))}}}}else if(n===""){L.html("");H.html("&nbsp;");B.html("")}else q(n,a)}}(m),G=function(){var d=m.find(".prompt");return function(){if(typeof y==="string"){A=k.terminal.strip(y).length;d.html(k.terminal.format(y))}else y(function(q){A=k.terminal.strip(q).length;d.html(k.terminal.format(q))})}}();k.extend(m,{name:function(d){if(d!==J){T=d;D=new fa(d)}else return T},
history:function(){return D},set:function(d,q){if(d!==J){p=d;if(!q)a=p.length;l();if(typeof c.onCommandChange==="function")c.onCommandChange(p)}},insert:function(d,q){if(a===p.length)p+=d;else p=a===0?d+p:p.slice(0,a)+d+p.slice(a);q||(a+=d.length);l();if(typeof c.onCommandChange==="function")c.onCommandChange(p)},get:function(){return p},commands:function(d){if(d)c.commands=d;else return d},destroy:function(){k(document.documentElement).unbind(".commandline");m.find(".prompt").remove()},prompt:function(d){if(d===
J)return y;else{if(typeof d==="string"||typeof d==="function")y=d;else throw"prompt must be a function or string";G();l()}},position:function(d){if(typeof d==="number"){a=d<0?0:d>p.length?p.length:d;l()}else return a},show:function(){var d=m.show;return function(){d.apply(m,[]);l();G()}}(),resize:function(d){if(d)w=d;else{d=m.width();var q=H.innerWidth();w=Math.floor(d/q)}l()},enable:function(){if(!I){H.addClass("inverted");m.everyTime(500,"blink",g);I=true}},isenabled:function(){return I},disable:function(){if(I){m.stopTime("blink",
g);H.removeClass("inverted");I=false}},mask:function(d){if(typeof d==="boolean"){F=d;l()}else return F}});m.name(c.name||"");y=c.prompt||"> ";G();if(c.enabled===J||c.enabled===true)m.enable();k(k.browser.msie?document.documentElement:window).keypress(function(d){var q;if(d.ctrlKey&&d.which===99)return true;if(!x&&c.keypress)q=c.keypress(d);if(q===J||q){if(I)if(k.inArray(d.which,[38,32,13,0,8])>-1&&d.keyCode!==123&&!(d.which===38&&d.shiftKey))return false;else if(!d.ctrlKey&&!(d.altKey&&d.which===
100)){if(x){C+=String.fromCharCode(d.which);f();h()}else m.insert(String.fromCharCode(d.which));return false}else if(d.altKey)if(x){C+=String.fromCharCode(d.which);f();h()}else m.insert(String.fromCharCode(d.which))}else return q}).keydown(s);return m};var ga=/(\[\[[gbius]*;[^;]*;[^\]]*\][^\]\[]*\])/g,Y=/\[\[([gbius]*);([^;]*);([^;]*);?([^\]]*)\]([^\]\[]*)\]/g,Z=/#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})/,ha=/(https?:((?!&[^;]+;)[^\s:"'<)])+)/g,ia=/((([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,})))/g;
k.terminal={split_equal:function(c,g){for(var f=c.split(/\n/g),h=/(\[\[[gbius]*;[^;]*;[^\]]*\][^\]\[]*\]?)/g,i=/(\[\[[gbius]*;[^;]*;[^\]]*\])/,o=/\[\[[gbius]*;?[^;]*;?[^\]]*\]?$/,s=false,m=false,v="",w=[],A=0,x=f.length;A<x;++A){if(v!=="")if(f[A]===""){w.push(v+"]");continue}else{f[A]=v+f[A];v=""}else if(f[A]===""){w.push("");continue}for(var C=f[A],E=0,O=0,F=0,p=C.length;F<p;++F){if(C[F]==="["&&C[F+1]==="[")s=true;else if(s&&C[F]==="]")if(m)m=s=false;else m=true;else if(s&&m||!s)++O;if(O===g||F===
p-1){var a=C.substring(E,F+1);if(v){a=v+a;if(a.match("]"))v=""}E=F+1;O=0;var y=a.match(h);if(y){y=y[y.length-1];if(y[y.length-1]!=="]"){v=y.match(i)[1];a+="]"}else if(a.match(o)){a=a.replace(o,"");v=y.match(i)[1]}}w.push(a)}}}return w},encode:function(c){return c.replace(/&(?!#[0-9]+;|[a-zA-Z]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/>").replace(/ /g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")},format:function(c){if(typeof c==="string"){c=k.terminal.encode(k.terminal.from_ansi(c));
var g=c.split(ga);if(g&&g.length>1)c=k.map(g,function(f){return f===""?f:f.substring(0,1)==="["?f.replace(Y,function(h,i,o,s,m,v){if(v==="")return"<span>&nbsp;</span>";h="";if(i.indexOf("b")!==-1)h+="font-weight:bold;";var w="text-decoration:";if(i.indexOf("u")!==-1)w+="underline ";if(i.indexOf("s")!==-1)w+="line-through";if(i.indexOf("s")!==-1||i.indexOf("u")!==-1)h+=w+";";if(i.indexOf("i")!==-1)h+="font-style:italic;";if(o.match(Z)){h+="color:"+o+";";if(i.indexOf("g")!==-1)h+="text-shadow: 0 0 5px "+
o+";"}if(s.match(Z))h+="background-color:"+s;return'<span style="'+h+'"'+(m!=""?' class="'+m+'"':"")+">"+v+"</span>"}):"<span>"+f+"</span>"}).join("");return c.replace(ha,'<a target="_blank" href="$1">$1</a>').replace(ia,'<a href="mailto:$1">$1</a>')}else return""},strip:function(c){return c.replace(Y,"$5")},active:function(){return P.front()},ansi_colors:{normal:{black:"#000",red:"#AA0000",green:"#008400",yellow:"#AA5500",blue:"#0000AA",magenta:"#AA00AA",cyan:"#00AAAA",white:"#fff"},bold:{white:"#fff",
red:"#FF5555",green:"#44D544",yellow:"#FFFF55",blue:"#5555FF",magenta:"#FF55FF",cyan:"#55FFFF",black:"#000"}},from_ansi:function(){function c(h){var i=h.split(";"),o;h=[];var s="",m="",v;for(v in i){o=parseInt(i[v],10);o===1&&h.push("b");o===4&&h.push("u");if(f[o])m=f[o];if(g[o])s=g[o]}o=i=k.terminal.ansi_colors.normal;for(v=h.length;v--;)if(h[v]=="b"){if(s=="")s="white";o=k.terminal.ansi_colors.bold;break}return"[["+[h.join(""),o[s],i[m]].join(";")+"]"}var g={30:"black",31:"red",32:"green",33:"yellow",
34:"blue",35:"magenta",36:"cyan",37:"white"},f={40:"black",41:"red",42:"green",43:"yellow",44:"blue",45:"magenta",46:"cyan",47:"white"};return function(h){var i=h.split(/(\[[0-9;]*m)/g);if(i.length==1)return h;h=[];if(i.length>3&&i.slice(0,3).join("")=="[0m")i=i.slice(3);for(var o=false,s=0;s<i.length;++s){var m=i[s].match(/^\[([0-9;]*)m$/);if(m){if(m[1]!="")if(o){h.push("]");if(m[1]=="0")o=false;else h.push(c(m[1]))}else{o=true;h.push(c(m[1]))}}else h.push(i[s])}o&&h.push("]");return h.join("")}}()};
k.fn.visible=function(){return this.css("visibility","visible")};k.fn.hidden=function(){return this.css("visibility","hidden")};k.jrpc=function(c,g,f,h,i,o){g=k.json_stringify({jsonrpc:"2.0",method:f,params:h,id:g});return k.ajax({url:c,data:g,success:i,error:o,contentType:"application/json",dataType:"json",async:true,cache:false,type:"POST"})};R=/ {14}$/;var ja=[["jQuery Terminal","(c) 2011-2012 jcubic"],["jQuery Terminal Emulator v. 0.4.20","Copyright (c) 2011-2012 Jakub Jankiewicz <http://jcubic.pl>".replace(/ *<.*>/,
"")],["jQuery Terminal Emulator version version 0.4.20","Copyright (c) 2011-2012 Jakub Jankiewicz <http://jcubic.pl>"],["      _______                 ________                        __","     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/","         \\/          /____/                                   ".replace(R,
"")+"version 0.4.20","Copyright (c) 2011-2012 Jakub Jankiewicz <http://jcubic.pl>"],["      __ _____                     ________                              __","     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/","          \\/              /____/                                          ".replace(R,
"")+"version 0.4.20","Copyright (c) 2011-2012 Jakub Jankiewicz <http://jcubic.pl>"]],V=[],P=new function(c){var g=c?[c]:[],f=0;k.extend(this,{rotate:function(){if(g.length===1)return g[0];else{if(f===g.length-1)f=0;else++f;return g[f]}},length:function(){return g.length},set:function(h){for(var i=g.length;i--;)if(g[i]===h){f=i;return}this.append(h)},front:function(){return g[f]},append:function(h){g.push(h)}})};k.fn.terminal=function(c,g){function f(){return a.get(0).scrollHeight>a.innerHeight()}
function h(){var b=a.find(".cursor").width(),e=Math.floor(a.width()/b);if(f()){var j=a.innerWidth()-a.width();e-=Math.ceil((20-j/2)/(b-1))}return e}function i(b,e){if(l.displayExceptions){a.error("&#91;"+e+"&#93;: "+(typeof b==="string"?b:typeof b.fileName==="string"?b.fileName+": "+b.message:b.message));if(typeof b.fileName==="string"){a.pause();k.get(b.fileName,function(j){a.resume();var u=b.lineNumber-1;(j=j.split("\n")[u])&&a.error("&#91;"+b.lineNumber+"&#93;: "+j)})}b.stack&&a.error(b.stack)}}
function o(b,e){try{if(typeof e==="function")e(function(){});else if(typeof e!=="string")throw b+" must be string or function";}catch(j){i(j,b.toUpperCase());return false}return true}function s(){var b=a.prop?a.prop("scrollHeight"):a.attr("scrollHeight");a.scrollTop(b)}function m(b){b=typeof b==="string"?b:String(b);var e,j;if(b.length>D){var u=k.terminal.split_equal(b,D);b=k("<div></div>");e=0;for(j=u.length;e<j;++e)u[e]===""||u[e]==="\r"?b.append("<div>&nbsp;</div>"):k("<div/>").html(k.terminal.format(u[e])).appendTo(b)}else b=
k("<div/>").html(k.terminal.format(b));I.append(b);b.width("100%");s();return b}function v(){if(g.greetings===J)a.echo(a.signature);else g.greetings&&a.echo(g.greetings)}function w(b,e){var j=1,u=function(r,t){e.pause();k.jrpc(b,j++,r,t,function(z){if(z.error)e.error("&#91;RPC&#93; "+z.error.message);else if(typeof z.result==="string")e.echo(z.result);else if(z.result instanceof Array)e.echo(z.result.join(" "));else if(typeof z.result==="object"){var N="",Q;for(Q in z.result)if(z.result.hasOwnProperty(Q))N+=
Q+": "+z.result[Q]+"\n";e.echo(N)}e.resume()},function(z,N){e.error("&#91;AJAX&#93; "+N+" - Server reponse is: \n"+z.responseText);e.resume()})};return function(r,t){if(r!==""){var z,N;if(r.match(/[^ ]* /)){r=r.split(/ +/);z=r[0];N=r.slice(1)}else{z=r;N=[]}if(!l.login||z==="help")u(z,N);else{var Q=t.token();Q?u(z,[Q].concat(N)):t.error("&#91;AUTH&#93; Access denied (no token)")}}}}function A(b){b=b.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;");var e=n.prompt();if(n.mask())b=b.replace(/./g,"*");typeof e===
"function"?e(function(j){a.echo(j+b)}):a.echo(e+b)}function x(b,e){try{var j=B.top();if(b==="exit"&&l.exit)if(B.size()===1)if(l.login)E();else{e||A(b);a.echo("You can exit from main interpeter")}else a.pop("exit");else{e||A(b);b==="clear"&&l.clear?a.clear():j.eval(b,a)}}catch(u){i(u,"USER");a.resume();throw u;}}function C(){var b=null;n.prompt("login: ");l.history&&n.history().disable();n.commands(function(e){try{A(e);if(b){n.mask(false);a.pause();if(typeof l.login!=="function")throw"Value of login property must be a function";
l.login(b,e,function(u){if(u){var r=l.name;r=r?"_"+r:"";k.Storage.set("token"+r,u);k.Storage.set("login"+r,b);n.commands(x);F()}else{a.error("Wrong password try again");n.prompt("login: ");b=null}a.resume();l.history&&n.history().enable()})}else{b=e;n.prompt("password: ");n.mask(true)}}catch(j){i(j,"LOGIN",a);throw j;}})}function E(){if(typeof l.onBeforelogout==="function")try{if(l.onBeforelogout(a)==false)return}catch(b){i(b,"onBeforelogout");throw b;}var e=l.name;e=e?"_"+e:"";k.Storage.remove("token"+
e,null);k.Storage.remove("login"+e,null);l.history&&n.history().disable();C();if(typeof l.onAfterlogout==="function")try{l.onAfterlogout(a)}catch(j){i(j,"onAfterlogout");throw j;}}function O(){var b=B.top(),e="";if(b.name!==J&&b.name!=="")e+=b.name+"_";e+=T;n.name(e);typeof b.prompt=="function"?n.prompt(function(j){b.prompt(j,a)}):n.prompt(b.prompt);l.history&&n.history().enable();n.set("");if(typeof b.onStart==="function")b.onStart(a)}function F(){O();v();if(typeof l.onInit==="function")try{l.onInit(a)}catch(b){i(b,
"OnInit");throw b;}}function p(b){a.oneTime(5,function(){q()});if(l.keydown&&l.keydown(b,a)===false)return false;if(a.paused()){if(b.which===68&&b.ctrlKey){for(b=V.length;b--;){var e=V[b];if(4!==e.readyState)try{e.abort()}catch(j){a.error("error in aborting ajax")}}a.resume();return false}}else{if(b.which!==9)M=0;if(b.which===68&&b.ctrlKey){if(n.get()==="")if(B.size()>1||l.login!==J)a.pop("");else{a.resume();a.echo("")}else a.set_command("");return false}else if(l.tabcompletion&&b.which===9){++M;
e=n.get();if(!e.match(" ")){var u=RegExp("^"+e),r=B.top().command_list,t=[];for(b=r.length;b--;)u.test(r[b])&&t.push(r[b]);if(t.length===1)a.set_command(t[0]);else if(t.length>1)if(M>=2){A(e);a.echo(t.join("\t"));M=0}}return false}else if(b.which===86&&b.ctrlKey){a.oneTime(1,function(){s()});return true}else if(b.which===9&&b.ctrlKey){P.length()>1&&a.focus(false);return false}else if(b.which===34){console.log(a.height());a.scroll(a.height())}else if(b.which===33){console.log(a.height());a.scroll(-a.height())}else a.attr({scrollTop:a.attr("scrollHeight")})}}
var a=this,y=[],I,T=P.length(),D,H=[],l=k.extend({name:"",prompt:"> ",history:true,exit:true,clear:true,enabled:true,displayExceptions:true,cancelableAjax:true,login:null,tabcompletion:null,historyFilter:null,onInit:k.noop,onClear:k.noop,onBlur:k.noop,onFocus:k.noop,onTerminalChange:k.noop,onExit:k.noop,keypress:k.noop,keydown:k.noop},g||{});l.width&&a.width(l.width);l.height&&a.height(l.height);var G=!l.enabled;if(a.length===0)throw'Sorry, but terminal said that "'+a.selector+'" is not valid selector!';
a.ajaxSend(function(b,e){V.push(e)});if(a.data("terminal"))return a.data("terminal");I=k("<div>").addClass("terminal-output").appendTo(a);a.addClass("terminal").append("<div/>");a.click(function(){a.find("textarea").focus()});var d=[];k.extend(a,k.omap({clear:function(){I.html("");try{l.onClear(a)}catch(b){i(b,"onClear");throw b;}n.set("");y=[];a.attr({scrollTop:0});return a},exec:function(b,e){G?d.push([b,e]):x(b,e);return a},greetings:function(){v();return a},paused:function(){return G},pause:function(){if(n){G=
true;a.disable();n.hidden()}return a},resume:function(){if(n){a.enable();var b=d;for(d=[];b.length;){var e=b.shift();a.exec.apply(a,e)}n.visible();s()}return a},cols:function(){return D},rows:function(){return y.length},history:function(){return n.history()},next:function(){if(P.length()===1)return a;else{var b=a.offset().top;a.height();a.scrollTop();var e=a,j=k(window).scrollTop(),u=j+k(window).height(),r=k(e).offset().top;if(r+k(e).height()>=j&&r<=u){P.front().disable();b=P.rotate().enable();e=
b.offset().top-50;k("html,body").animate({scrollTop:e},500);try{l.onTerminalChange(b)}catch(t){i(t,"onTerminalChange");throw t;}return b}else{a.enable();k("html,body").animate({scrollTop:b-50},500);return a}}},focus:function(b){a.oneTime(1,function(){if(P.length()===1)if(b===false)try{l.onBlur(a)!==false&&a.disable()}catch(e){i(e,"onBlur");throw e;}else try{l.onFocus(a)!==false&&a.enable()}catch(j){i(j,"onFocus");throw j;}else if(b===false)a.next();else{var u=P.front();if(u!=a){u.disable();try{l.onTerminalChange(a)}catch(r){i(r,
"onTerminalChange");throw r;}}P.set(a);a.enable()}});return a},enable:function(){D===J&&a.resize();if(G)if(n){n.enable();G=false}return a},disable:function(){if(n){G=true;n.disable()}return a},enabled:function(){return G},signature:function(){var b=a.cols();b=b<15?null:b<35?0:b<55?1:b<64?2:b<75?3:4;return b!==null?ja[b].join("\n")+"\n":""},version:function(){return"0.4.20"},get_command:function(){return n.get()},insert:function(b){if(typeof b==="string"){n.insert(b);return a}else throw"insert function argument is not a string";
},set_prompt:function(b){if(o("prompt",b)){typeof b=="function"?n.prompt(function(e){b(e,a)}):n.prompt(b);B.top().prompt=b}return a},get_prompt:function(){return B.top().prompt},set_command:function(b){n.set(b);return a},set_mask:function(b){n.mask(b);return a},get_output:function(b){return b?y:k.map(y,function(e,j){return typeof j=="function"?j():j}).join("\n")},resize:function(b,e){if(b&&e){a.width(b);a.height(e)}D=h();n.resize(D);var j=I.detach();I.html("");k.each(y,function(u,r){m(r&&typeof r==
"function"?r():r)});a.prepend(j);s();return a},echo:function(b){y.push(b);m(typeof b==="function"?b():b);q();return a},error:function(b){return a.echo("[[;#f00;]"+b.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")+"]")},scroll:function(b){var e;b=Math.round(b);if(a.prop){b>a.prop("scrollTop")&&b>0&&a.prop("scrollTop",0);e=a.prop("scrollTop");a.prop("scrollTop",e+b)}else{b>a.attr("scrollTop")&&b>0&&a.attr("scrollTop",0);e=a.attr("scrollTop");a.attr("scrollTop",e+b)}return a},logout:l.login?function(){for(;B.size()>
1;)B.pop();E();return a}:function(){throw"You don't have login function";},token:l.login?function(){var b=l.name;return k.Storage.get("token"+(b?"_"+b:""))}:k.noop,login_name:l.login?function(){var b=l.name;return k.Storage.get("login"+(b?"_"+b:""))}:k.noop,name:function(){return l.name},push:function(b,e){if(e&&(!e.prompt||o("prompt",e.prompt))||!e){if(typeof b==="string")b=w(e.eval,a);B.push(k.extend({eval:b},e));O()}return a},reset:function(){for(a.clear();B.size()>1;)B.pop();F()},pop:function(b){b!==
J&&A(b);if(B.top().name===l.name){if(l.login){E();if(typeof l.onExit==="function")try{l.onExit(a)}catch(e){i(e,"onExit");throw e;}}}else{b=B.pop();O();if(typeof b.onExit==="function")try{l.onExit(a)}catch(j){i(j,"onExit");throw j;}}return a}},function(b,e){return function(){try{return e.apply(this,Array.prototype.slice.apply(arguments))}catch(j){i(j,"TERMINAL")}}}));var q=function(){var b=f();return function(){if(b!==f()){a.resize();b=f()}}}(),M=0,K;if(l.login&&typeof l.onBeforeLogin==="function")try{l.onBeforeLogin(a)}catch(S){i(S,
"onBeforeLogin");throw S;}if(typeof c=="string"){K=c;c=w(c,a)}else if(typeof c=="object"&&c.constructor===Array)throw"You can't use array as eval";else if(typeof c==="object"){for(var L in c)c.hasOwnProperty(L)&&H.push(L);c=function b(e){return function(j){if(j!==""){j=j.split(/ +/);var u=j[0],r=j.slice(1);j=e[u];var t=typeof j;if(t==="function")j.apply(a,r);else if(t==="object"||t==="string"){r=[];if(t==="object"){for(var z in j)j.hasOwnProperty(z)&&r.push(z);j=b(j)}a.push(j,{prompt:u+"> ",name:u,
command_list:r})}else a.error("Command '"+u+"' Not Found")}}}(c)}else if(typeof c!=="function")throw'Unknow object "'+String(c)+'" passed as eval';if(K&&(typeof l.login==="string"||l.login))l.login=function(b){var e=1;return function(j,u,r){a.pause();k.jrpc(K,e++,b,[j,u],function(t){a.resume();!t.error&&t.result?r(t.result):r(null)},function(t,z){a.resume();a.error("&#91;AJAX&#92; Response: "+z+"\n"+t.responseText)})}}(typeof l.login==="boolean"?"login":l.login);if(o("prompt",l.prompt)){var B=new ea({name:l.name,
eval:c,prompt:l.prompt,command_list:H,greetings:l.greetings}),n=a.find(".terminal-output").next().cmd({prompt:l.prompt,history:l.history,historyFilter:l.historyFilter,width:"100%",keydown:p,keypress:l.keypress?function(b){return l.keypress(b,a)}:null,onCommandChange:function(b){if(typeof l.onCommandChange==="function")try{l.onCommandChange(b,a)}catch(e){i(e,"onCommandChange");throw e;}s()},commands:x});P.append(a);l.enabled===true?a.focus():a.disable();k(window).resize(a.resize);a.click(function(){G&&
a===k.terminal.active()||a.focus()});g.login&&a.token&&!a.token()&&a.login_name&&!a.login_name()?C():F();typeof k.fn.init.prototype.mousewheel==="function"&&a.mousewheel(function(b,e){e>0?a.scroll(-40):a.scroll(40);return false},true)}a.data("terminal",a);return a}})(jQuery);
