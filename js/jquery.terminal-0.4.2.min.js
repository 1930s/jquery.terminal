/*

 |       __ _____                     ________                              __
 |      / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /
 |  __ / // // // // // _  // _// // / / // _  // _//     // //  \/ // _ \/ /
 | /  / // // // // // ___// / / // / / // ___// / / / / // // /\  // // / /__
 | \___//____ \\___//____//_/ _\_  / /_//____//_/ /_/ /_//_//_/ /_/ \__\_\___/
 |           \/              /____/                              version 0.4.2
 http://terminal.jcubic.pl

 Licensed under GNU LGPL Version 3 license
 Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>

 Includes:

 Storage plugin Distributed under the MIT License
 Copyright (c) 2010 Dave Schindler

 LiveQuery plugin Dual MIT and GPL
 Copyright (c) 2008 Brandon Aaron (http://brandonaaron.net)

 jQuery Timers licenced with the WTFPL
 <http://jquery.offput.ca/every/>

 Date: Fri, 14 Oct 2011 16:00:01 +0000
*/
Array.prototype.has=function(g){for(var C=this.length;C--;)if(this[C]==g)return true;return false};function get_stack(g){return g?[g.toString().match(/.*\n.*\n/)].concat(get_stack(g.caller)):[]}
(function(g,C){function $(a,c){var f;if(typeof a==="string"&&typeof c==="string"){localStorage[a]=c;return true}else if(typeof a==="object"&&typeof c==="undefined"){for(f in a)if(a.hasOwnProperty(f))localStorage[f]=a[f];return true}return false}function X(a,c){var f,e;f=new Date;f.setTime(f.getTime()+31536E6);f="; expires="+f.toGMTString();if(typeof a==="string"&&typeof c==="string"){document.cookie=a+"="+c+f+"; path=/";return true}else if(typeof a==="object"&&typeof c==="undefined"){for(e in a)if(a.hasOwnProperty(e))document.cookie=
e+"="+a[e]+f+"; path=/";return true}return false}function aa(a){return localStorage[a]}function ba(a){var c,f,e;a+="=";c=document.cookie.split(";");for(f=0;f<c.length;f++){for(e=c[f];e.charAt(0)===" ";)e=e.substring(1,e.length);if(e.indexOf(a)===0)return e.substring(a.length,e.length)}return null}function ca(a){return delete localStorage[a]}function da(a){return X(a,"",-1)}function W(a,c){var f=[],e=a.length;if(e<c)return[a];for(var j=0;j<e;j+=c)f.push(a.substring(j,j+c));return f}function E(a){if(typeof a==
"string"){a=a.replace(/&(?!#[0-9]*;)/g,"&amp;");a=a.replace(/</g,"&lt;").replace(/>/g,"&gt;");a=a.replace(/\n/g,"<br/>");a=a.replace(/ /g,"&nbsp;");a=a.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");var c=a.split(ea);if(c.length>1)a=g.map(c,function(f){return f===""?f:f[0]=="["?f.replace(fa,function(e,j,s,B,H){if(H==="")return"<span>&nbsp;</span>";e="";if(j.indexOf("b")!=-1)e+="font-weight:bold;";if(j.indexOf("u")!=-1)e+="text-decoration:underline;";if(j.indexOf("i")!=-1)e+="font-style:italic; ";if(s.match(Y))e+=
"color:"+s+";";if(B.match(Y))e+="background-color:"+B;return a='<span style="'+e+'">'+H+"</span>"}):"<span>"+f+"</span>"}).join("");return a}else return""}function Z(a){var c=a instanceof Array?a:a?[a]:[],f=0;g.extend(this,{left:function(){if(f===0)f=c.length-1;else--f;return c[f]},right:function(){if(f==c.length-1)f=0;else++f;return c[f]},current:function(){return c[f]},data:function(){return c},length:function(){return c.length},reset:function(){f=0},append:function(e){c.push(e);this.reset()}})}
function ga(a){var c=a?[a]:[];g.extend(this,{size:function(){return c.length},pop:function(){if(c.length===0)return null;else{var f=c[c.length-1];c=c.slice(0,c.length-1);return f}},push:function(f){c=c.concat([f]);return f},top:function(){return c.length>0?c[c.length-1]:null}})}function ha(a){var c=true;if(typeof a==="string"&&a!=="")a+="_";var f=g.Storage.get(a+"commands"),e=new Z(f?eval("("+f+")"):[""]);g.extend(this,{append:function(j){if(c&&e.current()!=j){e.append(j);g.Storage.set(a+"commands",
g.json_stringify(e.data()))}},data:function(){return e.data()},next:function(){return e.right()},last:function(){e.reset()},previous:function(){return e.left()},clear:function(){e=new Z;g.Storage.remove(a+"commands")},enable:function(){c=true},disable:function(){c=false}})}g.extend(g.fn,{livequery:function(a,c,f){var e=this,j;if(g.isFunction(a)){f=c;c=a;a=C}g.each(g.livequery.queries,function(s,B){if(e.selector==B.selector&&e.context==B.context&&a==B.type&&(!c||c.$lqguid==B.fn.$lqguid)&&(!f||f.$lqguid==
B.fn2.$lqguid))return(j=B)&&false});j=j||new g.livequery(this.selector,this.context,a,c,f);j.stopped=false;j.run();return this},expire:function(a,c,f){var e=this;if(g.isFunction(a)){f=c;c=a;a=C}g.each(g.livequery.queries,function(j,s){if(e.selector==s.selector&&e.context==s.context&&(!a||a==s.type)&&(!c||c.$lqguid==s.fn.$lqguid)&&(!f||f.$lqguid==s.fn2.$lqguid)&&!this.stopped)g.livequery.stop(s.id)});return this}});g.livequery=function(a,c,f,e,j){this.selector=a;this.context=c||document;this.type=
f;this.fn=e;this.fn2=j;this.elements=[];this.stopped=false;this.id=g.livequery.queries.push(this)-1;e.$lqguid=e.$lqguid||g.livequery.guid++;if(j)j.$lqguid=j.$lqguid||g.livequery.guid++;return this};g.livequery.prototype={stop:function(){var a=this;if(this.type)this.elements.unbind(this.type,this.fn);else this.fn2&&this.elements.each(function(c,f){a.fn2.apply(f)});this.elements=[];this.stopped=true},run:function(){if(!this.stopped){var a=this,c=this.elements,f=g(this.selector,this.context),e=f.not(c);
this.elements=f;if(this.type){e.bind(this.type,this.fn);c.length>0&&g.each(c,function(j,s){g.inArray(s,f)<0&&g.event.remove(s,a.type,a.fn)})}else{e.each(function(){a.fn.apply(this)});this.fn2&&c.length>0&&g.each(c,function(j,s){g.inArray(s,f)<0&&a.fn2.apply(s)})}}}};g.extend(g.livequery,{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if(g.livequery.running&&g.livequery.queue.length)for(var a=g.livequery.queue.length;a--;)g.livequery.queries[g.livequery.queue.shift()].run()},
pause:function(){g.livequery.running=false},play:function(){g.livequery.running=true;g.livequery.run()},registerPlugin:function(){g.each(arguments,function(a,c){if(g.fn[c]){var f=g.fn[c];g.fn[c]=function(){var e=f.apply(this,arguments);g.livequery.run();return e}}})},run:function(a){if(a!=C)g.inArray(a,g.livequery.queue)<0&&g.livequery.queue.push(a);else g.each(g.livequery.queries,function(c){g.inArray(c,g.livequery.queue)<0&&g.livequery.queue.push(c)});g.livequery.timeout&&clearTimeout(g.livequery.timeout);
g.livequery.timeout=setTimeout(g.livequery.checkQueue,20)},stop:function(a){a!=C?g.livequery.queries[a].stop():g.each(g.livequery.queries,function(c){g.livequery.queries[c].stop()})}});g.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove");g(function(){g.livequery.play()});var ia=g.prototype.init;g.prototype.init=function(a,c){var f=ia.apply(this,arguments);if(a&&a.selector){f.context=a.context;f.selector=
a.selector}if(typeof a=="string"){f.context=c||document;f.selector=a}return f};g.prototype.init.prototype=g.prototype;var Q=typeof window.localStorage!=="undefined";g.extend({Storage:{set:Q?$:X,get:Q?aa:ba,remove:Q?ca:da}});jQuery.fn.extend({everyTime:function(a,c,f,e,j){return this.each(function(){jQuery.timer.add(this,a,c,f,e,j)})},oneTime:function(a,c,f){return this.each(function(){jQuery.timer.add(this,a,c,f,1)})},stopTime:function(a,c){return this.each(function(){jQuery.timer.remove(this,a,c)})}});
jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1E3,das:1E4,hs:1E5,ks:1E6},timeParse:function(a){if(a==C||a===null)return null;var c=this.regex.exec(jQuery.trim(a.toString()));return c[2]?parseInt(c[1],10)*(this.powers[c[2]]||1):a},add:function(a,c,f,e,j,s){var B=0;if(jQuery.isFunction(f)){j||(j=e);e=f;f=c}c=jQuery.timer.timeParse(c);if(!(typeof c!="number"||isNaN(c)||c<=0)){if(j&&j.constructor!=Number){s=!!j;j=0}j=j||0;s=s||false;if(!a.$timers)a.$timers=
{};a.$timers[f]||(a.$timers[f]={});e.$timerID=e.$timerID||this.guid++;var H=function(){if(!(s&&this.inProgress)){this.inProgress=true;if(++B>j&&j!==0||e.call(a,B)===false)jQuery.timer.remove(a,f,e);this.inProgress=false}};H.$timerID=e.$timerID;a.$timers[f][e.$timerID]||(a.$timers[f][e.$timerID]=window.setInterval(H,c));this.global[f]||(this.global[f]=[]);this.global[f].push(a)}},remove:function(a,c,f){var e=a.$timers,j;if(e){if(c){if(e[c]){if(f){if(f.$timerID){window.clearInterval(e[c][f.$timerID]);
delete e[c][f.$timerID]}}else for(f in e[c]){window.clearInterval(e[c][f]);delete e[c][f]}for(j in e[c])break;if(!j){j=null;delete e[c]}}}else for(c in e)this.remove(a,c,f);for(j in e)break;if(!j)a.$timers=null}}}});if(jQuery.browser.msie)jQuery(window).one("unload",function(){var a=jQuery.timer.global,c;for(c in a)for(var f=a[c],e=f.length;--e;)jQuery.timer.remove(f[e],c)});var ea=/(\[\[[biu]*;[^;]*;[^\]]*\][^\]\[]*\])/g,fa=/\[\[([biu]*);([^;]*);([^\]]*)\]([^\]\[]*)\]/g,Y=/#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})/;
g.json_stringify=function(a,c){var f="",e;c=c===C?1:c;switch(typeof a){case "function":f+=a;break;case "boolean":f+=a?"true":"false";break;case "object":if(a===null)f+="null";else if(a instanceof Array){f+="[";var j=a.length;for(e=0;e<j-1;++e)f+=g.json_stringify(a[e],c+1);f+=g.json_stringify(a[j-1],c+1)+"]"}else{f+="{";for(j in a)if(a.hasOwnProperty(j))f+='"'+j+'":'+g.json_stringify(a[j],c+1);f+="}"}break;case "string":j=a;var s={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};
for(e in s)if(s.hasOwnProperty(e))j=j.replace(RegExp(e,"g"),s[e]);f+='"'+j+'"';break;case "number":f+=String(a)}f+=c>1?",":"";if(c==1)f=f.replace(/,([\]}])/g,"$1");return f.replace(/([\[{]),/g,"$1")};g.fn.cmd=function(a){function c(){M.toggleClass("inverted")}function f(){j.focus();e.oneTime(1,function(){e.insert(j.val());j.blur();j.val("")})}var e=this;e.addClass("cmd");e.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');var j=g("<textarea/>").addClass("clipboard").appendTo(e);
a.width&&e.width(a.width);var s,B,H=a.mask||false,q="",o=0,N,O=a.enabled,R,F,M=e.find(".cursor"),J=function(h){function t(v,w){if(w==v.length){k.html(E(v));M.html("&nbsp;");G.html("")}else if(w===0){k.html("");M.html(E(v.slice(0,1)));G.html(E(v.slice(1)))}else{var r=E(v.slice(0,w));k.html(r);r=v.slice(w,w+1);M.html(r==" "?"&nbsp;":E(r));w==v.lenght-1?G.html(""):G.html(E(v.slice(w+1)))}}function S(v){return"<div>"+E(v)+"</div>"}function I(v){var w=G;g.each(v,function(r,z){w=g(S(z)).insertAfter(w).addClass("clear")})}
function T(v){g.each(v,function(w,r){k.before(S(r))})}var k=M.prev(),G=M.next();return function(){var v=H?q.replace(/./g,"*"):q,w;h.find("div").remove();k.html("");if(v.length>s-B-1||v.match(/\n/)){var r;if(v.match(/\n/)){var z=v.split("\n"),m=s-B-1;for(w=0;w<z.length-1;++w)z[w]+=" ";if(z[0].length>m){r=[z[0].substring(0,m)];r=r.concat(W(z[0].substring(m),s))}else r=[z[0]];for(w=1;w<z.length;++w)if(z[w].length>s)r=r.concat(W(z[w],s));else r.push(z[w])}else{r=v.substring(0,s-B-1);m=v.substring(s-B-
1);r=[r].concat(W(m,s))}m=r[0].length;if(o<m){t(r[0],o);I(r.slice(1))}else if(o==m){k.before(S(r[0]));t(r[1],0);I(r.slice(2))}else{w=r.length;if(o<m){t(r[0],o);I(r.slice(1))}else if(o==m){k.before(S(r[0]));t(r[1],0);I(r.slice(2))}else{z=r.slice(-1)[0];var b=v.length-o;v=0;if(b<=z.length){T(r.slice(0,-1));v=z.length==b?0:z.length-b;t(z,v)}else if(w==3){k.before("<div>"+E(r[0])+"</div>");t(r[1],o-m-1);G.after('<div class="clear">'+E(r[2])+"</div>")}else{v=o;for(w=0;w<r.length;++w)if(v>r[w].length)v-=
r[w].length;else break;m=r[w];if(v==m.length){v=0;m=r[++w]}t(m,v);T(r.slice(0,w));I(r.slice(w+1))}}}}else if(v===""){k.html("");M.html("&nbsp;");G.html("")}else t(v,o)}}(e),d=function(){var h=e.find(".prompt");return function(){if(typeof N=="string"){B=N.length;h.html(E(N)+"&nbsp;")}else N(function(t){B=t.length;h.html(E(t)+"&nbsp;")})}}();g.extend(e,{name:function(h){if(h!==C){R=h;F=new ha(h)}else return R},history:function(){return F},set:function(h,t){if(h!==C){q=h;if(!t)o=q.length;J()}},insert:function(h,
t){if(o==q.length)q+=h;else q=o===0?h+q:q.slice(0,o)+h+q.slice(o);t||(o+=h.length);J()},get:function(){return q},commands:function(h){if(h)a.commands=h;else return h},destroy:function(){g(document.documentElement).unbind(".commandline");e.find(".prompt").remove()},prompt:function(h){if(h===C)return N;else{if(typeof h=="string"||typeof h=="function")N=h;else throw"prompt must be a function or string";d()}},position:function(h){if(typeof h=="number"){o=h<0?0:h>q.length?q.length:h;J()}else return o},
resize:function(h){if(h)s=h;else{h=e.width();var t=M.innerWidth();s=Math.floor(h/t)}J()},enable:function(){if(!O){e.everyTime(500,"blink",c);O=true}},isenabled:function(){return O},disable:function(){if(O){e.stopTime("blink",c);e.find(".cursor").removeClass("inverted");O=false}},mask:function(h){if(typeof h=="boolean"){H=h;J()}else return H}});e.name(a.name||"");N=a.prompt||">";d();if(a.enabled===C||a.enabled===true)e.enable();g(document.documentElement).keypress(function(h){var t;if(h.ctrlKey&&h.which==
99)return true;if(a.keypress)t=a.keypress(h);if(t===C||t){if(O)if([38,32,13,0,8].has(h.which)&&h.keyCode!=123&&!(h.which==38&&h.shiftKey))return false;else if(!h.ctrlKey&&!(h.altKey&&h.which==100)){e.insert(String.fromCharCode(h.which));return false}}else return t}).keydown(function(h){if(O){if(a.keydown&&a.keydown(h)===false)return false;var t;if(h.keyCode==13){F&&q&&F.append(q);F.last();h=q;e.set("");typeof N=="function"&&d();a.commands&&a.commands(h)}else if(h.which==32)e.insert(" ");else if(h.which==
8){if(q!==""&&o>0){q=q.slice(0,o-1)+q.slice(o,q.length);--o;J()}}else if(h.which==9&&!(h.ctrlKey||h.altKey))e.insert("\t");else if(h.which==46){if(q!==""&&o<q.length){q=q.slice(0,o)+q.slice(o+1,q.length);J()}return true}else if(F&&h.which==38||h.which==80&&h.ctrlKey)e.set(F.previous());else if(F&&h.which==40||h.which==78&&h.ctrlKey)e.set(F.next());else if(h.which==37||h.which==66&&h.ctrlKey)if(h.ctrlKey&&h.which!=66){t=o-1;h=0;for(q[t]==" "&&--t;t>0;--t)if(q[t]==" "&&q[t+1]!=" "){h=t+1;break}else if(q[t]==
"\n"&&q[t+1]!="\n"){h=t;break}e.position(h)}else{if(o>0){--o;J()}}else if(h.which==39||h.which==70&&h.ctrlKey)if(h.ctrlKey&&h.which!=70){q[o]==" "&&++o;h=q.slice(o).match(/\S[\n\s]{2,}|[\n\s]+\S?/);if(!h||h[0].match(/^\s+$/))o=q.length;else if(h[0][0]!=" ")o+=h.index+1;else{o+=h.index+h[0].length-1;h[0][h[0].length-1]!=" "&&--o}J()}else{if(o<q.length){++o;J()}}else if(h.which==123)return true;else if(h.which==36)e.position(0);else if(h.which==35)e.position(q.length);else if(h.ctrlKey||h.metaKey)if(h.shiftKey){if(h.which==
84)return true}else if(h.which==65)e.position(0);else if(h.which==69)e.position(q.length);else if(h.which==88||h.which==67||h.which==87||h.which==84)return true;else if(h.which==86){f();return true}else if(h.which==75)if(o===0)e.set("");else o!=q.length&&e.set(q.slice(0,o));else if(h.which==85)e.set("");else{if(h.which==17)return true}else if(h.altKey)h.which==68&&e.set(q.slice(0,o)+q.slice(o).replace(/[^ ]+ |[^ ]+$/,""),true);else return true;return false}});return e};g.jrpc=function(a,c,f,e,j,s){c=
g.json_stringify({jsonrpc:"2.0",method:f,params:e,id:c});return g.ajax({url:a,data:c,success:j,error:s,contentType:"application/json",dataType:"json",async:true,cache:false,type:"POST"})};Q=/ {13}$/;var ja=[["jQuery Terminal","(c) 2011 jcubic"],["JQuery Terminal Emulator v. 0.4.2","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>".replace(/ *<.*>/,"")],["JQuery Terminal Emulator version version 0.4.2","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],["      _______                 ________                        __",
"     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/","         \\/          /____/                                   ".replace(Q,"")+"version 0.4.2","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],["      __ _____                     ________                              __",
"     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/","          \\/              /____/                                          ".replace(Q,"")+"version 0.4.2","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"]],ka=[],P=new function(a){var c=
a?[a]:[],f=0;g.extend(this,{rotate:function(){if(c.length==1)return c[0];else{if(f==c.length-1)f=0;else++f;return c[f]}},length:function(){return c.length},set:function(e){for(var j=c.length;j--;)if(c[j]===e){f=j;return}this.append(e)},front:function(){return c[f]},append:function(e){c.push(e)}})};g.fn.terminal=function(a,c){function f(){var b=g("<span>x</span>").appendTo(d),i=Math.floor(d.width()/b.width());b.remove();return i}function e(b,i){d.error("&#91;"+i+"&#93;: "+(typeof b=="string"?b:b.fileName+
": "+b.message));d.pause();typeof b.fileName=="string"&&g.get(b.fileName,function(l){d.resume();var u=b.lineNumber-1;(l=l.split("\n")[u])&&d.error("&#91;"+b.lineNumber+"&#93;: "+l)})}function j(b,i){try{if(typeof i=="function")i(function(){});else if(typeof i!="string")throw b+" must be string or function";}catch(l){e(l,b.toUpperCase());return false}return true}function s(){var b=d.prop?d.prop("scrollHeight"):d.attr("scrollHeight");d.scrollTop(b)}function B(b,i){var l=[],u=b.length;if(u<i)return[b];
for(var n="",y=0;y<u;y+=i){var p=/(\[\[[biu]*;[^;]*;\])/,x=b.substring(y,y+i);if(n!=="")x=n+x;var A=x.match(/(\[\[[biu]*;[^;]*;\][^\]\[]*\]?)/g);if(A&&A.length>0){var D=0;x=0;for(var U=A.length;x<U;++x){D+=A[x].match(p)[1].length;if(A[x][A[x].length-1]=="]")D+=1}A=A[A.length-1];if(n!=="")D-=n.length;x=n+b.substring(y,y+i+D);y+=D;if(A[A.length-1]!="]"){x+="]";n=A.match(p)[1]}else n=""}else n="";l.push(x)}return l}function B(b,i){for(var l=[],u=/(\[\[[biu]*;[^;]*;\][^\]\[]*\]?)/g,n=/(\[\[[biu]*;[^;]*;\])/,
y=b.split(/\n/g),p="",x=0,A=y.length;x<A;++x){if(p!=="")if(y[x]===""){l.push(p+"]");continue}else{y[x]=p+y[x];p=""}for(var D=0,U=y[x].length;D<U;D+=i){var K=y[x].substring(D,D+i);if(p!=="")K=p+K;var L=K.match(u);if(L&&L.length>0){var V=0;K=0;for(var la=L.length;K<la;++K){V+=L[K].match(n)[1].length;if(L[K][L[K].length-1]=="]")V+=1}L=L[L.length-1];if(p!=="")V-=p.length;K=p+y[x].substring(D,D+i+V);D+=V;if(L[L.length-1]!="]"){K+="]";p=L.match(n)[1]}else p=""}else p="";l.push(K)}}return l}function H(b){b=
typeof b=="string"?b:String(b);var i,l;if(b.length>I){var u=B(b,I);b=g("<div></div>");i=0;for(l=u.length;i<l;++i)u[i]===""||u[i]=="\r"?b.append("<div>&nbsp;</div>"):g("<div/>").html(E(u[i])).appendTo(b)}else b=g("<div/>").html(E(b));t.append(b);b.width("100%");s();return b}function q(b,i){var l=1,u=function(n,y){i.pause();g.jrpc(b,l++,n,y,function(p){if(p.error)i.error("&#91;RPC&#93; "+p.error.message);else if(typeof p.result=="string")i.echo(p.result);else if(p.result instanceof Array)i.echo(p.result.join(" "));
else if(typeof p.result=="object"){var x="",A;for(A in p.result)if(p.result.hasOwnProperty(A))x+=A+": "+p.result[A]+"\n";i.echo(x)}i.resume()},function(p,x){i.error("&#91;AJAX&#93; "+x+" - Server reponse is: \n"+p.responseText);i.resume()})};return function(n,y){if(n!==""){var p,x;if(n.match(/[^ ]* /)){n=n.split(/ +/);p=n[0];x=n.slice(1)}else{p=n;x=[]}if(!k.login||p=="help")u(p,x);else{var A=y.token();A?u(p,[A].concat(x)):y.error("&#91;AUTH&#93; Access denied (no token)")}}}}function o(b){var i=m.prompt();
if(m.mask())b=b.replace(/./g,"*");typeof i=="function"?i(function(l){d.echo(l+" "+b)}):d.echo(i+" "+b)}function N(b){try{var i=z.top();if(b=="exit"&&k.exit)if(z.size()==1)k.login?R():d.echo("You can exit from main interpeter");else d.pop("exit");else{o(b);if(b=="clear"&&k.clear)d.clear();else if(b.match(/\|/)){var l=b.split(/\s*\|\s*/),u=[],n=d.echo;d.echo=function(U){u.push(U)};i.eval(l[0],d);b=1;for(var y=l.length;b<y-1;++b)for(var p=0,x=u.length;p<x;++p){var A=l[b]+" "+u[p];i.eval(A,d)}d.echo=
n;p=0;for(x=u.length;p<x;++p){A=l[y-1]+" "+u[p];i.eval(A,d)}}else i.eval(b,d)}}catch(D){e(D,"USER");d.resume();throw D;}}function O(){var b=null;m.prompt("login:");k.history&&m.history().disable();m.commands(function(i){try{o(i);if(b){m.mask(false);d.pause();if(typeof k.login!="function")throw"Value of login property must be a function";k.login(b,i,function(u){if(u){var n=k.name;n=n?"_"+n:"";g.Storage.set("token"+n,u);g.Storage.set("login"+n,b);m.commands(N);M()}else{d.error("Wrong password try again");
m.prompt("login:");b=null}d.resume();k.history&&m.history().enable()})}else{b=i;m.prompt("password:");m.mask(true)}}catch(l){e(l,"LOGIN",d);throw l;}})}function R(){var b=k.name;b=b?"_"+b:"";g.Storage.remove("token"+b,null);g.Storage.remove("login"+b,null);k.history&&m.history().disable();O()}function F(){var b=z.top(),i="";if(b.name!==C&&b.name!=="")i+=b.name+"_";i+=S;m.name(i);m.prompt(b.prompt);k.history&&m.history().enable();m.set("");if(typeof b.onStart=="function")b.onStart(d)}function M(){F();
if(c.greetings===C)d.echo(d.signature);else c.greetings&&d.echo(c.greetings);if(typeof k.onInit=="function")k.onInit(d)}function J(b){if(!d.paused()){if(k.keydown&&k.keydown(b,d)===false)return false;if(b.which!=9)v=0;if(b.which==68&&b.ctrlKey){if(k.exit)if(m.get()==="")if(z.size()>1||k.login!==C)d.pop("");else{d.resume();d.echo("")}else d.set_command("");b.preventDefault()}else if(k.tabcompletion&&b.which==9){++v;b=m.get();if(!b.match(" ")){for(var i=RegExp("^"+b),l=z.top().command_list,u=[],n=l.length;n--;)i.test(l[n])&&
u.push(l[n]);if(u.length==1)d.set_command(u[0]);else if(u.length>1)if(v>=2){o(b);d.echo(u.join("\t"));v=0}}return false}else if(b.which==86&&b.ctrlKey){d.oneTime(1,function(){s()});return true}else if(b.which==9&&b.ctrlKey){P.length()>1&&d.focus(false);b.preventDefault()}else if(b.which==34)d.scroll(d.height());else b.which==33?d.scroll(-d.height()):d.attr({scrollTop:d.attr("scrollHeight")})}}var d=this,h=[],t,S=P.length(),I,T=[],k={name:"",prompt:">",history:true,exit:true,clear:true,enabled:true,
login:null,tabcompletion:false,onInit:null,onExit:null,keypress:null,keydown:null};if(c){c.width&&d.width(c.width);c.height&&d.height(c.height);g.extend(k,c)}var G=!k.enabled;if(d.length===0)throw'Sorry, but terminal said that "'+d.selector+'" is not valid selector!';d.ajaxSend(function(b,i){ka.push(i)});if(d.data("terminal"))return d.data("terminal");t=g("<div>").addClass("terminal-output").appendTo(d);d.addClass("terminal").append("<div/>");g.extend(d,{clear:function(){t.html("");m.set("");h=[];
d.attr({scrollTop:0});return d},paused:function(){return G},pause:function(){if(m){d.disable();m.hide()}return d},resume:function(){if(m){d.enable();m.show();s()}return d},cols:function(){return I},rows:function(){return h.length},history:function(){return m.history().data()},next:function(){if(P.length()==1)return d;else{var b=d.offset().top;d.height();d.scrollTop();var i=d,l=g(window).scrollTop(),u=l+g(window).height(),n=g(i).offset().top;if(n+g(i).height()>=l&&n<=u){P.front().disable();b=P.rotate().enable();
i=b.offset().top-50;g("html,body").animate({scrollTop:i},500);return b}else{d.enable();g("html,body").animate({scrollTop:b-50},500);return d}}},focus:function(b){d.oneTime(1,function(){if(P.length()==1)b===false?d.disable():d.enable();else if(b===false)d.next();else{P.front().disable();P.set(d);d.enable()}});return d},enable:function(){I===C&&d.resize();if(G)if(m){m.enable();G=false}return d},disable:function(){if(m){G=true;m.disable()}return d},enabled:function(){return G},signature:function(){var b=
d.cols();b=b<15?null:b<35?0:b<55?1:b<64?2:b<75?3:4;return b!==null?ja[b].join("\n")+"\n":""},version:function(){return"0.4.2"},get_command:function(){return m.get()},insert:function(b){m.insert(b);return d},set_prompt:function(b){j("prompt",b)&&m.prompt(b);return d},set_command:function(b){m.set(b);return d},set_mask:function(b){m.mask(b);return d},get_output:function(){return g.map(h,function(b,i){return typeof i=="function"?i():i}).get().join("\n")},resize:function(b,i){if(b&&i){d.width(b);d.height(i)}I=
f();m.resize(I);var l=t.detach();t.html("");g.each(h,function(u,n){H(typeof n=="function"?n():n)});d.prepend(l);s();return d},echo:function(b){h.push(b);return H(typeof b=="function"?b():b)},error:function(b){d.echo("[[;#f00;]"+b.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")+"]")},scroll:function(b){var i;if(d.prop){b>d.prop("scrollTop")&&b>0&&d.prop("scrollTop",0);i=d.prop("scrollTop");d.prop("scrollTop",i+b)}else{b>d.attr("scrollTop")&&b>0&&d.attr("scrollTop",0);i=d.attr("scrollTop");d.attr("scrollTop",
i+b)}return d},logout:k.login?function(){for(;z.size()>1;)z.pop();R();return d}:function(){throw"You don't have login function";},token:k.login?function(){var b=k.name;return g.Storage.get("token"+(b?"_"+b:""))}:null,login_name:k.login?function(){var b=k.name;return g.Storage.get("login"+(b?"_"+b:""))}:null,name:function(){return k.name},push:function(b,i){if(!i.prompt||j("prompt",i.prompt)){if(typeof b=="string")b=q(i.eval,d);z.push(g.extend({eval:b},i));F()}return d},pop:function(b){b!==C&&o(b);
if(z.top().name===k.name){if(k.login){R();if(typeof k.onExit=="function")k.onExit(d)}}else{b=z.pop();F();if(typeof b.onExit=="function")b.onExit(d)}return d}});var v=0,w;switch(typeof a){case "string":w=a;a=q(a,d);break;case "object":for(var r in a)T.push(r);a=function b(i){return function(l){if(l!==""){l=l.split(/ +/);var u=l[0],n=l.slice(1);l=i[u];var y=typeof l;if(y=="function")l.apply(d,n);else if(y=="object"||y=="string"){n=[];if(y=="object"){for(var p in l)n.push(p);l=b(l)}d.push(l,{prompt:u+
">",name:u,command_list:n})}else d.error("Command '"+u+"' Not Found")}}}(a);break;case "function":break;default:throw'Unknow object "'+String(a)+'" passed as eval';}if(w&&typeof k.login=="string"||w)k.login=function(b){var i=1;return function(l,u,n){d.pause();g.jrpc(w,i++,b,[l,u],function(y){d.resume();!y.error&&y.result?n(y.result):n(null)},function(y,p){d.resume();d.error("&#91;AJAX&#92; Response: "+p+"\n"+y.responseText)})}}(typeof k.login=="boolean"?"login":k.login);if(j("prompt",k.prompt)){var z=
new ga({name:k.name,eval:a,prompt:k.prompt,command_list:T,greetings:k.greetings}),m=d.find(".terminal-output").next().cmd({prompt:k.prompt,history:k.history,width:"100%",keydown:J,keypress:k.keypress?function(b){return k.keypress(b,d)}:null,commands:N});d.livequery(function(){d.resize()});P.append(d);k.enabled===true?d.focus():d.disable();g(window).resize(d.resize);d.click(function(){d.focus()});d.token&&!d.token()&&d.login_name&&!d.login_name()?O():M();typeof g.fn.init.prototype.mousewheel==="function"&&
d.mousewheel(function(b,i){i>0?d.scroll(-40):d.scroll(40);return false},true)}d.data("terminal",d);return d}})(jQuery);
